"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[2497],{25632:(e,t,r)=>{r.d(t,{A:()=>A});var n=r(92046),o=r(95728),i=r(79110),a=r(22707),s=r(37400),u=r(51018),c=r(38729),d=r(78105),l=r(88213);const p=new u.e,m=(0,c.NS)(),_='[class*="AudioRow__root"]',f=async e=>{if(await(0,s.G)(),e.attributes.getNamedItem("disabled"))return;const t=(e=>{const{fiber:t,props:r}=(0,o.A)(e),n=t?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||t?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||t?.return?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||t?.return?.return?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||t?.return?.return?.return?.return?.return?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||t?.return?.return?.return?.return?.return?.memoizedProps?.actions?.props?.track?.data?.apiAudio||t?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.value?.track?.data?.apiAudio||r?.children?.props?.audio?.apiAudio||t?.return?.return?.return?.memoizedProps?.actions?.props?.track?.entity?.apiAudio||t?.return?.return?.return?.return?.return?.return?.memoizedProps?.value?.track?.entity?.apiAudio;if(n)return n;if(e.parentElement){const{props:t}=(0,o.A)(e.parentElement),r=t.children?.props||t.children?.[0]?.props;if(r?.audio?.apiAudio)return r?.audio?.apiAudio}return null})(e);for(const r of p.listeners)r(e,t)},w=async(e=0)=>{if(document.querySelector('.vkui__root .vkuiFlex [class*="Skeleton__skeleton"],.vkui__root .vkuiFlex__host [class*="Skeleton__skeleton"],.vkui__root .vkuiFlex__host [class*="SkeletonComponent__skeleton"]'))return await(0,n.c)(1e3),w(e+1);await(0,s.G)(),await(0,a.t)();const t=document.querySelectorAll(_);for(const e of t)await(0,s.G)(),await f(e);await(async()=>{for(const e of document.querySelectorAll('[class*="AudioListItems__root--"] > div'))e[m]||(e[m]=new MutationObserver(e=>{for(const t of e)if("childList"===t.type)for(const e of t.addedNodes)if(e instanceof HTMLElement)if(e.matches(_))f(e);else for(const t of e.querySelectorAll(_))f(t)}),e[m].observe(e,{childList:!0}))})()};let v=!1;const A=e=>{const t=p.addListener(e);return(0,i.g)(w),v||(v=!0,(0,d.A)(()=>w()),(0,l.A)(()=>w())),t}},56992:(e,t,r)=>{r.d(t,{X:()=>o});var n=r(50313);const o=()=>(0,n.A)("AudioUtils")},78105:(e,t,r)=>{r.d(t,{A:()=>p});var n=r(92046),o=r(79110),i=r(22707),a=r(51018),s=r(91570);const u=new a.e,c=e=>e.replace("audio_playlist","").replace("/","_");let d=!1;const l=async()=>{if(d)return;d=!0;const e=await(0,s.R)();e.onLocationChange(async()=>{const t=e.objLoc.z;t&&t.startsWith("audio_playlist")&&(await(0,n.c)(1e3),await(0,i.t)(),(e=>{const t=c(e);for(const e of u.listeners)e(t)})(t))})},p=e=>{const t=u.addListener(e);return(0,o.g)(()=>{const t=new URLSearchParams(window.location.search).get("z");t&&t.startsWith("audio_playlist")&&requestAnimationFrame(()=>e(c(t))),l()}),t}},82497:(e,t,r)=>{r.r(t);var n=r(74848),o=r(56992),i=r(98570),a=r(25632),s=r(43171),u=r(3068);const c=['[class*="AudioRow__actions--"]','[data-testid="audiorow-actions"]'].join(","),d=async(e,t)=>{if(e.vkn_down_inj)return;e.vkn_down_inj=!0;const o=e.querySelector(".vkuiButtonGroup,.vkuiButtonGroup__host"),i=document.createElement("div");(o||e).prepend(i);const{default:a}=await Promise.all([r.e(961),r.e(7397),r.e(1649),r.e(8414),r.e(1142),r.e(8192),r.e(150),r.e(315)]).then(r.bind(r,50150));await(0,u.A)({root:i,content:(0,n.jsx)(a,{type:"audio_row_react",audioObject:t,tooltipProps:{placement:"bottom"}}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0})};let l=!1;(async()=>{l||(l=!0,(0,i.A)()?.vms_installed||((0,o.X)().then(e=>{if((0,i.A)()?.vms_installed)return;if(!e.onRowOver)return;if(e._down_inj)return;e._down_inj=!0;const t=e.onRowOver;e.onRowOver=function(...e){try{(async e=>{if((0,i.A)()?.vms_installed)return;const t=e.querySelector(".audio_row__actions");if(!t)return;if(t.vkn_down_inj)return;t.vkn_down_inj=!0;const o=e.dataset.audio;if(!o)return;const a=AudioUtils.audioTupleToAudioObject(JSON.parse(o));if(!a)return;if(a?.restrictionStatus||e.classList.contains("audio_row__deleted"))return;const s=document.createElement("div"),{default:c}=await Promise.all([r.e(961),r.e(7397),r.e(1649),r.e(8414),r.e(1142),r.e(8192),r.e(150),r.e(315)]).then(r.bind(r,50150)),{unmount:d}=await(0,u.A)({root:s,content:(0,n.jsx)(c,{type:"audio_row",audioObject:a,tooltipProps:{placement:"top",appearance:"black"}}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0});e.addEventListener("mouseleave",()=>{d(),t.vkn_down_inj=!1},{once:!0}),t.prepend(s)})(e[0]).catch(console.error)}catch(e){console.error(e)}return Reflect.apply(t,this,e)}}),(0,a.A)(async(e,t)=>{if(!t)return void console.error("no audio",{audioRow:e});if((0,i.A)()?.vms_installed)return;const r=e.querySelector(c);if(r)return d(r,t);if(e._vkn_audio_obs)return;const n=new MutationObserver(()=>{const r=e.querySelector(c);r&&(d(r,t),n.disconnect())});e._vkn_audio_obs=n,n.observe(e,{subtree:!0,childList:!0}),(0,s.A)(()=>n.disconnect())})))})().catch(console.error)},88213:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(92046),o=r(79110),i=r(22707),a=r(51018),s=r(91570);const u=new a.e;let c=!1;const d=async()=>{if(c)return;c=!0;(await(0,s.R)()).onLocationChange(async e=>{(e.startsWith("music/album")||e.startsWith("music/playlist"))&&(await(0,n.c)(1e3),await(0,i.t)(),(()=>{for(const e of u.listeners)e()})())})},l=e=>{const t=u.addListener(e);return(0,o.g)(()=>{(window.location.pathname.startsWith("/music/album")||window.location.pathname.startsWith("/music/playlist"))&&requestAnimationFrame(()=>e()),d()}),t}}}]);