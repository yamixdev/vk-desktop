"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[7533],{11707:(t,e,n)=>{n.d(e,{A:()=>d,V:()=>a});var o=n(65748),r=n(96540),c=n(74225),i=n.n(c);const u=[];let s=null;const a=t=>{s=t;for(const e of u)e(t)},l=()=>s||(window.ap?.getCurrentAudio?window.ap.getCurrentAudio():null),d=()=>{const t=(()=>{const[t,e]=(0,r.useState)(()=>window.ap||null);return i()(async n=>{window.ap&&t||(await(0,o.B)(),n()&&e(window.ap))},[]),t})(),[e,n]=(0,r.useState)(()=>l());(0,r.useEffect)(()=>{n(()=>l())},[t]),(0,r.useEffect)(()=>{if(!window.ap)return;const e=t.on(null,"current_audio_changed",()=>{n(t.getCurrentAudio())});return()=>{e()}},[t]),(0,r.useEffect)(()=>(u.push(n),()=>{const t=u.indexOf(n);-1!==t&&u.splice(t,1)}),[n]);return(0,r.useMemo)(()=>{if(!window.AudioUtils?.audioTupleToAudioObject)return null;return window.AudioUtils.audioTupleToAudioObject(e)},[e])}},18790:(t,e,n)=>{n.d(e,{$:()=>r});var o=n(50313);const r=()=>(0,o.A)("AudioPlayerUI")},56992:(t,e,n)=>{n.d(e,{X:()=>r});var o=n(50313);const r=()=>(0,o.A)("AudioUtils")},65748:(t,e,n)=>{n.d(e,{B:()=>r});var o=n(50313);const r=()=>(0,o.A)("ap")},74225:(t,e,n)=>{var o=n(96540);function r(t,e,n){var r="function"==typeof e;o.useEffect(function(){var n,o=!0,c=t(function(){return o});return Promise.resolve(c).then(function(t){n=t}),function(){o=!1,r&&e(n)}},r?n:e)}t.exports=r,t.exports.useAsyncEffect=r},81150:(t,e,n)=>{n.a(t,async(t,o)=>{try{n.r(e);var r=n(74848),c=n(57580),i=n(92046),u=n(18790),s=n(56992),a=n(38729),l=n(3068),d=n(43024),f=n(11707),A=t([c]);c=(A.then?(await A)():A)[0];const p=(0,a.sr)(),w=document.createElement("div");w.style.background="var(--vkui--color_background_content)";const h=async(t=0)=>{if(t>10)throw new Error("error inject custom lyrics");const e=document.getElementById("box_layer");if(!e)return;if(e.contains(w))return;const o=e.querySelector('[class*="AudioLyricsModal__content"]');if(!o)return console.warn("no AudioLyricsModal__content"),await(0,i.c)(200),await h(t+1);o.insertAdjacentElement("beforebegin",w);const c=await Promise.all([n.e(961),n.e(7397),n.e(1649),n.e(8414),n.e(2295),n.e(192)]).then(n.bind(n,40192));(0,l.A)({root:w,content:(0,r.jsx)(c.default,{vkLyrics:o}),disableParentTransformForPositionFixedElements:!0}).catch(console.error)},y=t=>{if(t[p])return;t[p]=!0;const e=t.audioTupleToAudioObject.bind(t);t.audioTupleToAudioObject=function(...t){try{const[e]=t;Array.isArray(e)&&(e[this.AUDIO_ITEM_INDEX_LYRICS]=1,e[this.AUDIO_ITEM_INDEX_FLAGS]|=this.AUDIO_ITEM_HAS_LYRICS_BIT)}catch(t){console.error("audioTupleToAudioObject error",t)}return Reflect.apply(e,this,t)}},_=()=>{(0,u.$)().then(t=>{const{lyrics:e}=new t({}),n=Object.getPrototypeOf(e),o=n.open;n.open=function(...t){try{const e=t[0]?.audio;(0,f.V)(e)}catch(t){console.error(t)}const e=Reflect.apply(o,this,t);try{h().catch(console.error)}catch(t){console.error(t)}return e}}),(0,s.X)().then(t=>y(t))};0,d.default.onInited(_),o()}catch(t){o(t)}})}}]);