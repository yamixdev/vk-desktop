"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[3179],{13179:(t,e,r)=>{var n=r(98570),o=r(92046),a=r(7417),s=r(22707),i=r(37400),u=r(51018),c=r(38729),l=r(2006),d=r(91570),p=r(5305);const f=new u.e,m=(0,c.NS)(),w=(0,c.Ln)(),h=async t=>{await(0,s.t)();for(const e of f.listeners)e(t)},_=async t=>{await(0,i.G)(),t[w]||(t[w]=new IntersectionObserver(async e=>{for(const r of e)r.isIntersecting&&await h(t)},{threshold:0,rootMargin:"50px 0% 50px 0%"}),t[w].observe(t),l.A.add(t))},y=async t=>{t&&await(0,o.c)(1e3),await(0,i.G)(),await(0,s.t)();const e=document.querySelectorAll(".audio_row");for(const t of e)await(0,i.G)(),_(t);(()=>{const t=document.querySelectorAll(".audio_pl_snippet__list");for(const e of t)e[m]||(e[m]=new MutationObserver(t=>{for(const e of t)if("childList"===e.type&&e.addedNodes.length)for(const t of e.addedNodes)t instanceof HTMLElement&&t.classList.contains("audio_row")&&_(t)}),e[m].observe(e,{childList:!0}),l.A.add(e))})()},A=["section","load_catalog_section","load_block_playlist","load_section"],b=()=>{(0,p.A)(t=>{const[e,r,n]=t,o=e.startsWith("al_audio.php")||e.startsWith("/audio");let a=r.act;if(o&&!a){a=new URL(e,window.location.origin).searchParams.get("act")}if(a&&A.includes(a)&&n.onDone){const t=n.onDone;n.onDone=function(...e){const r=Reflect.apply(t,this,e);r instanceof Promise?r.finally(()=>y(!0)):y(!0).catch(console.error)}}})};let v=!1;const g=t=>{const e=f.addListener(t);return(0,a.n)(y),v||(v=!0,b(),(0,d.R)().then(t=>{t.onLocationChange(t=>{(t.startsWith("audio")||t.startsWith("music"))&&y()})})),e};var k=r(25632),L=r(93819);const S="x0lsHsEKRus160bW",P="vYonF2e_Bl6cN8_e",x="K3ZK9kirXVPTwpMC";g(async t=>{if((0,n.A)()?.vms_installed)return;const e=t.dataset.audio;if(!e)return;const o=AudioUtils.audioTupleToAudioObject(JSON.parse(e));if(!o)return;if(o?.restrictionStatus||t.classList.contains("audio_row__deleted"))return;const a=t.querySelector(".audio_row__info");if(!a)return;if(a.getElementsByClassName(P).length)return;const s=await L.A,i=document.createElement("span");i.className=P,i.innerText=s.use("global_loading"),a.classList.add(S),a.appendChild(i);new IntersectionObserver(async(t,e)=>{t.forEach(async t=>{if(t.isIntersecting){const{default:t}=await r.e(9629).then(r.bind(r,89629)),n=await t(o);i.innerText=n?.bitrate?`${n.bitrate}`:s.use("global_error"),e.unobserve(i)}})},{threshold:0}).observe(i)}),(0,k.A)(async(t,e)=>{if((0,n.A)()?.vms_installed)return;if(!e)return;const o=t.querySelector('[class*="AudioRow__after--"]');if(!o)return;if(o.getElementsByClassName(P).length)return;const a=await L.A,s=document.createElement("span");s.className=P,s.innerText=a.use("global_loading"),o.classList.add(x),o.appendChild(s);new IntersectionObserver(async(t,n)=>{t.forEach(async t=>{if(t.isIntersecting){const{default:t}=await r.e(9629).then(r.bind(r,89629)),o=await t(e);s.innerText=o?.bitrate?`${o.bitrate}`:a.use("global_error"),n.unobserve(s)}})},{threshold:.1}).observe(s)})},25632:(t,e,r)=>{r.d(e,{A:()=>y});var n=r(92046),o=r(95728),a=r(79110),s=r(22707),i=r(37400),u=r(51018),c=r(38729),l=r(78105),d=r(88213);const p=new u.e,f=(0,c.NS)(),m='[class*="AudioRow__root"]',w=async t=>{if(await(0,i.G)(),t.attributes.getNamedItem("disabled"))return;const e=(t=>{const{fiber:e,props:r}=(0,o.A)(t),n=e?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||e?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||e?.return?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||e?.return?.return?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||e?.return?.return?.return?.return?.return?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.audio?.apiAudio||e?.return?.return?.return?.return?.return?.memoizedProps?.actions?.props?.track?.data?.apiAudio||e?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.value?.track?.data?.apiAudio||r?.children?.props?.audio?.apiAudio||e?.return?.return?.return?.memoizedProps?.actions?.props?.track?.entity?.apiAudio||e?.return?.return?.return?.return?.return?.return?.memoizedProps?.value?.track?.entity?.apiAudio;if(n)return n;if(t.parentElement){const{props:e}=(0,o.A)(t.parentElement),r=e.children?.props||e.children?.[0]?.props;if(r?.audio?.apiAudio)return r?.audio?.apiAudio}return null})(t);for(const r of p.listeners)r(t,e)},h=async(t=0)=>{if(document.querySelector('.vkui__root .vkuiFlex [class*="Skeleton__skeleton"],.vkui__root .vkuiFlex__host [class*="Skeleton__skeleton"],.vkui__root .vkuiFlex__host [class*="SkeletonComponent__skeleton"]'))return await(0,n.c)(1e3),h(t+1);await(0,i.G)(),await(0,s.t)();const e=document.querySelectorAll(m);for(const t of e)await(0,i.G)(),await w(t);await(async()=>{for(const t of document.querySelectorAll('[class*="AudioListItems__root--"] > div'))t[f]||(t[f]=new MutationObserver(t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)if(t instanceof HTMLElement)if(t.matches(m))w(t);else for(const e of t.querySelectorAll(m))w(e)}),t[f].observe(t,{childList:!0}))})()};let _=!1;const y=t=>{const e=p.addListener(t);return(0,a.g)(h),_||(_=!0,(0,l.A)(()=>h()),(0,d.A)(()=>h())),e}},78105:(t,e,r)=>{r.d(e,{A:()=>p});var n=r(92046),o=r(79110),a=r(22707),s=r(51018),i=r(91570);const u=new s.e,c=t=>t.replace("audio_playlist","").replace("/","_");let l=!1;const d=async()=>{if(l)return;l=!0;const t=await(0,i.R)();t.onLocationChange(async()=>{const e=t.objLoc.z;e&&e.startsWith("audio_playlist")&&(await(0,n.c)(1e3),await(0,a.t)(),(t=>{const e=c(t);for(const t of u.listeners)t(e)})(e))})},p=t=>{const e=u.addListener(t);return(0,o.g)(()=>{const e=new URLSearchParams(window.location.search).get("z");e&&e.startsWith("audio_playlist")&&requestAnimationFrame(()=>t(c(e))),d()}),e}},88213:(t,e,r)=>{r.d(e,{A:()=>d});var n=r(92046),o=r(79110),a=r(22707),s=r(51018),i=r(91570);const u=new s.e;let c=!1;const l=async()=>{if(c)return;c=!0;(await(0,i.R)()).onLocationChange(async t=>{(t.startsWith("music/album")||t.startsWith("music/playlist"))&&(await(0,n.c)(1e3),await(0,a.t)(),(()=>{for(const t of u.listeners)t()})())})},d=t=>{const e=u.addListener(t);return(0,o.g)(()=>{(window.location.pathname.startsWith("/music/album")||window.location.pathname.startsWith("/music/playlist"))&&requestAnimationFrame(()=>t()),l()}),e}}}]);