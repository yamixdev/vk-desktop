"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[9920],{2969:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(90603),o=n(68284),i=n(3916),a=n(38444),r=n(47809);const l=async()=>{const e=(0,s.A)()?.store,t=e?.dispatch;if(!t)return;const n=e.getState()?.owner?.id,a=await(0,i.P)();if(!n||n===a.id)return;const l={id:n};await r.A.apiUsers([l]);for(const e of Object.keys(l)){if("id"===e)continue;t((0,o.A)(e,l[e]))}},c=async()=>{(0,a.A)({onProfileLoadComplited:l})}},4760:(e,t,n)=>{n.d(t,{Q:()=>s});const s=(e,t=100)=>{const n=[...e],s=[];for(;n.length;)s.push(n.splice(0,t||n.length));return s}},38444:(e,t,n)=>{n.d(t,{A:()=>A});var s=n(22440),o=n(7417),i=n(22707),a=n(37400),r=n(38729),l=n(91570),c=n(2006);const p=(0,s.A)(),d=(0,r.NS)(),f=(0,r.NS)(),u=[],_=async(e,t)=>{if(!(e[`_${t}`]>1)){e[`_${t}`]=(e[`_${t}`]||0)+1;for(const n of u){const s=n[t];s&&(await(0,a.G)(),s(e))}}},m=(e,t)=>{t[d]||(t[d]=new MutationObserver(async n=>{for(const s of n)if("attributes"===s.type&&"style"===s.attributeName&&(await(0,a.G)(),"none"===t.style.display)){const t=e.querySelector(".Profile");t&&_(t,"onProfileLoadComplited")}}),t[d].observe(t,{attributes:!0}),c.A.add(t))},h=e=>{const t=e.querySelector(".Profile");return!!t&&(_(t,"onProfileLoadComplited"),!0)},y=()=>{for(const e of document.querySelectorAll(".ProfileWrapper,.ProfileWrapper__root")){_(e,"onProfileLoad");const t=e.querySelector("#profile_skeleton");let n=e.querySelector(".ProfileWrapper__root,#react_rootprofile")||e;n?h(n)||n&&!n[f]&&(n[f]=new MutationObserver((e,t)=>{h(n)&&t.disconnect()}),n[f].observe(n,{childList:!0,subtree:!0}),c.A.add(n)):t?m(e,t):_(e,"onErrorFindSkeleton")}};let b=!1;const A=async e=>{if(u.push(e),(0,o.n)(y),b)return;b=!0;(await(0,l.R)()).subscribeOnModuleEvaluated(async()=>{await(0,i.t)(),p.cur?.module&&"profile"!==p.cur?.module||requestIdleCallback(y)})}},47809:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(76299),o=n(7618),i=n(4760),a=n(61634),r=n(47875),l=n(93819);class c{static cache=new Map;static CACHE_TTL=3e4;static processUserData(e){return e.online_info?.visible?{sex:e.sex,online:e.online,online_mobile:e.online_mobile,online_app:e.online_app,...e.last_seen,...e.online_info,last_seen:e.online_info?.last_seen||e.last_seen?.time}:null}static isCacheValid(e){return Date.now()-e.cachedAt<this.CACHE_TTL}static getCachedData(e){const t={},n=[];for(const s of e){const e=this.cache.get(s);if(e&&this.isCacheValid(e)){const{cachedAt:n,...o}=e;t[s]=o}else n.push(s)}return{cached:t,missing:n}}static setCachedData(e,t){this.cache.set(e,{...t,cachedAt:Date.now()})}static async getBypassedOnlineInfo(e,t=!1){const n=[],s=e.map(e=>"string"==typeof e?parseInt(e):e),{cached:o,missing:l}=this.getCachedData(s);let c={...o};if(0===l.length)return c;try{const e=await a.J.getAnonymToken(),s=["online_info","last_seen","online","online_mobile","online_app"];t&&s.push("sex");const o=(0,i.Q)(l,100).map(t=>vkApi.api("users.get",{user_ids:t,fields:s},{accessToken:e,grouping:!1})),r=(await Promise.all(o)).flat();for(const e of r){if(1===e.hidden||"vk_users_only"===e.no_index){n.push(e.id);continue}const t=this.processUserData(e);t&&(c[e.id]=t,this.setCachedData(e.id,t))}if(0===n.length)return c}catch(e){console.error(e)}const{response:p}=await r.A.call("users.getBypassedOnlineInfo",{ids:n.length>0?n.join(","):l.join(","),json:1,need_sex:t?1:0,version:"AO93BHIBfk8d1VjaoP3YIVjstqu"});return{...c,...p}}static async chatDetails(e){const t=Object.keys(e).filter(t=>+t>0&&0===e[t]?.can_see);if(!t.length)return;const n=await this.getBypassedOnlineInfo(t);for(const s of t){const t=n[Number(s)];t&&(e[s]={can_see:1,platform:t.is_online?t.platform:0,time:t.last_seen,mobile:t.is_mobile?1:0})}}static async peerStart(e,t){if(o.z.isGroupId(e)||o.z.isChatId(e)||0!==t?.can_see)return;const n=(await this.getBypassedOnlineInfo([e]))[e];n&&(t.can_see=1,t.platform=n.is_online?n.platform:0,t.time=n.last_seen,t.mobile=n.is_mobile?1:0)}static async apiUsers(e){const t=[...new Set(e.filter(e=>"number"==typeof e.id&&e.id!==vk.id&&!e.online&&!e.online_info?.visible).map(e=>e.id))];if(!t.length)return;const n=await this.getBypassedOnlineInfo(t);for(const t of e){const e=n[t.id];e&&(t.online=e.online,t.online_mobile=e.online_mobile,t.online_app=e.online_app,t.online_info={visible:!0,last_seen:e.last_seen,is_online:e.is_online,is_mobile:e.is_mobile,app_id:e.app_id},t.last_seen={platform:e.platform,time:e.last_seen})}}static async profileTooltip(e,t){if(!/^id(\d+)$/.test(e))return t;e=e.slice(2);const n=await this.getBypassedOnlineInfo([e],!0),[o]=Object.values(n);if(!o)return t;if(o&&(o.is_online||o.last_seen)){const e=o.is_mobile?'<b class="mob_onl im_status_mob_onl"></b>':"";let n="online";if(!o.is_online){const e=await l.A;n=`${e.use("vkcom_last_seen_sex",null,"raw")[1===o.sex?1:0]} ${getDateText(o.last_seen,null)}`}return n=(0,s.A)(n)+e,t.includes('class="mention_tt_row mention_tt_online"')?t.replace(/<div.*?class="mention_tt_row mention_tt_online".*?>(.*?)<\/div>/,(e,t)=>t?e.replace(t,n):e.replace("</div>",`${n}</div>`)):t.replace(/class="mention_tt_name"((.|\n)+?)<\/div>/,e=>`${e}<div class="mention_tt_row mention_tt_online">${n}</div>`)}return t}}},49920:(e,t,n)=>{n.a(e,async(e,s)=>{try{n.r(t);var o=n(57580),i=n(5305),a=n(43024),r=n(2969),l=n(96446),c=n(47809),p=e([o]);o=(p.then?(await p)():p)[0];let d=null;const f=()=>{d||(d=(0,i.A)(e=>{const[t,n,s]=e;if(s)if(t.includes("al_im.php")){if("a_get_chat_details"===n.act){const{onDone:e}=s;s.onDone=async function(...t){const[{lastSeen:n}]=t;return await c.A.chatDetails(n),Reflect.apply(e,this,t)}}else if("a_start"===n.act){const{onDone:e}=s;s.onDone=async function(...t){const[{peerId:n,last_seen:s}]=t;return await c.A.peerStart(n,s),Reflect.apply(e,this,t)}}}else if(t.includes("al_wall.php")&&"mention_tt"===n.act){const{onDone:e}=s;s.onDone=async function(...t){const[s]=t;return t[0]=await c.A.profileTooltip(n.mention,s),Reflect.apply(e,this,t)}}return e}))};0,a.default.onInited(()=>{a.default.getValue("offlinebypass")&&(f(),(0,l.A)().catch(console.error),(0,r.A)().catch(console.error))}),a.default.addChangeKeyListener("offlinebypass",(e,t)=>{t?f():d&&(d(),d=null)}),s()}catch(e){s(e)}})},68284:(e,t,n)=>{n.d(t,{A:()=>s});const s=(e,t)=>({type:"UPDATE_OWNER_FIELD",key:e,value:t})},76299:(e,t,n)=>{n.d(t,{A:()=>i});var s=n(99418);const o=document.createElement("textarea"),i=e=>(o.innerText=s.A.sanitize(e),o.innerHTML)},90603:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(95728);const o=()=>{const e=document.getElementById("profile_redesigned");if(!e)return{state:void 0,profileRedesigned:void 0,store:void 0};const t=document.getElementById("react_rootprofile"),{container:n,fiber:o}=(0,s.A)(t);let{env:i,store:a}=n?.memoizedState?.element?.props||o?.memoizedProps?.children?.[0]?.props?.children?.props||{};if(!a){const{fiber:t}=(0,s.A)(e);a=t?.return?.return?.memoizedProps?.value?.store||t?.return?.return?.return?.return?.return?.memoizedProps?.value}const r=a?.getState?.();return r||console.warn("profile state not found"),{state:r||void 0,profileRedesigned:e,store:a,env:i}}},96446:(e,t,n)=>{n.d(t,{A:()=>i});var s=n(61054),o=n(47809);const i=async()=>{const e=await(0,s.V)(),t=e.api;e.api=async(...n)=>{const s=await Reflect.apply(t,e,n);try{const e=[];if(Array.isArray(s?.profiles)&&e.push(...s.profiles),Array.isArray(s))for(const t of s)Array.isArray(t?.profiles)&&e.push(...t.profiles);e.length&&await o.A.apiUsers(e)}catch(e){console.error(e)}return s}}}}]);