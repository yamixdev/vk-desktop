"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[6604],{11423:(t,e,n)=>{var o=n(53644),s=n(43027),r=n(92046),a=n(22707),c=n(37445),i=n(39107);const l="xNhcCq_UNVqKQEib",u="u9AKScaRWsIKN7qd",d="Lli6CPLXkovauI7n",f="Cc4GXP80VVMTfPd4",w="c913ig6Ezz3GVTdC",h="IE60yzaGkHX5daO2",m="raJj9IYn99N3ACXp",p="X2ua3r3TQNQvwbXJ",v="LK9FQ0Pv500X3dYq",b="y41wlJ_6fta4bTJz",g={s:"mojeiuk_7TzO9VSV",m:"CXscUFfSjR7lXqQI",l:"nX2YiCQaNJkb1qHH"},y={primary:"AIOZvvr4uGYhBuP3",secondary:"Go6BE_VQ2GfVAQ6r",tertiary:"YgaW59UgTFahy9oF",outline:"uSRUc48whtn46Je_",link:"wX7UgKZQHRLzOBsB"},k={accent:"Y1sbzl9FIKHeDajP",positive:"VQfF8MKnxI3AwZTZ",negative:"T2iqqDcm93cAZn77",neutral:"yZi0auJaXofQNSQl",overlay:"uIXRefk1cdt_J8vy","accent-invariable":"qUAuu6PmeQ8YbMlz"},_={left:"H03Ea3gr3reCTz1g",right:"F09BLvr4K1N2MaU2"},E=({size:t="s",mode:e="primary",appearance:n="accent",stretched:o=!1,align:s,before:r,after:a,content:c,rounded:E,className:S,onClick:A})=>{const T=document.createElement("button");T.className=(0,i.xWm)(S,l,g[t],y[e],k[n],s&&_[s],d,b,o&&f,E&&u);const I=document.createElement("span");if(I.className=w,r){const t=document.createElement("span");t.className=p,t.appendChild(r),I.appendChild(t)}if(c){const t=document.createElement("span");t.className=h,"string"==typeof c?t.textContent=c:t.appendChild(c),I.appendChild(t)}if(a){const t=document.createElement("span");t.className=m,t.appendChild(a),I.appendChild(t)}return A&&T.addEventListener("click",A),T.addEventListener("mouseover",()=>{T.classList.add(v)}),T.addEventListener("mouseout",()=>{T.classList.remove(v)}),T.appendChild(I),T};var S=n(91570),A=n(39201),T=n(93819),I=n(49032),N=n(37746),L=n(69926),x=n(88908),D=n(67078),C=n(43024),R=n(69128),M=n(57448),O=n(94037),q=n(89481),j=n(46746);const z={0:"-6","00":"-7","000":"-15","0000":"-23","00000":"-62","000000":"-10","0000000":"-7000","00000000":"-165","000000000":"-183","0000000000":"-185"},P=t=>{const e=t.match(/album(-?\d+)_(\d+)/);if(e){const t=Number(e[1]),n=e[2];return{ownerId:t,albumId:Number(z[n]||n)}}throw new Error("Failed to extract owner and album ids from album string")},H=async(t,e,n,o)=>{const s={owner_id:t,album_id:e,photo_size:1,rev:1,offset:n,count:o};return await window.vkApi.api("photos.get",s,{grouping:!1})},U=async(t,e,n,o)=>{if(n?.aborted)return null;if(!t.sizes)return console.warn("No sizes in photo",t),null;const{url:s}=(0,j.A)(t.sizes);if(!s)return console.warn("No url in photo",t),null;try{const r=await fetch(s,{signal:n});if(!r.body)return null;const a=await r.blob(),c=[t.owner_id,t.id].join("_");return{name:(()=>{const t=C.default.getValue("keepOriginalPhotoNamesDownload"),e=C.default.getValue("numPhotosOnAlbumDownload"),n=t?(0,M.A)(s):`${c}.jpg`;return e&&o?`${o}. ${n}`:n})(),lastModified:t.date?new Date(1e3*t.date):e,input:a}}catch(s){return console.error(s),await(0,r.c)(1e3),U(t,e,n,o)}},V=async t=>{const{ownerId:e,albumId:o}=P(t),s=await(0,q.A)({id:`album_${e}_${o}`,startIn:"pictures"}),r=new AbortController,{signal:a}=r,c=await T.A,i=`photoAlbum_${e}_${o}`;let l=(0,x.A)(`${t}.zip`);const{setProgress:u,startArchiving:d,finish:f,setExtraText:w,setTitle:h}=(0,R.Hq)({id:i,title:l,type:"photo_album",onCancel:()=>r.abort()}),{items:m}=await window.vkApi.api("photos.getAlbums",{owner_id:e,album_ids:o}),p=m.find(t=>t.id===o),v=p?.title||t,{count:b}=await H(e,o,0,1),g=await(async(t,e,n)=>{const o=1e3,s=Math.ceil(n/o),r=[];for(let a=0;a<s;a++){const s=a*o,c=Math.min(o,n-s),i=H(t,e,s,c);r.push(i)}try{return(await Promise.all(r)).reduce((t,e)=>t.concat(e.items),[])}catch(t){throw await(0,D.A)({text:`Error fetching photos: ${t.message}`}),t}})(e,o,b);l=(0,x.A)(`${v}.zip`),h(l);const y=new Date,k=new L.A(I.pz);let _=1,E=0;u({current:0,total:b});const S=async(t,e)=>{const n=await U(t,y,a,e);if(n)return a.aborted||(E++,u({current:E,total:b})),w(c.use("vkcom_playlist_track_download_completed",{trackName:n?.name||""})),s?await(0,O.A)({zipFile:n,subFolderName:v,dirHandle:s}):n};for(const t of g){if(a.aborted)return;const e=_++;k.addTask(()=>S(t,e))}const A=(await k.waitAll()).filter(t=>!!t);if(a.aborted)return;if(s)return w(c.use("vkcom_playlist_download_completed",{total:c.use("vkcom_photos_plurals",E)})),await(0,D.A)({type:"done",text:c.use("vkcom_fs_photo_album_done"),subtitle:l}),void f();w(""),d();const{downloadZip:C}=await n.e(1941).then(n.bind(n,71941)),M=await C(A).blob(),j=URL.createObjectURL(M),z=()=>(0,N.A)(j,l);await z(),f({onSave:z,onRemove:()=>URL.revokeObjectURL(j)}),w(c.use("vkcom_playlist_download_completed",{total:c.use("vkcom_photos_plurals",E)}))},$='.vkui__root div[class*="Photos__root"] .vkuiInternalGroup div[class*="GradientGroup__headerContent"] > div[class*="HeaderLayout__container"]',F=(t=window.nav?.strLoc||window.location.pathname.slice(1))=>/^album-?\d+/.test(t),G=async t=>{if(!F())return;const e=t.querySelector(".vkuiButtonGroup,.vkuiButtonGroup__host");if(!e||e.vkn_down_inj)return;if(e.querySelector('[class*="Skeleton__skeleton"],[class*="SkeletonComponent__skeleton"]'))return;e.vkn_down_inj=!0;const n=e.querySelector(".vkuiIcon--more_20")?.closest(".vkuiButton,.vkuiButton__host,button"),s=await T.A;e.insertBefore(E({mode:"secondary",content:s.use("global_download"),before:(0,o.A)(c.A),onClick:()=>V(nav.strLoc)}),n||null)},B=async()=>{if(!F())return;const t=document.querySelector(".photos_album_intro_info");if(!t||t?.vkn_down_inj)return;t.vkn_down_inj=!0;const e=document.createElement("span");e.className="divide",e.innerText="|";const n=document.createElement("span");n.className="photos_album_info";const o=document.createElement("a");o.addEventListener("click",t=>{(0,s.A)(t),V(nav.strLoc)});const r=await T.A;o.innerText=r.use("global_download")||"Download",n.appendChild(o),t.append(e,n)},Q=async()=>{await(0,r.c)(1e3),await(0,a.t)();for(const t of document.querySelectorAll($))G(t).catch(console.error)};(async()=>{B().catch(console.error),Q().catch(console.error);(await(0,S.R)()).onLocationChange(async()=>{F()&&(await(0,a.t)(),B().catch(console.error),Q().catch(console.error))}),F()&&await B(),(0,A.A)(t=>{for(const e of t.querySelectorAll($))G(e).catch(console.error)})})().catch(console.error)},24293:(t,e,n)=>{var o,s;n.d(e,{h:()=>o}),(s=o||(o={})).PREPARING="preparing",s.DOWNLOADING="downloading",s.FINISHED="finished",s.ARCHIVING="archiving"},37445:(t,e,n)=>{n.d(e,{A:()=>o});const o='<svg fill="none" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor"><path clip-rule="evenodd" d="m4 17.75c0-.4142.33579-.75.75-.75h10.5c.4142 0 .75.3358.75.75s-.3358.75-.75.75h-10.5c-.41421 0-.75-.3358-.75-.75z" fill-rule="evenodd"/><path d="m10.7493 2.72581c0-.40086-.3355-.72581-.74931-.72581-.41385 0-.74933.32495-.74933.72581l-.00001 9.72199-3.97032-3.97029c-.29289-.29289-.76777-.29289-1.06066 0s-.29289.76777 0 1.06066l5.24532 5.24533c.2929.2929.76781.2929 1.06071 0l5.2558-5.25585c.2929-.2929.2929-.76777 0-1.06067-.2929-.29289-.7678-.29289-1.0606 0l-3.9716 3.97152z"/></g></svg>\n'},37746:(t,e,n)=>{n.d(e,{A:()=>r});const o=t=>{try{t.dispatchEvent(new MouseEvent("click"))}catch(e){const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}},s=async(t,e="download")=>{const n=document.createElement("a");n.download=e,n.rel="noopener",(globalThis?.chrome?.runtime?.id||globalThis?.browser?.runtime?.id)&&(n.target="_blank"),"string"==typeof t?(n.href=t,n.origin!==location.origin?await(async t=>{try{const e=await globalThis.fetch(t,{method:"HEAD"});return e.status>=200&&e.status<=299}catch(t){console.error(t)}return!1})(n.href)?await(async(t,e)=>{try{const n=await globalThis.fetch(t,{method:"GET"}),o=await n.blob();await s(o,e)}catch(t){console.error(t)}})(t,e):(n.target="_blank",o(n)):o(n)):(n.href=URL.createObjectURL(t),setTimeout(()=>{URL.revokeObjectURL(n.href)},4e4),setTimeout(()=>{o(n)},0))},r=s},39201:(t,e,n)=>{n.d(e,{A:()=>v});var o=n(7417),s=n(51018),r=n(38729),a=n(91570);const c=new s.e,i=(0,r.NS)(),l=(0,r.NS)(),u=(0,r.sr)(),d="vkui__root",f=`.${d}`,w=t=>{if(!t[u]){t[u]=!0;for(const e of c.listeners)e(t)}},h=t=>{if(t.classList.contains(d))return w(t);for(const e of t.querySelectorAll(f))w(e);t[i]||(t[i]=new MutationObserver(async t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)t instanceof HTMLElement&&t.classList.contains(d)&&w(t)}),t[i].observe(t,{childList:!0}))},m=()=>{const t=document.getElementById("spa_root");if(t){for(const e of t.querySelectorAll(f))h(e);t[l]||(t[l]=new MutationObserver(t=>{for(const e of t)if("childList"===e.type)for(const t of e.addedNodes)t instanceof HTMLElement&&t.classList.contains(d)&&h(t)}),t[l].observe(t,{childList:!0}))}};let p=!1;const v=async t=>{const e=c.addListener(t);if((0,o.n)(m),p)return e;p=!0;return(await(0,a.R)()).subscribeOnModuleEvaluated(()=>{setTimeout(m,100)}),e}},46746:(t,e,n)=>{n.d(e,{A:()=>s});var o=n(62493);const s=t=>{let e=null,n=0;for(const s of t){const t=s.type;if(o.B.includes(t)){const t=(s.width||0)*(s.height||0);t>n&&(n=t,e=s)}}return e||t[0]}},52079:(t,e,n)=>{t.exports=n(97273)},53644:(t,e,n)=>{n.d(e,{A:()=>s});let o=0;const s=t=>{const e=!!document.importNode;let n=(new DOMParser).parseFromString(t,"image/svg+xml").documentElement;e&&(n=document.importNode(n,!0));for(const t of n.querySelectorAll("title,desc"))t.remove();for(const t of n.querySelectorAll("[id]")){if(!t.id)continue;const e="vknext_icon-"+o++;let s=!1;for(const o of n.querySelectorAll(`[fill="url(#${t.id})"]`))o.setAttribute("fill",`url(#${e})`),s=!0;s&&(t.id=e)}return n}},57448:(t,e,n)=>{n.d(e,{A:()=>o});const o=t=>{const e=new URL(t).pathname;return e.substring(e.lastIndexOf("/")+1)}},62493:(t,e,n)=>{n.d(e,{A:()=>s,B:()=>o});const o=["a","b","i","p","q","s","w","z","y","x","r","o","m","g","max","l","f","k","c","e","d","j","temp","h","n"],s=(t=window.cur.pvCurPhoto)=>{if(!t)throw new Error("Фоторедактор не открыт");let e=null,n=0;for(const[s,r]of Object.entries(t)){const t=s.slice(0,-1);if(o.includes(t)){const[t,o,s]=r,a=o*s;a>n&&(n=a,e=[t,o,s])}}if(!e)throw new Error("Фото не найдено");return e}},63989:(t,e,n)=>{n.d(e,{VZ:()=>o,fU:()=>r,oT:()=>s});class o extends Error{constructor(t){super(`Download task with ID ${t} not found.`),this.name="DownloadTaskNotFoundError"}}class s extends Error{constructor(t){super(`Download task with ID ${t} is already finished.`),this.name="DownloadTaskAlreadyFinishedError"}}class r extends Error{constructor(t){super(`Download task with ID ${t} has already timed out.`),this.name="DownloadTaskTimeoutError"}}},69106:(t,e,n)=>{n.d(e,{$:()=>a});var o=n(81621),s=n(24293),r=n(63989);const a=(0,o.vt)((t,e)=>{const n=t=>{const n=new Map(e().tasks).get(t);if(!n)throw new r.VZ(t);return n},o=e=>{t(t=>{const n=new Map(t.tasks),o=n.get(e);if(o?.onRemove)for(const t of o.onRemove)t();return n.delete(e),{tasks:n}})},a=a=>({setExtraText:e=>((e,o)=>{const s=n(e);t(t=>{const n=new Map(t.tasks);return n.set(e,{...s,extraText:o}),{tasks:n}})})(a,e),setPhotoUrl:e=>((e,o)=>{const s=n(e);t(t=>{const n=new Map(t.tasks);return n.set(e,{...s,photoUrl:o}),{tasks:n}})})(a,e),setTitle:e=>((e,o)=>{const s=n(e);t(t=>{const n=new Map(t.tasks);return n.set(e,{...s,title:o}),{tasks:n}})})(a,e),setProgress:o=>((o,a)=>{const c=n(o),i=new Map(e().tasks);if(c.status===s.h.FINISHED)throw new r.oT(o);t(()=>(i.set(o,{...c,progress:a,status:s.h.DOWNLOADING}),{tasks:i}))})(a,o),startArchiving:()=>(e=>{const o=n(e);t(t=>{const n=new Map(t.tasks);return n.set(e,{...o,status:s.h.ARCHIVING}),{tasks:n}})})(a),finish:e=>((e,a)=>{const c=n(e);if(c.status===s.h.FINISHED)throw new r.oT(e);if(c.timeoutId)throw new r.fU(e);const i=setTimeout(()=>o(e),60*(a?.onSave?15:5)*1e3);t(t=>{const n=new Map(t.tasks),o=new Set(c.onRemove);return a?.onRemove&&o.add(a.onRemove),n.set(e,{...c,onRemove:o,timeoutId:i,onSave:a?.onSave,status:s.h.FINISHED}),{tasks:n}})})(a,e),cancel:()=>(e=>{const o=n(e);for(const t of o.onCancel)t();t(t=>{const n=new Map(t.tasks);return n.delete(e),{tasks:n}})})(a),remove:()=>o(a)});return{tasks:new Map,startDownload:({id:e,onCancel:n,...o})=>{const r={...o,id:e,progress:{current:void 0,total:void 0},status:s.h.PREPARING,onCancel:new Set(n?[n]:[]),onRemove:new Set};t(t=>{const n=new Map(t.tasks);return n.set(e,r),{tasks:n}});const c=a(e);return{id:e,...c}},getTask:t=>{const e=n(t);return e?{...e}:void 0},getTaskHandlersById:a}})},69128:(t,e,n)=>{n.d(e,{Hq:()=>r,S:()=>i,_5:()=>c,cy:()=>a,hF:()=>s.h});var o=n(69106),s=n(24293);const r=t=>o.$.getState().startDownload(t),a=t=>o.$.getState().getTask(t),c=()=>(0,o.$)(t=>t.tasks),i=t=>(0,o.$)(t=>t.getTaskHandlersById)(t)},72257:(t,e,n)=>{t.exports=n(72518)},72518:(t,e,n)=>{
/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var o=n(96540);var s="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},r=o.useState,a=o.useEffect,c=o.useLayoutEffect,i=o.useDebugValue;function l(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!s(t,n)}catch(t){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(t,e){return e()}:function(t,e){var n=e(),o=r({inst:{value:n,getSnapshot:e}}),s=o[0].inst,u=o[1];return c(function(){s.value=n,s.getSnapshot=e,l(s)&&u({inst:s})},[t,n,e]),a(function(){return l(s)&&u({inst:s}),t(function(){l(s)&&u({inst:s})})},[t]),i(n),n};e.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},81621:(t,e,n)=>{n.d(e,{vt:()=>f});const o=t=>{let e;const n=new Set,o=(t,o)=>{const s="function"==typeof t?t(e):t;if(!Object.is(s,e)){const t=e;e=(null!=o?o:"object"!=typeof s||null===s)?s:Object.assign({},e,s),n.forEach(n=>n(e,t))}},s=()=>e,r={setState:o,getState:s,getInitialState:()=>a,subscribe:t=>(n.add(t),()=>n.delete(t)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},a=e=t(o,s,r);return r},s=t=>t?o(t):o;var r=n(96540),a=n(52079);const{useDebugValue:c}=r,{useSyncExternalStoreWithSelector:i}=a;let l=!1;const u=t=>t;const d=t=>{"function"!=typeof t&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const e="function"==typeof t?s(t):t,n=(t,n)=>function(t,e=u,n){n&&!l&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),l=!0);const o=i(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return c(o),o}(e,t,n);return Object.assign(n,e),n},f=t=>t?d(t):d},88908:(t,e,n)=>{n.d(e,{A:()=>s});const o=document.createElement("textarea"),s=t=>(o.innerHTML=t,o.innerText)},97273:(t,e,n)=>{
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var o=n(96540),s=n(72257);var r="function"==typeof Object.is?Object.is:function(t,e){return t===e&&(0!==t||1/t==1/e)||t!=t&&e!=e},a=s.useSyncExternalStore,c=o.useRef,i=o.useEffect,l=o.useMemo,u=o.useDebugValue;e.useSyncExternalStoreWithSelector=function(t,e,n,o,s){var d=c(null);if(null===d.current){var f={hasValue:!1,value:null};d.current=f}else f=d.current;d=l(function(){function t(t){if(!i){if(i=!0,a=t,t=o(t),void 0!==s&&f.hasValue){var e=f.value;if(s(e,t))return c=e}return c=t}if(e=c,r(a,t))return e;var n=o(t);return void 0!==s&&s(e,n)?(a=t,e):(a=t,c=n)}var a,c,i=!1,l=void 0===n?null:n;return[function(){return t(e())},null===l?void 0:function(){return t(l())}]},[e,n,o,s]);var w=a(t,d[0],d[1]);return i(function(){f.hasValue=!0,f.value=w},[w]),u(w),w}}}]);