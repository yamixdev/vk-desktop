"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[695,9133],{695:(t,e,o)=>{o.d(e,{U:()=>n});var r=o(50313);const n=()=>(0,r.A)("colorScheme")},8906:(t,e,o)=>{o.d(e,{d:()=>n});var r=o(50313);const n=()=>(0,r.A)("Photoview")},13674:(t,e,o)=>{o.d(e,{A:()=>a});var r=o(48913),n=o(79068),s=o(51018);const a=t=>{const e=new s.e,o=o=>{let r=o[t];Object.defineProperty(o,t,{get:()=>r,set:t=>{r=t;for(const t of e.listeners)try{t(r)}catch(t){console.error(t)}return!0},configurable:!0,enumerable:!0})};let a=!1;const c=async s=>{a||(a=!0,await(async()=>{let s=await(0,r.e)();o(s),(0,n.A)(r=>{if(s[t]!==r[t])for(const o of e.listeners)try{o(r[t])}catch(t){console.error(t)}o(r),s=r})})());s((await(0,r.e)())[t])};return t=>{const o=e.addListener(t);return c(t),o}}},18790:(t,e,o)=>{o.d(e,{$:()=>n});var r=o(50313);const n=()=>(0,r.A)("AudioPlayerUI")},30956:(t,e,o)=>{o.d(e,{Ku:()=>r.K,R2:()=>n.R,VA:()=>s.V});o(99887),o(13536),o(91953),o(65748),o(18790),o(56992);var r=o(71191),n=(o(54350),o(695),o(48913),o(47812),o(37752),o(74501),o(91570)),s=(o(8906),o(38590),o(41590),o(51669),o(58310),o(3916),o(61054))},37746:(t,e,o)=>{o.d(e,{A:()=>s});const r=t=>{try{t.dispatchEvent(new MouseEvent("click"))}catch(e){const o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(o)}},n=async(t,e="download")=>{const o=document.createElement("a");o.download=e,o.rel="noopener",(globalThis?.chrome?.runtime?.id||globalThis?.browser?.runtime?.id)&&(o.target="_blank"),"string"==typeof t?(o.href=t,o.origin!==location.origin?await(async t=>{try{const e=await globalThis.fetch(t,{method:"HEAD"});return e.status>=200&&e.status<=299}catch(t){console.error(t)}return!1})(o.href)?await(async(t,e)=>{try{const o=await globalThis.fetch(t,{method:"GET"}),r=await o.blob();await n(r,e)}catch(t){console.error(t)}})(t,e):(o.target="_blank",r(o)):r(o)):(o.href=URL.createObjectURL(t),setTimeout(()=>{URL.revokeObjectURL(o.href)},4e4),setTimeout(()=>{r(o)},0))},s=n},37752:(t,e,o)=>{o.d(e,{V:()=>n});var r=o(50313);const n=()=>(0,r.A)("getAudioPlayer")},38590:(t,e,o)=>{o.d(e,{D:()=>n});var r=o(50313);const n=()=>(0,r.A)("Stories")},39133:(t,e,o)=>{var r=o(43027),n=o(37746),s=o(22707),a=o(92046),c=o(30956),i=o(38590),d=o(38729),u=o(93819),l=o(2006);const w=(0,o(13674).A)("storyLayer"),y=(0,d.NS)(),h=async t=>{if(!t||t.vkn_down_inj)return;t.vkn_down_inj=!0;const e=await u.A,o=document.createElement("div");o.className="StoryMenuItem ui_actions_menu_item",o.innerText=e.use("global_download"),o.addEventListener("click",t=>{(0,r.A)(t),(()=>{if(!window.cur.storyLayer)return;const t=window.cur.storyLayer.activeStory.story.data,e=t.raw_id||[t.owner_id,t.id].join("_");"photo"===t.type?(0,n.A)(t.photo_url,`story${e}.jpg`):(0,n.A)(t.video_url,`story${e}.mp4`)})()}),t.prepend(o)},v=".stories_author_buttons .StoryViewerHeaderButton .ui_actions_menu_wrap > .ui_actions_menu",A=async()=>{if(!window.cur.storyLayer)return;const t=window.cur.storyLayer?.activeStory?.actionButtons;if(t){const e=t.querySelector(".ui_actions_menu");e&&await h(e)}const e=window.cur.storyLayer.stories;if(!e)return;e.querySelector(v)||await(0,a.c)(1e3);const o=e.querySelector(v);o&&await h(o)},b=async()=>{window.cur.storyLayer||await(0,a.c)(1e3),A();const t=document.querySelector(".stories_author_buttons");t&&(t[y]||(t[y]=new MutationObserver(()=>A()),t[y].observe(t,{childList:!0,subtree:!0}),l.A.add(t)))};(async()=>{await(0,i.D)();const t=window.Stories.show;window.Stories.show=function(...e){const o=t(...e);try{b()}catch(t){console.error(t)}return o}})().catch(console.error),(async()=>{const t=await(0,c.R2)();t.onLocationChange(async()=>{await(0,s.t)();const e=t.objLoc.w?.startsWith("story");e&&b()})})().catch(console.error),w(t=>{t&&b()})},41590:(t,e,o)=>{o.d(e,{d:()=>n});var r=o(50313);const n=()=>(0,r.A)("TopNotifier")},47812:(t,e,o)=>{o.d(e,{P:()=>n});var r=o(50313);const n=()=>(0,r.A)("ElementTooltip")},51669:(t,e,o)=>{o.d(e,{e:()=>n});var r=o(50313);const n=()=>(0,r.A)("uiActionsMenu")},54350:(t,e,o)=>{o.d(e,{$:()=>n});var r=o(50313);const n=()=>(0,r.A)("Calls")},56992:(t,e,o)=>{o.d(e,{X:()=>n});var r=o(50313);const n=()=>(0,r.A)("AudioUtils")},65748:(t,e,o)=>{o.d(e,{B:()=>n});var r=o(50313);const n=()=>(0,r.A)("ap")},71191:(t,e,o)=>{o.d(e,{K:()=>n});var r=o(50313);const n=()=>(0,r.A)("boxQueue")},79068:(t,e,o)=>{o.d(e,{A:()=>i});var r=o(51018),n=o(54251),s=o(48913);const a=new r.e;let c=!1;const i=t=>{const e=a.addListener(t);return(async t=>{c?await(0,s.e)():(c=!0,(0,n.A)("cur",t=>{for(const e of a.listeners)try{e(t)}catch(t){console.error(t)}})),t(window.cur)})(t),e}},99887:(t,e,o)=>{o.d(e,{s:()=>i});var r=o(51018),n=o(41590);const s=new r.e,a=async t=>{for(const e of s.listeners)e(t)};let c=!1;const i=t=>{const e=s.addListener(t);return(0,n.d)().then(t=>a(t)),c||(c=!0,(async()=>{let t=await(0,n.d)();Object.defineProperty(window,"TopNotifier",{get:()=>t,set:e=>{t=e,a(e)}})})()),e}}}]);