"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[695,717],{695:(t,e,o)=>{o.d(e,{U:()=>n});var r=o(50313);const n=()=>(0,r.A)("colorScheme")},8906:(t,e,o)=>{o.d(e,{d:()=>n});var r=o(50313);const n=()=>(0,r.A)("Photoview")},18790:(t,e,o)=>{o.d(e,{$:()=>n});var r=o(50313);const n=()=>(0,r.A)("AudioPlayerUI")},25894:(t,e,o)=>{o.d(e,{R:()=>a});var r=o(63499),n=o(38651);const a=({audio:t,index:e})=>{let o=`${(0,n.A)(t)} - ${t.title}`;return t.subtitle&&(o+=` (${t.subtitle})`),"number"!=typeof e&&"string"!=typeof e||(o=`${e}. ${o}`),(0,r.A)(o.replaceAll("  "," ").trim())}},30956:(t,e,o)=>{o.d(e,{Ku:()=>r.K,R2:()=>n.R,VA:()=>a.V});o(99887),o(13536),o(91953),o(65748),o(18790),o(56992);var r=o(71191),n=(o(54350),o(695),o(48913),o(47812),o(37752),o(74501),o(91570)),a=(o(8906),o(38590),o(41590),o(51669),o(58310),o(3916),o(61054))},37752:(t,e,o)=>{o.d(e,{V:()=>n});var r=o(50313);const n=()=>(0,r.A)("getAudioPlayer")},38590:(t,e,o)=>{o.d(e,{D:()=>n});var r=o(50313);const n=()=>(0,r.A)("Stories")},41590:(t,e,o)=>{o.d(e,{d:()=>n});var r=o(50313);const n=()=>(0,r.A)("TopNotifier")},47812:(t,e,o)=>{o.d(e,{P:()=>n});var r=o(50313);const n=()=>(0,r.A)("ElementTooltip")},50130:(t,e,o)=>{o.r(e);var r=o(74848),n=o(95728),a=o(79110),i=o(22707),s=o(30956),c=o(98570),l=o(38729),d=o(58354),u=o(67767),p=o(2006),m=o(67078),A=o(3068),y=o(62879);const _=(0,l.NS)(),w=async(t,e,n)=>{if((0,c.A)()?.vms_installed)return;if(t.vkn_down_inj)return;t.vkn_down_inj=!0;const a=t.querySelector('.SecondaryAttachment__after,[data-testid="secondaryattachment-after"],[class*="SecondaryAttachment__after"]');if(!a)return;await(0,i.t)();const s=document.createElement("div"),l=a.querySelector('[data-task-click="SecondaryAttachment/addAudio"]');l?a.insertBefore(s,l):a.prepend(s);const{default:d}=await Promise.all([o.e(961),o.e(7397),o.e(1649),o.e(8414),o.e(150),o.e(459)]).then(o.bind(o,50150));await(0,A.A)({root:s,content:(0,r.jsx)(d,{type:"secondary_attachment",onClick:e,audioObject:n,tooltipProps:{placement:"top",appearance:"black",enableInteractive:!0}}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0})},f=async t=>{const{fiber:e}=(0,n.A)(t),a=e?.return?.return?.memoizedProps?.audio;if(!a)return;const i=t.querySelector(".vkuiButtonGroup__host");if(!i)return void console.error("[onAddPrimaryAttach] buttons not found");if(t.vkn_down_inj)return;t.vkn_down_inj=!0;const s=document.createElement("div");i.appendChild(s);const{default:c}=await Promise.all([o.e(961),o.e(7397),o.e(1649),o.e(8414),o.e(150),o.e(459)]).then(o.bind(o,50150));await(0,A.A)({root:s,content:(0,r.jsx)(c,{type:"primary_attachment",audioObject:a,tooltipProps:{placement:"bottom",appearance:"black",enableInteractive:!0}}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0})},v=t=>{const e=t.dataset.audio;if(!e)return;const o=window.AudioUtils.audioTupleToAudioObject(JSON.parse(e));o&&!o?.restrictionStatus&&o.url&&w(t,void 0,o)},h=t=>{w(t,async()=>{const e=[];t.dataset.ownerId&&e.push(t.dataset.ownerId),t.dataset.playlistId&&e.push(t.dataset.playlistId),t.dataset.accessKey&&e.push(t.dataset.accessKey),e.length?await(0,y.A)(e.join("_")):await(0,m.A)({type:"error",text:"playlist id not found"})}).catch(console.error)},b=async t=>{const{fiber:e}=(0,n.A)(t),o=e.return.return.return.return.return.return.memoizedProps.originalAttachment||e.return.return.return.return.return.memoizedProps.originalAttachment||e.return.return.return.return.memoizedProps.originalAttachment;if(o?.audio){const e=window.AudioUtils.audioTupleToAudioObject(o.audio);if(!e||e?.restrictionStatus)return;w(t,void 0,e)}if(o?.audio_playlist){const e=o.audio_playlist;w(t,async()=>{const t=[];e.owner_id&&t.push(e.owner_id),e.id&&t.push(e.id),e.access_key&&t.push(e.access_key),t.length?await(0,y.A)(t.join("_")):await(0,m.A)({type:"error",text:"playlist id not found"})}).catch(console.error)}},k=t=>{for(const e of t.querySelectorAll(".SecondaryAttachment[data-audio]"))v(e);for(const e of t.querySelectorAll(".SecondaryAttachment[data-playlist-id]"))h(e);for(const e of t.querySelectorAll('[class*="SecondaryAttachment__root"]'))b(e).catch(console.error);for(const e of t.querySelectorAll('[class*="SecondaryAttachmentList__root"]'))e[_]||(e[_]=new MutationObserver(t=>{for(const e of t)if("childList"===e.type&&e.addedNodes.length)for(const t of e.addedNodes)1===t.nodeType&&b(t).catch(console.error)}),e[_].observe(e,{childList:!0}),p.A.add(e));for(const e of t.querySelectorAll('[class*="PrimaryAttachmentAudio__container"]'))f(e)},P=async t=>{for(const e of t.querySelectorAll('[class*="MusicCell__musicCell"]')){const{fiber:t}=(0,n.A)(e),a=t?.return?.return?.return?.return?.return?.return?.return?.return?.memoizedProps?.audio?.entity?.apiAudio;if(!a)continue;if(e.vkn_down_inj)continue;e.vkn_down_inj=!0;const i=document.createElement("div");e.appendChild(i);const{default:s}=await Promise.all([o.e(961),o.e(7397),o.e(1649),o.e(8414),o.e(150),o.e(459)]).then(o.bind(o,50150));await(0,A.A)({root:i,content:(0,r.jsx)(s,{type:"audio_row_react",audioObject:a,tooltipProps:{placement:"top",appearance:"black",enableInteractive:!0}}),disableAppRoot:!0,disableConfig:!0,disableParentTransformForPositionFixedElements:!0})}};(0,c.A)()?.vms_installed||((0,u.A)(k),(0,d.A)(k),(0,s.Ku)().then(()=>{const t=window.boxQueue._show;window.boxQueue._show=function(...e){const o=Reflect.apply(t,window.boxQueue,e);try{const[t]=e,o=window._message_boxes[t];o?.boxLayoutNode&&requestAnimationFrame(()=>P(o.boxLayoutNode))}catch(t){console.error(t)}return o}}),(0,a.g)(()=>{const t=document.querySelector(".box_layout");t&&requestAnimationFrame(()=>P(t))}))},51669:(t,e,o)=>{o.d(e,{e:()=>n});var r=o(50313);const n=()=>(0,r.A)("uiActionsMenu")},54350:(t,e,o)=>{o.d(e,{$:()=>n});var r=o(50313);const n=()=>(0,r.A)("Calls")},56992:(t,e,o)=>{o.d(e,{X:()=>n});var r=o(50313);const n=()=>(0,r.A)("AudioUtils")},62879:(t,e,o)=>{o.d(e,{A:()=>b});var r=o(49032),n=o(37746),a=o(69926),i=o(88908),s=o(93819),c=o(67078),l=o(43024),d=o(69128),u=o(25894),p=o(94037),m=o(89481),A=o(63499);const y=new Set(["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"]),_="vknNewFolderCount",w=t=>{let e=(0,A.A)(t).replace(/[\r\n\t]/g," ").replace(/\s+/g," ");return e=e.trim().replace(/\.+$/,""),y.has(e.toUpperCase())&&(e=`${e}_safe`),e=e.substring(0,255),e||(()=>{try{const t=(Number(window.localStorage.getItem(_))||0)+1;return window.localStorage.setItem(_,String(t)),`folder (${t})`}catch(t){console.error(t)}return"folderMusic"})()};var f=o(84896),v=o(15991),h=o(64299);const b=async t=>{const e=await s.A;if(0===window.vk.id)return void(0,c.A)({text:e.use("vkcom_playlist_download_auth_required"),type:"error"});const A=await(0,m.A)({id:"playlist_music",startIn:"music"}),[y,_,b]=t.split("_");await(0,c.A)({text:e.use("vkcom_downloading")});const k=await(0,v.A)({owner_id:parseInt(y),playlist_id:parseInt(_),access_key:b,fixAudioUrl:!0});if(!k)return void await(0,c.A)({text:"Playlist not found",type:"error"});if(k?.error?.error_msg)return void await(0,c.A)({text:k.error.error_msg,type:"error"});if(!k.audios?.length)return void await(0,c.A)({text:e.use("vkcom_playlist_is_empty"),type:"error"});const P=new AbortController,{signal:g}=P,x=new Date,S=(k.main_artists||[]).map(t=>t.name),T=[];S.length&&T.push(`${S.join(", ")} - `),k.title?T.push(k.title):T.push("playlist");const C=w((0,i.A)(T.join(""))),j=`${C}.zip`,L=`playlist${t}`,{setProgress:O,startArchiving:M,finish:N,setExtraText:$}=(0,d.Hq)({id:L,title:A?C:`${(0,i.A)(T.join(""))}.zip`,type:"playlist",onCancel:()=>P.abort(),photoUrl:(0,f.Z)(k)||void 0}),q=new a.A(r.pz);let I=1,R=0;const U=k.audios.length;O({current:0,total:U});const F=l.default.getValue("numTracksInPlaylist"),z=async(t,o)=>{try{const r=await(0,h.u)({audio:t,playlist:k,signal:g});if(!r)return;const n=(0,u.R)({audio:t,index:F?o:void 0}),a={name:`${n}.mp3`,lastModified:t.date?new Date(1e3*t.date):x,input:r};return g.aborted||(R++,O({current:R,total:U})),$(e.use("vkcom_playlist_track_download_completed",{trackName:n})),A?await(0,p.A)({zipFile:a,subFolderName:C,dirHandle:A}):a}catch(t){console.error(t)}};for(const t of k.audios){const e=I++;q.addTask(()=>z(t,e))}const E=(await q.waitAll()).filter(t=>!!t);if(g.aborted)return;if(A)return $(e.use("vkcom_playlist_download_completed",{total:e.use("vkcom_tracks_plurals",R)})),await(0,c.A)({type:"done",text:e.use("vkcom_fs_music_playlist_done"),subtitle:C}),void N();$(""),M();const{downloadZip:K}=await o.e(1941).then(o.bind(o,71941)),Q=await K(E).blob(),V=URL.createObjectURL(Q),B=()=>(0,n.A)(V,j);await B(),N({onSave:B,onRemove:()=>URL.revokeObjectURL(V)}),$(e.use("vkcom_playlist_download_completed",{total:e.use("vkcom_tracks_plurals",R)}))}},63499:(t,e,o)=>{o.d(e,{A:()=>n});const r=/\/|\\|:|\*|\?|"|<|>|\||\+|%|@|@\\0/g;function n(t){return t.replaceAll(r,"_")}},64299:(t,e,o)=>{o.d(e,{u:()=>n});var r=o(56260);const n=async t=>{if(t.signal?.aborted)return null;if(!t.audio?.url)return null;try{return await(0,r.G)(t)}catch(t){console.error("error download audio",t)}return null}},65748:(t,e,o)=>{o.d(e,{B:()=>n});var r=o(50313);const n=()=>(0,r.A)("ap")},71191:(t,e,o)=>{o.d(e,{K:()=>n});var r=o(50313);const n=()=>(0,r.A)("boxQueue")},88908:(t,e,o)=>{o.d(e,{A:()=>n});const r=document.createElement("textarea"),n=t=>(r.innerHTML=t,r.innerText)},99887:(t,e,o)=>{o.d(e,{s:()=>c});var r=o(51018),n=o(41590);const a=new r.e,i=async t=>{for(const e of a.listeners)e(t)};let s=!1;const c=t=>{const e=a.addListener(t);return(0,n.d)().then(t=>i(t)),s||(s=!0,(async()=>{let t=await(0,n.d)();Object.defineProperty(window,"TopNotifier",{get:()=>t,set:e=>{t=e,i(e)}})})()),e}}}]);