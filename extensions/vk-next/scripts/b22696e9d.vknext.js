"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[459,2554],{2554:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.d(t,{default:()=>p});var r=n(74848),a=n(13012),i=n(76382),c=n(39107),s=n(96540),l=n(74225),u=n.n(l),d=n(90275),_=n(87675),h=n(3068),v=n(70459),m=n(47194),g=n(60930),k=e([_]);_=(k.then?(await k)():k)[0];const p=({player:e})=>{const t=(0,_.A)(),[n,o]=(0,s.useState)(null),[l,k]=(0,s.useState)(null===n);u()(async t=>{k(!0);const n=await(0,m.A)(e);t()&&(o(n),k(!1))},[]);return(0,r.jsx)(d.Ku,{placement:"top",actions:(()=>{if(l)return(0,r.jsx)(d.vH,{children:t.use("global_loading")});if(n?.qualities?.length){const{qualities:e,title:o}=n;return e.map(([e,n])=>{const[i,s]=n,l=`${e}_${s?1:0}`;return(0,r.jsx)(d.vH,{onClick:s?()=>(0,g.A)({url:i,title:o,quality:e}):void 0,rightIcon:s?(0,r.jsx)(c.m_M,{usePortal:(0,h.P)(),placement:"right",appearance:"accent",enableInteractive:!0,description:(0,r.jsx)("span",{className:v.A.VideoPlayerHlsWarning__text,children:t.use("vkcom_hls_video_warning")}),className:v.A.VideoPlayerHlsWarning__tooltip,offsetByMainAxis:0,maxWidth:320,children:(0,r.jsx)(a.B,{})},l):"mp4",href:s?void 0:i,download:s?void 0:`${o}_${e}p.mp4`,children:`${e}p`},l)})}return(0,r.jsx)(d.vH,{disabled:!0,children:t.use("global_not_found")})})(),children:(0,r.jsx)("div",{className:"videoplayer_controls_item videoplayer_btn",role:"button",tabIndex:0,"aria-label":t.use("global_download"),"aria-haspopup":"true","aria-expanded":"false",children:(0,r.jsx)("div",{className:`videoplayer_btn_icon ${v.A.VideoPlayerDownloadIcon}`,children:l?(0,r.jsx)(c.y$y,{}):(0,r.jsx)(i.q,{})})})})};o()}catch(e){o(e)}})},7646:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(74848),r=n(39107),a=n(42335);const i=({className:e,children:t,getRootRef:n,useScrollView:i,...c})=>i?(0,o.jsx)(r.guY,{getRootRef:n,className:(0,r.xWm)(a.A.ActionsMenu,e),children:t}):(0,o.jsx)("div",{ref:n,...c,className:(0,r.xWm)(a.A.ActionsMenu,e),children:t})},13012:(e,t,n)=>{n.d(t,{B:()=>a});var o=n(74848),r=(n(96540),n(22185));const a=e=>(0,o.jsx)(r.uC,{viewBox:"0 0 20 20",width:20,height:20,vkuiIconId:"hls_outline_20",vkuiAttrs:{fill:"none"},vkuiProps:e,children:(0,o.jsx)("path",{fill:"currentColor",d:"M3.25 12.89q0 .42-.23.65a.78.78 0 0 1-.58.22q-.37 0-.59-.22t-.22-.65V7.32q0-.42.22-.64a.8.8 0 0 1 .59-.23q.37 0 .59.22t.22.65v1.94h3.02V7.32q0-.42.22-.64a.8.8 0 0 1 .59-.23q.37 0 .59.22t.22.65v5.57q0 .42-.23.65a.78.78 0 0 1-.58.22q-.37 0-.59-.22t-.22-.65v-2.12H3.25zM8.572 7.32q0-.42.22-.64a.8.8 0 0 1 .59-.23q.37 0 .59.22t.22.65v4.86h1.74q.39 0 .6.2t.21.56q0 .35-.22.56-.21.2-.59.2h-2.55a.82.82 0 0 1-.57-.22q-.24-.22-.24-.6zM13.672 11.81q.14 0 .71.21t1.04.21q.43 0 .64-.2a.63.63 0 0 0 .22-.48q0-.42-.64-.66-.12-.05-.9-.3-1.04-.33-1.38-.78-.33-.46-.33-1.16 0-1.12.77-1.74.7-.56 1.79-.56.96 0 1.49.3.53.29.53.78 0 .33-.2.55a.67.67 0 0 1-.52.22q-.19 0-.78-.18-.33-.1-.6-.1a.83.83 0 0 0-.54.17.51.51 0 0 0-.2.42q0 .31.55.51.55.19.97.33.8.26 1.19.65.54.53.54 1.46 0 1.19-.79 1.82-.73.58-1.93.58-.86 0-1.55-.28-.84-.34-.84-.9 0-.36.2-.61a.67.67 0 0 1 .56-.26"})})},22860:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(74848),r=n(75623),a=n(39107),i=n(7646);const c=({children:e,actions:t,actionsMenuClassName:n,hideOnClick:c=!0,disabled:s=!1,useScrollView:l=!1,...u})=>s?e:(0,o.jsx)(r.A,{content:(0,o.jsx)(i.A,{useScrollView:l,className:(0,a.xWm)(n),children:t}),noBackground:!0,hideOnClick:c,...u,children:e})},24293:(e,t,n)=>{var o,r;n.d(t,{h:()=>o}),(r=o||(o={})).PREPARING="preparing",r.DOWNLOADING="downloading",r.FINISHED="finished",r.ARCHIVING="archiving"},32106:(e,t,n)=>{n.d(t,{_:()=>l});var o=n(92580),r=n(92046);let a,i=null,c=0;const s=async()=>{a||(a=(async()=>{if(await(0,r.c)(6e4),!i)return;const e=await i;e&&(0===c&&await(0,r.c)(1e4),0===c&&(i=null,e.remove()))})(),a.finally(()=>{a=null}))},l=async({onProgress:e,type:t,iframeURL:r="https://vknext.net/ffmpeg",...a})=>{const{promise:l,reject:u,resolve:d}=(0,o.Q)(),_="request-"+Math.random().toString(36).substr(2,9),h=await(e=>{if(i)return i;const{promise:t,resolve:n,reject:r}=(0,o.Q)();i=t;const a=document.querySelector(`iframe[src="${e}"]`);if(a)return n(a),t;const c=document.createElement("iframe");return c.src=e,c.style.setProperty("display","none","important"),c.onload=()=>n(c),c.onerror=r,(document.body||document.documentElement).appendChild(c),t})(r),{Bridge:v}=await n.e(2692).then(n.bind(n,42692)),m=new v(h.contentWindow,{prefix:"vknext-net-bridge"});return c++,m.on("progress",t=>{const n=t;n?.requestId===_&&e?.(n.progress,n.total)}),m.on("error",e=>{const t=e;t?.requestId===_&&(u(t?.error||"unknown error"),m.destroy(),c--,s())}),m.on("response",e=>{const t=e;t?.requestId===_&&(d(t.response),m.destroy(),c--,s())}),m.on("getBlob",e=>{const t=e;if(t?.requestId===_)return fetch(t.url).then(e=>e.blob())}),m.post(t,{...a,requestId:_}),l}},37746:(e,t,n)=>{n.d(t,{A:()=>a});const o=e=>{try{e.dispatchEvent(new MouseEvent("click"))}catch(t){const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}},r=async(e,t="download")=>{const n=document.createElement("a");n.download=t,n.rel="noopener",(globalThis?.chrome?.runtime?.id||globalThis?.browser?.runtime?.id)&&(n.target="_blank"),"string"==typeof e?(n.href=e,n.origin!==location.origin?await(async e=>{try{const t=await globalThis.fetch(e,{method:"HEAD"});return t.status>=200&&t.status<=299}catch(e){console.error(e)}return!1})(n.href)?await(async(e,t)=>{try{const n=await globalThis.fetch(e,{method:"GET"}),o=await n.blob();await r(o,t)}catch(e){console.error(e)}})(e,t):(n.target="_blank",o(n)):o(n)):(n.href=URL.createObjectURL(e),setTimeout(()=>{URL.revokeObjectURL(n.href)},4e4),setTimeout(()=>{o(n)},0))},a=r},42335:(e,t,n)=>{n.d(t,{A:()=>o});const o={ActionsMenu:"oXPVlZtlcjoi6d8e"}},44511:(e,t,n)=>{n.d(t,{A:()=>o});const o={ActionsMenuActionSeparator:"JUUAV9aJuLWPapUx"}},47194:(e,t,n)=>{n.d(t,{A:()=>a});const o=/<Representation .*? ?height="(.+?)".*?<BaseURL>(.+?)<\/BaseURL>.*?<\/Representation>/g,r=/,RESOLUTION=.+?x(\d+),?.*?\n(.+?)(\n|$)/g;const a=async function(e){const t={};if(e.manifest)try{for(const[,n,r]of e.manifest.matchAll(o))!r||isNaN(+n)||t[+n]||(t[+n]=[r.replaceAll("&amp;","&"),!1])}catch(e){console.error("can't parse manifest"),console.error(e)}if(e.hls_ondemand)try{const n=e.hls_ondemand.split("/").slice(0,-1).join("/")+"/",o=await fetch(e.hls_ondemand),a=await o.text();for(const[,e,o]of a.matchAll(r))!o||isNaN(+e)||t[+e]||(t[+e]=[n+o,!0])}catch(e){console.error("can't parse hls_ondemand"),console.error(e)}if(e.hls_raw)try{for(const[,n,o]of e.hls_raw.matchAll(r))!o||isNaN(+n)||t[+n]||(t[+n]=[o,!0])}catch(e){console.error("can't parse hls_raw"),console.error(e)}else if(e.hls)try{const n=await fetch(e.hls),o=await n.text(),a=new URL(e.hls).origin;for(const[,e,n]of o.matchAll(r)){if(!n||isNaN(+e)||t[+e])continue;const o=new URL(n,a).toString();t[+e]=[o,!0]}}catch(e){console.error("can't parse hls"),console.error(e)}for(const n of Object.keys(e)){if(!n.startsWith("url"))continue;const o=+n.slice(3);isNaN(o)||(t[+o]=[e[n],!1])}const n=[],a=[];for(const e of Object.keys(t).map(e=>+e).sort((e,t)=>e>t?1:e<t?-1:0))a.includes(t[e])||(a.push(t[e]),n.unshift([e,t[e]]));return{title:e.md_title,qualities:n}}},49032:(e,t,n)=>{n.d(t,{Fl:()=>i,XZ:()=>a,hj:()=>r,lz:()=>o,pz:()=>s});const o=/(^|\/)al_im\.php|(^|\/)im(\?|$)|(^|\/)gim\d+|\/write-?\d+/,r=/(^|\/)al_im\.php|(^|\/)im(\?|$)|\/write-?\d+|\/im\/.*/,a={"--accent":"--vkui--color_icon_accent","--background_content":"--vkui--color_background_content","--background_highlighted":"--vkui--color_transparent--active","--background_hover":"--vkui--color_transparent--hover","--background_light":"--vkui--color_background_tertiary","--background_page":"--vkui--color_background","--background_suggestions":"--vkui--color_background_modal","--button_commerce_background":"--vkui--color_text_positive","--button_secondary_background":"--vkui--color_background_secondary_alpha","--button_secondary_destructive_foreground":"--vkui--color_background_negative","--content_tint_background":"--vkui--color_background_secondary","--content_warning_background":"--vkui--color_background_warning","--counter_prominent_text":"--vkui--color_text_contrast","--destructive":"--vkui--color_text_negative","--dynamic_gray":"--vkui--color_accent_gray","--dynamic_green":"--vkui--color_accent_green","--dynamic_orange":"--vkui--color_accent_orange","--dynamic_purple":"--vkui--color_accent_purple","--dynamic_red":"--vkui--color_accent_red","--dynamic_violet":"--vkui--color_accent_violet","--dynamic_blue":"--vkui--color_accent_blue","--dynamic_raspberry_pink":"--vkui--color_accent_raspberry_pink","--field_background":"--vkui--color_field_background","--field_border":"--vkui--color_field_border_alpha","--field_error_background":"--vkui--color_background_negative_tint","--field_error_border":"--vkui--color_stroke_negative","--field_valid_border":"--vkui--color_stroke_positive","--header_background":"--vkui--color_header_background","--header_tint_alternate":"--vkui--color_icon_accent_themed","--icon_alpha_placeholder":"--vkui--color_icon_contrast","--icon_medium_alpha":"--vkui--color_icon_medium_alpha","--icon_medium":"--vkui--color_icon_medium","--icon_secondary_alpha":"--vkui--color_icon_secondary_alpha","--icon_secondary":"--vkui--color_icon_secondary","--icon_tertiary_alpha":"--vkui--color_icon_tertiary_alpha","--icon_tertiary":"--vkui--color_icon_tertiary","--image_border":"--vkui--color_image_border_alpha","--input_background":"--vkui--color_write_bar_input_background","--input_border":"--vkui--color_write_bar_input_border_alpha","--link_alternate":"--vkui--color_text_link_themed","--loader_track_fill":"--vkui--color_track_background","--loader_track_value_fill":"--vkui--color_track_buffer","--placeholder_icon_background_opaque":"--vkui--color_image_placeholder_alpha","--placeholder_icon_background":"--vkui--color_image_placeholder","--search_bar_field_background":"--vkui--color_search_field_background","--segmented_control_bar_background":"--vkui--color_segmented_control","--separator_alpha":"--vkui--color_separator_primary_alpha","--separator_alternate":"--vkui--color_separator_secondary","--separator_common":"--vkui--color_separator_primary","--skeleton_foreground_from":"--vkui--color_skeleton_from","--skeleton_foreground_to":"--vkui--color_skeleton_to","--text_link":"--vkui--color_text_link","--text_muted":"--vkui--color_text_muted","--text_primary":"--vkui--color_text_primary","--text_secondary":"--vkui--color_text_secondary","--text_subhead":"--vkui--color_text_subhead","--text_tertiary":"--vkui--color_text_tertiary","--writebar_icon":"--vkui--color_write_bar_icon","--gray_400":"--vkui--color_text_secondary","--gray_500":"--vkui--color_text_subhead","--gray_600":"--vkui--color_text_subhead","--gray_900":"--vkui--color_text_muted","--im_forward_line_tint":"--vkui--vkontakte_color_im_forward_line_alpha","--im_bubble_incoming":"--vkui--vkontakte_color_im_bubble_incoming","--im_bubble_incoming_alternate":"--vkui--vkontakte_color_im_bubble_incoming_alternate","--im_bubble_incoming_expiring":"--vkui--vkontakte_color_im_bubble_incoming_expiring","--im_bubble_border_alternate_highlighted":"--vkui--vkontakte_color_im_bubble_border_alternate_highlighted_alpha","--modal_card_background":"--vkui--color_background_modal","--im_bubble_outgoing":"--vkui--vkontakte_color_im_bubble_outgoing"},i=1e3,c=globalThis.navigator.hardwareConcurrency||1,s=Math.max(1,Math.floor(c/2))},52079:(e,t,n)=>{e.exports=n(97273)},53339:(e,t,n)=>{n.d(t,{A:()=>o});const o={ActionsMenuAction:"Qz12flm1ckhwWMRi","ActionsMenuAction--clickable":"zqSAHhp0mZkpJyJv","ActionsMenuAction--loading":"maWKomPpZn38CGdY",ActionsMenuAction__title:"f5DiFbY0HMzfonGH","ActionsMenuAction--hover":"eArigbMXC9scSDcE","ActionsMenuAction--active":"dKO8yhdsvq5OQaLB","ActionsMenuAction--size-mini":"_RpwxXrwB9cHW9y9","ActionsMenuAction--size-regular":"JSPJNQnfc0rmrUKc","ActionsMenuAction--size-large":"Kz6XOr7wirTW6rZ_","ActionsMenuAction--size-max":"I5pyzjxjokMaCjf_",ActionsMenuAction__icon:"CIshpRBaU1ScuMSN","ActionsMenuAction--primary":"shY5I45XLLb2peEz","ActionsMenuAction--secondary":"CHnF5e3RJGJOddfX","ActionsMenuAction--danger":"bdbcNwBFv_xx4hSf","ActionsMenuAction--warning":"dIPqyT74MfEGnvhg",ActionsMenuAction__subtitle:"Z9G_cg7qHFwNychh","ActionsMenuAction--multiline":"rdni9aRD2DN3OfDv"}},60930:(e,t,n)=>{n.d(t,{A:()=>u});var o=n(49032),r=n(37746),a=n(69926),i=n(88908),c=n(74732),s=n(69128);const l=/#EXTINF:.+?\n(.+?)\n/g,u=async({url:e,title:t,quality:u})=>{const d=new AbortController,{signal:_}=d;let h=(0,i.A)(`${t}_${u}p.mp4`);const{setProgress:v,startArchiving:m,finish:g,setTitle:k}=(0,s.Hq)({id:"hls_video",title:h,type:"hls_video",onCancel:()=>d.abort()});try{const t=await(0,c.A)(e,h),n=URL.createObjectURL(t),o=()=>(0,r.A)(n,h),a=()=>URL.revokeObjectURL(n);return await o(),void g({onSave:o,onRemove:a})}catch(e){console.error(e)}h=(0,i.A)(`${t}_${u}p.zip`),k(h);const p=e.split("/").slice(0,-1).join("/")+"/",f=await fetch(e,{signal:_});let b=await f.text();const A=[...b.matchAll(l)];let y=0;v({current:y,total:A.length});const w=new Date,x=new a.A(o.pz),M=async(e,t)=>{if(_.aborted)return;const[,n]=e,o=await fetch(p+n,{signal:_});if(!o.body)throw new Error;const r=await o.arrayBuffer(),a="chunks/"+`${"0".repeat(A.length.toString().length)}${t+1}`.slice(-A.length.toString().length)+"."+n.split(".").reverse()[0];return b=b.replace(n,a),_.aborted||(y++,v({current:y,total:A.length})),{name:a,lastModified:w,input:new Blob([r])}};let S=0;for(const e of A)x.addTask(()=>M(e,S)),S++;const R=(await x.waitAll()).filter(e=>!!e);if(R.push({name:"index.m3u8",lastModified:w,input:new Blob([b])}),_.aborted)return;m();const{downloadZip:E}=await n.e(1941).then(n.bind(n,71941)),N=await E(R).blob(),j=URL.createObjectURL(N),C=()=>(0,r.A)(j,h);await C(),g({onSave:C,onRemove:()=>URL.revokeObjectURL(j)})}},61166:(e,t,n)=>{n.d(t,{A:()=>o});const o={PopoverReforged:"V5vFILKwsuTAoDXp","reforged-anim-fade-in":"aKnVnnmt_OsWj600","reforged-anim-fade-out":"uvPWUxQQgpV6cgFC","PopoverReforged--noBackground":"h4DVtB6f3FyJCExI"}},62882:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(74848),r=n(39107),a=n(53339);const i={mini:a.A["ActionsMenuAction--size-mini"],large:a.A["ActionsMenuAction--size-large"],regular:a.A["ActionsMenuAction--size-regular"],max:a.A["ActionsMenuAction--size-max"]},c={primary:a.A["ActionsMenuAction--primary"],secondary:a.A["ActionsMenuAction--secondary"],danger:a.A["ActionsMenuAction--danger"],warning:a.A["ActionsMenuAction--warning"]},s=({leftIcon:e,rightIcon:t,title:n,subtitle:s,type:l="secondary",size:u="regular",isActive:d=!1,hasHover:_=!0,isLoading:h,className:v,onClick:m,titleClassName:g,getRootRef:k,href:p,Component:f=(p?"a":"button"),children:b,multiline:A=!1,...y})=>(0,o.jsxs)(f,{className:(0,r.xWm)(a.A.ActionsMenuAction,_&&a.A["ActionsMenuAction--hover"],(m||_||p)&&a.A["ActionsMenuAction--clickable"],c[l],h&&a.A["ActionsMenuAction--loading"],d&&a.A["ActionsMenuAction--active"],A&&a.A["ActionsMenuAction--multiline"],i[u],v),onClick:h?void 0:m,ref:k,href:p,...y,children:[e&&(0,o.jsx)("i",{className:a.A.ActionsMenuAction__icon,children:e}),(0,o.jsxs)("span",{title:n,className:(0,r.xWm)(a.A.ActionsMenuAction__title,g),children:[b,s&&(0,o.jsx)("span",{className:a.A.ActionsMenuAction__subtitle,children:s})]}),t&&(0,o.jsx)("i",{className:a.A.ActionsMenuAction__icon,children:t})]})},63989:(e,t,n)=>{n.d(t,{VZ:()=>o,fU:()=>a,oT:()=>r});class o extends Error{constructor(e){super(`Download task with ID ${e} not found.`),this.name="DownloadTaskNotFoundError"}}class r extends Error{constructor(e){super(`Download task with ID ${e} is already finished.`),this.name="DownloadTaskAlreadyFinishedError"}}class a extends Error{constructor(e){super(`Download task with ID ${e} has already timed out.`),this.name="DownloadTaskTimeoutError"}}},69106:(e,t,n)=>{n.d(t,{$:()=>i});var o=n(81621),r=n(24293),a=n(63989);const i=(0,o.vt)((e,t)=>{const n=e=>{const n=new Map(t().tasks).get(e);if(!n)throw new a.VZ(e);return n},o=t=>{e(e=>{const n=new Map(e.tasks),o=n.get(t);if(o?.onRemove)for(const e of o.onRemove)e();return n.delete(t),{tasks:n}})},i=i=>({setExtraText:t=>((t,o)=>{const r=n(t);e(e=>{const n=new Map(e.tasks);return n.set(t,{...r,extraText:o}),{tasks:n}})})(i,t),setPhotoUrl:t=>((t,o)=>{const r=n(t);e(e=>{const n=new Map(e.tasks);return n.set(t,{...r,photoUrl:o}),{tasks:n}})})(i,t),setTitle:t=>((t,o)=>{const r=n(t);e(e=>{const n=new Map(e.tasks);return n.set(t,{...r,title:o}),{tasks:n}})})(i,t),setProgress:o=>((o,i)=>{const c=n(o),s=new Map(t().tasks);if(c.status===r.h.FINISHED)throw new a.oT(o);e(()=>(s.set(o,{...c,progress:i,status:r.h.DOWNLOADING}),{tasks:s}))})(i,o),startArchiving:()=>(t=>{const o=n(t);e(e=>{const n=new Map(e.tasks);return n.set(t,{...o,status:r.h.ARCHIVING}),{tasks:n}})})(i),finish:t=>((t,i)=>{const c=n(t);if(c.status===r.h.FINISHED)throw new a.oT(t);if(c.timeoutId)throw new a.fU(t);const s=setTimeout(()=>o(t),60*(i?.onSave?15:5)*1e3);e(e=>{const n=new Map(e.tasks),o=new Set(c.onRemove);return i?.onRemove&&o.add(i.onRemove),n.set(t,{...c,onRemove:o,timeoutId:s,onSave:i?.onSave,status:r.h.FINISHED}),{tasks:n}})})(i,t),cancel:()=>(t=>{const o=n(t);for(const e of o.onCancel)e();e(e=>{const n=new Map(e.tasks);return n.delete(t),{tasks:n}})})(i),remove:()=>o(i)});return{tasks:new Map,startDownload:({id:t,onCancel:n,...o})=>{const a={...o,id:t,progress:{current:void 0,total:void 0},status:r.h.PREPARING,onCancel:new Set(n?[n]:[]),onRemove:new Set};e(e=>{const n=new Map(e.tasks);return n.set(t,a),{tasks:n}});const c=i(t);return{id:t,...c}},getTask:e=>{const t=n(e);return t?{...t}:void 0},getTaskHandlersById:i}})},69128:(e,t,n)=>{n.d(t,{Hq:()=>a,S:()=>s,_5:()=>c,cy:()=>i,hF:()=>r.h});var o=n(69106),r=n(24293);const a=e=>o.$.getState().startDownload(e),i=e=>o.$.getState().getTask(e),c=()=>(0,o.$)(e=>e.tasks),s=e=>(0,o.$)(e=>e.getTaskHandlersById)(e)},69926:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(92580);const r=class{maxConcurrency;runningCount=0;taskQueue=[];allTasks=[];constructor(e){this.maxConcurrency=e}addTask(e){const{promise:t,resolve:n,reject:r}=(0,o.Q)();this.allTasks.push(t);const a=async()=>{this.runningCount++;try{const t=await e();n(t)}catch(e){console.error(e),r(e)}this.runningCount--,await this.runNext()};this.runningCount<this.maxConcurrency?a():this.taskQueue.push(a)}async runNext(){if(this.runningCount>=this.maxConcurrency)return;const e=this.taskQueue.shift();e&&await e()}async waitAll(){return await Promise.all(this.allTasks)}}},70459:(e,t,n)=>{n.d(t,{A:()=>o});const o={AudioPageMainTabBtn:"XYzoAKWs2KhH02Ye",AudioArtistHeaderActions:"v8VBorduCtZgTyyi",VideoPlayerDownloadIcon:"eaSw45y_1KLlo4Gw",SecondaryAttachment__afterItem:"RZ6NWD1WvjAOxG2Y",DownloadManagerPopup:"o9vy1XhnZrkvykUb",VideoPlayerHlsWarning__tooltip:"P9MhdlrtilEQt7Am",VideoPlayerHlsWarning__text:"Xq2PVks6OK6Z74Al",AudioPlaylistSnippet__actions:"FawmW4_Zd1R1BI1E",AudioPlaylistSnippet__actionButton:"ZPr5mXzL52VUPaRe",ActionButton__icon:"_5bFyslOmNjqqP7y",ActionButton__text:"o7YAH98fI9KVToa5",AudioPlayerUserControlsContainer__userButton:"e47qq1XqMPp6oTp7",AudioPlayerPlaybackButton:"wqb5e3cgYZFgHCc1",AudioRowReact__button:"q7d6KTdMjs6HYpKm",PrimaryButton:"Ovh62QE6FZgmlVq8"}},72257:(e,t,n)=>{e.exports=n(72518)},72518:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var o=n(96540);var r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},a=o.useState,i=o.useEffect,c=o.useLayoutEffect,s=o.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),o=a({inst:{value:n,getSnapshot:t}}),r=o[0].inst,u=o[1];return c(function(){r.value=n,r.getSnapshot=t,l(r)&&u({inst:r})},[e,n,t]),i(function(){return l(r)&&u({inst:r}),e(function(){l(r)&&u({inst:r})})},[e]),s(n),n};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:u},74225:(e,t,n)=>{var o=n(96540);function r(e,t,n){var r="function"==typeof t;o.useEffect(function(){var n,o=!0,a=e(function(){return o});return Promise.resolve(a).then(function(e){n=e}),function(){o=!1,r&&t(n)}},r?n:t)}e.exports=r,e.exports.useAsyncEffect=r},74732:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(32106);const r=async(e,t)=>{const n=await(0,o._)({url:e,filename:t,type:"convertM3u8ToMp4"});return new File([n],t,{type:"video/mp4"})};var a=n(36008);const i=async(e,t)=>(await a.default.sendMessage("vkn-b-aath",new URL(e).origin+"/*"),await r(e,t))},75623:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(74848),r=n(39107),a=n(96540),i=n(61166);const c=({hideOnClick:e=!1,noBackground:t=!1,mode:n,onClick:c,onShownChange:s,className:l,contentWrapperClassName:u,shown:d,content:_,...h})=>{const[v,m]=(0,a.useState)(!1),g=(0,a.useRef)(null),k=(0,a.useRef)(null),p=(0,a.useCallback)(e=>{e?m(!0):g.current=setTimeout(()=>{m(!1)},100),s?.(e)},[n,s,m]);return(0,a.useEffect)(()=>{"boolean"==typeof d&&p(d)},[d,p]),(0,o.jsx)(r.AMh,{shown:v,className:(0,r.xWm)(i.A.PopoverReforged,t&&i.A["PopoverReforged--noBackground"],l),onShownChange:p,onClick:e=>{if("side"===n&&g.current)clearTimeout(g.current);else try{c?.(e)}catch(e){console.error(e)}},content:(0,o.jsx)("div",{ref:k,className:(0,r.xWm)(u),onClick:t=>{e&&k.current?.contains(t.target)&&m(!1)},children:_}),...h})}},76382:(e,t,n)=>{n.d(t,{q:()=>o});var o=(0,n(78414).mT)("Icon24DownloadOutline","download_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="download_outline_24"><path fill-rule="evenodd" d="M12.002 2a.9.9 0 0 1 .9.9v11.002l4.562-4.631a.9.9 0 1 1 1.283 1.263l-6.104 6.195a.9.9 0 0 1-1.284-.001l-6.09-6.206a.9.9 0 1 1 1.286-1.26l4.547 4.633V2.9a.9.9 0 0 1 .9-.9m-8 18.1a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8h-14.2a.9.9 0 0 1-.9-.9" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},81621:(e,t,n)=>{n.d(t,{vt:()=>_});const o=e=>{let t;const n=new Set,o=(e,o)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=o?o:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,a={setState:o,getState:r,getInitialState:()=>i,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},i=t=e(o,r,a);return a},r=e=>e?o(e):o;var a=n(96540),i=n(52079);const{useDebugValue:c}=a,{useSyncExternalStoreWithSelector:s}=i;let l=!1;const u=e=>e;const d=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?r(e):e,n=(e,n)=>function(e,t=u,n){n&&!l&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),l=!0);const o=s(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return c(o),o}(t,e,n);return Object.assign(n,t),n},_=e=>e?d(e):d},83558:(e,t,n)=>{n.d(t,{A:()=>i});var o=n(74848),r=n(39107),a=n(44511);const i=({getRootRef:e,className:t,...n})=>(0,o.jsx)("div",{role:"separator",className:(0,r.xWm)(a.A.ActionsMenuActionSeparator,t),ref:e,...n})},87675:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.d(t,{A:()=>a});var r=n(93819);const e=await r.A,a=()=>e;o()}catch(e){o(e)}},1)},88908:(e,t,n)=>{n.d(t,{A:()=>r});const o=document.createElement("textarea"),r=e=>(o.innerHTML=e,o.innerText)},90275:(e,t,n)=>{n.d(t,{AS:()=>r.A,Ku:()=>a.A,vH:()=>o.A});n(7646);var o=n(62882),r=n(83558),a=n(22860)},97273:(e,t,n)=>{
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var o=n(96540),r=n(72257);var a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=r.useSyncExternalStore,c=o.useRef,s=o.useEffect,l=o.useMemo,u=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,o,r){var d=c(null);if(null===d.current){var _={hasValue:!1,value:null};d.current=_}else _=d.current;d=l(function(){function e(e){if(!s){if(s=!0,i=e,e=o(e),void 0!==r&&_.hasValue){var t=_.value;if(r(t,e))return c=t}return c=e}if(t=c,a(i,e))return t;var n=o(e);return void 0!==r&&r(t,n)?(i=e,t):(i=e,c=n)}var i,c,s=!1,l=void 0===n?null:n;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,n,o,r]);var h=i(e,d[0],d[1]);return s(function(){_.hasValue=!0,_.value=h},[h]),u(h),h}}}]);