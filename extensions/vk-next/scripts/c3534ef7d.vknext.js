"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[217],{90217:(e,t,n)=>{n.d(t,{CheckCaptchaType:()=>x,checkCaptchaError:()=>G});var r="type_2",o="popup",i={ru:"0",uk:"1",en:"3",es:"4",de:"6",pl:"15",fr:"16",uz:"65",tr:"82",kk:"97",be:"114"};function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){var t,n,r,o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=this,n="events",o=o||Object.create(null),r={on:function(e,t){(o[e]||(o[e]=[])).push(t)},off:function(e,t){o[e]&&o[e].splice(o[e].indexOf(t)>>>0,1)},emit:function(e,t){(o[e]||[]).slice().map(function(e){e(t)}),(o["*"]||[]).slice().map(function(n){n(e,t)})}},n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r}var t,n,r;return t=e,(n=[{key:"on",value:function(e,t){return this.events.on(e,t),this}},{key:"off",value:function(e,t){return this.events.off(e,t),this}}])&&a(t.prototype,n),r&&a(t,r),e}(),s=function(e){return e.MESSAGE="message",e.UNSUPPORTED_MESSAGE="unsupported_message",e}({});function u(e,t,n){return t=f(t),function(e,t){if(t&&("object"==(n=t,n&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;var n;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,v()?Reflect.construct(t,n||[],f(e).constructor):t.apply(e,n))}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},f(e)}function d(e,t){return d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},d(e,t)}function v(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(v=function(){return!!e})()}var p="vk-sak-sdk",m=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),h(n=u(this,t),"config",void 0),n.config=e,n.handleMessage=n.handleMessage.bind(n),window.addEventListener("message",n.handleMessage),n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(t,e),n=t,r=[{key:"destroy",value:function(){delete this.config,window.removeEventListener("message",this.handleMessage)}},{key:"sendMessage",value:function(e){var t;null===(t=this.config.iframe.contentWindow)||void 0===t||t.postMessage(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){h(e,t,n[t])})}return e}({type:p},e),this.config.origin)}},{key:"handleMessage",value:function(e){var t;this.config.origin&&e.origin===this.config.origin&&e.source===this.config.iframe.contentWindow&&(null===(t=e.data)||void 0===t?void 0:t.type)===p?this.events.emit(s.MESSAGE,e.data):this.events.emit(s.UNSUPPORTED_MESSAGE,e.data)}}],r&&l(n.prototype,r),o&&l(n,o),t}(c);function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),b(this,"store",{})}var t,n,r;return t=e,n=[{key:"init",value:function(e){return this.set(e),this}},{key:"update",value:function(e){return this.set(e)}},{key:"set",value:function(e){return this.store=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){b(e,t,n[t])})}return e}({},this.store,e),this}},{key:"get",value:function(){return this.store}}],n&&y(t.prototype,n),r&&y(t,r),e}(),O=function(e){return e.CURSOR="cursor",e.TAPS="taps",e}({});var E=((e,t=21)=>(n=t)=>{let r="",o=0|n;for(;o--;)r+=e[Math.random()*e.length|0];return r})("qazwsxedcrfvtgbyhnujmikol",6),w=function(e){return e.LOADING="loading",e.LOADED="loaded",e.NOT_LOADED="not_loaded",e}({}),S=function(e){return e[e.TimeoutExceeded=0]="TimeoutExceeded",e[e.InternalError=1]="InternalError",e[e.AuthError=2]="AuthError",e}({}),T=function(e){return e.INIT="init",e.MOUSE_CHANGE="mouseChange",e.TOUCH_CHANGE="touchChange",e}({});function k(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _,C=(k(_={},S.TimeoutExceeded,"timeout"),k(_,S.InternalError,"internal error"),k(_,S.AuthError,"auth error"),_),P=function(e){return e.START_LOAD="common: start load",e.LOAD="common: load",e.SHOW="common: show",e.HIDE="common: hide",e.CLOSE="common: close",e.ERROR="common: error",e.RESIZE="common: resize",e}({}),j=function(e){return e.GET_RESULT="VKCaptchaGetResult",e.CLOSE="VKCaptchaCloseCaptcha",e.SENSORS_START="VKCaptchaListenSensorsStart",e.SEND_SENSORS="VKCaptchaListenSensorsChanged",e.SEND_WEB_SENSORS="VKCaptchaListenSensorsWebChanged",e.SENSORS_STOP="VKCaptchaListenSensorsStop",e.USER_CLOSE="VKCaptchaUserClose",e}({}),R=function(e,t){return'\n<div id="'.concat(e,'" data-test-id="captcha-widget">\n  <style>\n    #').concat(e," {").concat(t===o?"\n      position: fixed;\n      top: 0;\n      left: 0;\n      z-index: 9999;":"","\n      width: 100%;\n      height: 100%;\n      max-width: 100%;\n      max-height: 100%;\n    }\n\n    #").concat(e," iframe {\n      border: none;\n      color-scheme: auto;\n    }\n\n    #").concat(e," .loader,\n    #").concat(e,' .error {\n      display: none;\n      width: 100%;\n      height: 100%;\n      text-align: center;\n    }\n  </style>\n  <div class="loader"></div>\n  <div class="error"></div>\n  <iframe width="100%" height="100%"></iframe>\n</div>\n  ')};function L(e,t,n){return t=I(t),function(e,t){if(t&&("object"==(n=t,n&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)||"function"==typeof t))return t;var n;return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,U()?Reflect.construct(t,n||[],I(e).constructor):t.apply(e,n))}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function A(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},I(e)}function D(e,t){return D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},D(e,t)}function U(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(U=function(){return!!e})()}var N=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),A(e=L(this,t),"id",E()),A(e,"scheme",void 0),A(e,"langId",void 0),A(e,"config",void 0),A(e,"timeoutTimer",void 0),A(e,"bridge",void 0),A(e,"container",void 0),A(e,"iframeSrc",void 0),A(e,"traceId",void 0),A(e,"captchaType",void 0),A(e,"autofocus",void 0),A(e,"view",void 0),A(e,"onClose",void 0),A(e,"templateRenderer",R),A(e,"promise",void 0),A(e,"promiseResolve",void 0),A(e,"promiseReject",void 0),A(e,"elements",void 0),A(e,"checkIsObserverChallengeAvailable",function(){return e.captchaType===r&&!!e.traceId&&!!window._vkObserverChallenge}),A(e,"getIframeCoords",function(){var t=e.elements.iframe.getBoundingClientRect(),n=t.left,r=t.top;return{left:n+window.scrollX,top:r+window.scrollY}}),A(e,"sendSensorsData",function(t){var n=t.eventType,r=t.data;e.bridge.sendMessage({handler:j.SEND_WEB_SENSORS,params:{eventType:n,data:r,coords:e.getIframeCoords()}})}),A(e,"handleMouseMove",function(t){var n=t.pageX,r=t.pageY;e.sendSensorsData({eventType:T.MOUSE_CHANGE,data:{pageX:n,pageY:r}})}),A(e,"handleTouchMove",function(t){var n=t.touches[0];if(n){var r=n.pageX,o=n.pageY;e.sendSensorsData({eventType:T.TOUCH_CHANGE,data:{pageX:r,pageY:o}})}}),e.config=(new g).init(n),e}var n,a,c;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,e),n=t,(a=[{key:"update",value:function(e){return this.config.update(e)}},{key:"show",value:function(e){var t=this,n=e.container,a=e.iframeSrc,c=e.traceId,s=e.requestUrl,u=e.captchaType,l=e.view,h=e.autofocus,f=e.scheme,d=e.lang,v=e.onClose;this.promise=new Promise(function(e,n){t.promiseResolve=e,t.promiseReject=n}),this.container=n,this.iframeSrc=a,this.traceId=c,this.view=u===r?o:l,this.captchaType=u,this.autofocus=null==h||h,this.scheme=f,this.langId=d?i[d]:void 0,this.onClose=v;var p=function(){t.renderTemplate(),t.registerElements(),t.loadWidgetFrame()};return this.checkIsObserverChallengeAvailable()?window._vkObserverChallenge.init({id:c,primary:!0,requestUrl:s,onOpen:p,onSuccess:this.promiseResolve,onFail:this.promiseReject}):p(),this.promise}},{key:"close",value:function(){var e,t,n,r,o;clearTimeout(this.timeoutTimer),this.removeAnalyticsMouseListeners(),this.removeAnalyticsTouchListeners(),null===(t=this.elements)||void 0===t||null===(e=t.root)||void 0===e||e.remove(),null===(n=this.bridge)||void 0===n||n.destroy(),this.events.emit(P.CLOSE),this.checkIsObserverChallengeAvailable()?window._vkObserverChallenge.onFail({id:this.traceId,error:"close"}):null===(o=this.promiseReject)||void 0===o||o.call(this,"close"),null===(r=this.onClose)||void 0===r||r.call(this)}},{key:"addAnalyticsMouseListeners",value:function(){document.addEventListener("mouseenter",this.handleMouseMove),document.addEventListener("mouseleave",this.handleMouseMove),document.addEventListener("mousemove",this.handleMouseMove)}},{key:"removeAnalyticsMouseListeners",value:function(){document.removeEventListener("mouseenter",this.handleMouseMove),document.removeEventListener("mouseleave",this.handleMouseMove),document.removeEventListener("mousemove",this.handleMouseMove)}},{key:"addAnalyticsTouchListeners",value:function(){document.addEventListener("touchstart",this.handleTouchMove),document.addEventListener("touchend",this.handleTouchMove),document.addEventListener("touchmove",this.handleTouchMove)}},{key:"removeAnalyticsTouchListeners",value:function(){document.removeEventListener("touchstart",this.handleTouchMove),document.removeEventListener("touchend",this.handleTouchMove),document.removeEventListener("touchmove",this.handleTouchMove)}},{key:"onLoadHandler",value:function(){var e=this;clearTimeout(this.timeoutTimer),setTimeout(function(){e.setState(w.LOADED)},300),this.events.emit(P.LOAD)}},{key:"onErrorHandler",value:function(e){var t,n,r;clearTimeout(this.timeoutTimer),this.setState(w.NOT_LOADED),this.events.emit(P.ERROR,e),null===(n=this.elements)||void 0===n||null===(t=n.iframe)||void 0===t||t.remove(),this.checkIsObserverChallengeAvailable()?window._vkObserverChallenge.onFail({id:this.traceId,error:e.text}):null===(r=this.promiseReject)||void 0===r||r.call(this,e.text)}},{key:"onBridgeMessageHandler",value:function(e){switch(e.handler){case P.LOAD:this.onLoadHandler();break;case j.CLOSE:case P.CLOSE:this.close();break;case P.ERROR:this.onErrorHandler({code:S.InternalError,text:C[S.InternalError],details:e.params});break;case P.RESIZE:this.elements.root.style.height="".concat(e.params.height,"px");break;case j.GET_RESULT:var t=e.params.token;this.checkIsObserverChallengeAvailable()?window._vkObserverChallenge.onSuccess({id:this.traceId,value:t}):this.promiseResolve(t);break;case j.SENSORS_START:var n=e.params.bridge_sensors_list,r=n.includes(O.CURSOR),o=n.includes(O.TAPS);(r||o)&&this.sendSensorsData({eventType:T.INIT}),r&&this.addAnalyticsMouseListeners(),o&&this.addAnalyticsTouchListeners();break;case j.SENSORS_STOP:this.removeAnalyticsMouseListeners(),this.removeAnalyticsTouchListeners();break;default:console.warn("Unknown captcha bridge event.")}}},{key:"renderTemplate",value:function(){this.container.insertAdjacentHTML("beforeend",this.templateRenderer(this.id,this.view))}},{key:"loadWidgetFrame",value:function(){var e=this,t=new URL(this.iframeSrc);this.bridge=new m({iframe:this.elements.iframe,origin:t.origin}),this.bridge.on(s.MESSAGE,function(t){return e.onBridgeMessageHandler(t)});var n=new URLSearchParams(t.search);switch(!0){case!!this.scheme:n.set("scheme",this.scheme);case!!this.langId:n.set("lang_id",this.langId);default:n.set("autofocus",this.autofocus?"1":"0");var o=location.protocol+"//"+location.hostname;n.set("origin",o),this.captchaType!==r&&n.set("variant",this.view)}t=new URL("".concat(t.origin).concat(t.pathname,"?").concat(n)),this.elements.iframe.src=t.href}},{key:"setState",value:function(e){this.elements.root.setAttribute("data-state",e)}},{key:"registerElements",value:function(){var e=document.getElementById(this.id);this.elements={root:e,iframe:e.querySelector("iframe")}}}])&&M(n.prototype,a),c&&M(n,c),t}(c),x=function(e){return e[e.TYPE_1="type_1"]="TYPE_1",e[e.TYPE_2=r]="TYPE_2",e.UNKNOWN="unknown",e}({});function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){H(e,t,n[t])})}return e}function W(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e}var G=function(e){var t=e.responseHeaders,n=e.url,r=e.responseError,o=e.withWidget,i=e.widgetConfig,a="required"===t.get("X-Challenge"),c=t.get("X-Challenge-Url"),s=t.get("X-Trace-Id"),u=a&&!!c,l=!!r&&"error_code"in r&&14===r.error_code,h=!!r&&"type"in r&&"captcha"===r.type,f=(l||h)&&!!r.redirect_uri,d=(l||h)&&!r.redirect_uri;if(u){var v="https://".concat(function(e){var t=e.replace("://www.","://"),n=new URL(t).hostname,r=n.split(".");return r.length>2?(r.shift(),r.join(".")):n}(n)).concat(c);if(!o)return{captchaType:x.TYPE_2,captchaUrl:v};var p=new N(i);return{captchaType:x.TYPE_2,captchaUrl:v,captchaWidget:{show:function(e){return p.show(W(Y({},e),{iframeSrc:v,traceId:s,captchaType:x.TYPE_2,requestUrl:n}))},close:function(){return p.close()},update:function(e){return p.update(e)}}}}if(f&&r.redirect_uri){var m=r.redirect_uri;if(!o)return{captchaType:x.TYPE_1,captchaUrl:m};var y=new N(i);return{captchaType:x.TYPE_1,captchaUrl:m,captchaWidget:{show:function(e){return y.show(W(Y({},e),{iframeSrc:m,captchaType:x.TYPE_1}))},close:function(){return y.close()},update:function(e){return y.update(e)}}}}return d?{captchaType:x.UNKNOWN}:{captchaType:null}};"undefined"!=typeof window&&(window._vkidCaptchaWidget=N,window._vkidCaptchaCheckError=G)}}]);