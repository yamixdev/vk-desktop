"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[5560,8218],{1003:(e,t,n)=>{n.d(t,{A:()=>o});const o=(e=window.location.pathname)=>{const t=e.match(/^\/?gim(\d+)/);return t&&t[1]?-parseInt(t[1]):window.vk.id}},12966:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(74848),a=n(39107),s=n(90435);const i=({mp4:e,className:t,...n})=>(0,o.jsx)("span",{className:(0,a.xWm)(s.A.GifBlock,t),...n,children:(0,o.jsx)("video",{muted:!0,autoPlay:!0,loop:!0,src:e,disablePictureInPicture:!0,controlsList:"nodownload"})});i.Skeleton=()=>(0,o.jsx)("span",{className:s.A.GifBlock});const r=i},15609:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(74848),a=n(75623),s=n(39107);const i="j5noyirksU4hOAMT",r="FT_f_JIawX_phtyc",c=({children:e})=>(0,o.jsx)(a.A,{trigger:"click",placement:"top-start",usePortal:document.body,shown:!0,defaultShown:!0,disableCloseOnClickOutside:!0,disableCloseOnEscKey:!0,content:e,className:i,children:(0,o.jsx)(s.s6o,{className:r})})},44497:(e,t,n)=>{n.d(t,{A:()=>o});const o=()=>{const e=window.location.pathname.match(/\/convo\/(-?\d+)/);if(e)return Number(e[1])||0;const t=new URLSearchParams(window.location.search),n=Number(t.get("sel"));return n||0}},50403:(e,t,n)=>{n.d(t,{A:()=>h});var o=n(92046),a=n(63499),s=n(85560),i=n(93819),r=n(52968),c=n(65879),d=n(44497),l=n(43024),u=n(43139);const h=async e=>{const t=await i.A,n=(0,d.A)(),h=await fetch(e.gif,{method:"GET"}).then(e=>e.arrayBuffer()),{upload_url:f}=await window.vkApi.api("docs.getMessagesUploadServer",{peer_id:window.cur?.peer||n,group_id:window.vkmeIntegration?Math.abs((0,r.A)()):0}),m=e.gif.split("/").at(-1);let w=(0,a.A)(m);w.endsWith(".gif")||(w+=".gif");const p=new FormData;p.append("file",new File([h],w,{type:"image/png"}));const g=await fetch(f,{method:"POST",body:p}).then(e=>e.json()),A=await window.vkApi.api("docs.save",g),v=A[A.type];if(document.getElementById("reforged-root")){const{store:e}=await(0,c.A)();e.dispatch({peerId:n,type:"UserChangedComposerDraft",kind:"addAttaches",attaches:{docs:[{kind:"Doc",id:v.id,ownerId:v.owner_id,title:v.title,size:v.size,ext:v.ext,type:"gif",date:v.date,url:v.url,isUnsafe:!!v.is_unsafe,image:new Map}]}});const a=l.default.getValue("inlineRemoveWatermark"),i=(0,u.Mf)();(0,u.t$)();const r=document.querySelector(".ConvoComposer__input");return r&&(r.textContent=await(0,s.default)()&&a?"":`via [club207165415|${t.use("global_app_name")}]`),await(0,o.c)(500),void(i&&i.click())}return await new Promise(e=>{const n=[v.owner_id,v.id,v.access_key].filter(Boolean).join("_"),o=window.cur.lastAddMedia.onChange;window.cur.lastAddMedia.onChange=async function(...n){const a=n[0];if(window.cur.lastAddMedia.onChange=o,o.apply(this,n),"doc"!==a)return;const i=(0,u.Ay)();i&&(i.classList.add("im-send-btn_audio"),i.classList.remove("im-send-btn_send"),i.classList.remove("im-send-btn_loading"),i.style.pointerEvents="");const r=l.default.getValue("inlineRemoveWatermark"),c=document.getElementsByClassName("im_editable")[0];if(c){const e=await(0,s.default)()&&r?"":`via [club207165415|${t.use("global_app_name")}]`;c.setValue(e),window.Emoji.editableFocus(c,!1,!0)}i&&i.click(),e(!0)},window.cur.lastAddMedia.chooseMedia("doc",n,{type:3,list:"",editable:{sizes:{s:["",0,0],m:["",0,0],x:["",0,0],o:["",0,0]}},hasBox:1,id:v.id,ownerId:v.owner_id,hash:"",ext:"gif",size:"",href:"",title:w})})}},52968:(e,t,n)=>{n.d(t,{A:()=>s});var o=n(7618),a=n(1003);const s=()=>{if(window.cur.gid&&o.z.isGroupId(window.cur.gid))return window.cur.gid;const e=(0,a.A)();return o.z.isGroupId(e)?e:0}},60254:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(96540),a=n(74225),s=n.n(a),i=n(88908),r=n(47875);const c=e=>{const[t,n]=(0,o.useState)(!0),[a,c]=(0,o.useState)(null),[d,l]=(0,o.useState)(null);return s()(async t=>{if(!t())return;n(!0),l(null),c(null);const o=(0,i.A)(e).trim(),{response:a,error:s}=await r.A.call("tenor.search",{q:o});t()&&(s&&l(s),a&&c(a),n(!1))},[e]),{isLoading:t,items:a,error:d}}},61166:(e,t,n)=>{n.d(t,{A:()=>o});const o={PopoverReforged:"V5vFILKwsuTAoDXp","reforged-anim-fade-in":"aKnVnnmt_OsWj600","reforged-anim-fade-out":"uvPWUxQQgpV6cgFC","PopoverReforged--noBackground":"h4DVtB6f3FyJCExI"}},63499:(e,t,n)=>{n.d(t,{A:()=>a});const o=/\/|\\|:|\*|\?|"|<|>|\||\+|%|@|@\\0/g;function a(e){return e.replaceAll(o,"_")}},68218:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.r(t),n.d(t,{default:()=>v});var a=n(74848),s=n(39107),i=n(96540),r=n(87675),c=n(15609),d=n(50403),l=n(9349),u=n(12966),h=n(90435),f=n(60254),m=e([r]);r=(m.then?(await m)():m)[0];const w=400,p=450,g=({children:e})=>(0,a.jsx)(s.guY,{className:h.A.GifPopover__content,style:{maxHeight:p,width:w},children:e}),A=({query:e})=>{const t=(0,r.A)(),{isLoading:n,items:o,error:c}=(0,f.A)(e),[m,A]=(0,i.useState)(!1);(0,i.useEffect)(()=>{null!==!o&&A(!1)},[o]);if(m)return(0,a.jsx)(s.OrA,{style:{width:w,height:p},children:t.use("vkcom_inline_sent")});if(n)return(0,a.jsx)(g,{children:(0,a.jsx)("div",{className:h.A.GifBlockList,children:new Array(9).fill(1).map((e,t)=>(0,a.jsx)(u.A.Skeleton,{},t))})});if(c)return(0,a.jsx)(s.OrA,{style:{width:w,height:p},children:c});return!(null===o)&&o.length>0?(0,a.jsx)(g,{children:(0,a.jsx)("div",{className:h.A.GifBlockList,children:o.map(e=>(0,a.jsx)(u.A,{mp4:e.nanomp4,onClick:()=>(async e=>{A(!0),await(0,d.A)(e),A(!1),(0,l.e8)()})(e)},e.id))})}):(0,a.jsx)(s.OrA,{style:{width:w,height:p},children:t.use("global_not_found")})},v=({query:e})=>(0,a.jsx)(c.A,{children:(0,a.jsx)(A,{query:e})});o()}catch(e){o(e)}})},74225:(e,t,n)=>{var o=n(96540);function a(e,t,n){var a="function"==typeof t;o.useEffect(function(){var n,o=!0,s=e(function(){return o});return Promise.resolve(s).then(function(e){n=e}),function(){o=!1,a&&t(n)}},a?n:t)}e.exports=a,e.exports.useAsyncEffect=a},75623:(e,t,n)=>{n.d(t,{A:()=>r});var o=n(74848),a=n(39107),s=n(96540),i=n(61166);const r=({hideOnClick:e=!1,noBackground:t=!1,mode:n,onClick:r,onShownChange:c,className:d,contentWrapperClassName:l,shown:u,content:h,...f})=>{const[m,w]=(0,s.useState)(!1),p=(0,s.useRef)(null),g=(0,s.useRef)(null),A=(0,s.useCallback)(e=>{e?w(!0):p.current=setTimeout(()=>{w(!1)},100),c?.(e)},[n,c,w]);return(0,s.useEffect)(()=>{"boolean"==typeof u&&A(u)},[u,A]),(0,o.jsx)(a.AMh,{shown:m,className:(0,a.xWm)(i.A.PopoverReforged,t&&i.A["PopoverReforged--noBackground"],d),onShownChange:A,onClick:e=>{if("side"===n&&p.current)clearTimeout(p.current);else try{r?.(e)}catch(e){console.error(e)}},content:(0,o.jsx)("div",{ref:g,className:(0,a.xWm)(l),onClick:t=>{e&&g.current?.contains(t.target)&&w(!1)},children:h}),...f})}},85560:(e,t,n)=>{n.d(t,{default:()=>s});var o=n(79384),a=n(52815);const s=async()=>{const e=await(0,a.A)(),t=(0,o.A)(e[0][1]),n=(0,o.A)(e[1][1]);return!!(107<=t&&t<=110&&107<=n&&n<=110)}},87675:(e,t,n)=>{n.a(e,async(e,o)=>{try{n.d(t,{A:()=>s});var a=n(93819);const e=await a.A,s=()=>e;o()}catch(e){o(e)}},1)},88908:(e,t,n)=>{n.d(t,{A:()=>a});const o=document.createElement("textarea"),a=e=>(o.innerHTML=e,o.innerText)},90435:(e,t,n)=>{n.d(t,{A:()=>o});const o={GifPopover__content:"RHwmOEd4_GKUxKyJ",GifBlock:"nIKAhlYJtFYXoLFk",GifBlock__skeleton:"mNLAXLviPYo4XFys",GifBlockList:"NGmV77DQp2DZotIa"}}}]);