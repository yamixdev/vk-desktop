"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[5105],{4760:(e,t,s)=>{s.d(t,{Q:()=>n});const n=(e,t=100)=>{const s=[...e],n=[];for(;s.length;)n.push(s.splice(0,t||s.length));return n}},30948:(e,t,s)=>{s.d(t,{$:()=>l,H:()=>d});var n=s(74848),a=s(96540),o=s(74225),r=s.n(o),i=s(1003);const c=(0,a.createContext)(null),l=()=>{const e=(0,a.useContext)(c);if(!e)throw new Error("useDeletedMessages must be used within a DeletedMessagesContext");return e},d=({children:e})=>{const[t,o]=(0,a.useState)(!1),[l,d]=(0,a.useState)(null);return r()(async e=>{const t=(0,i.A)(),n=(await s.e(367).then(s.bind(s,40367))).default,a=await n.getMessages(t,{});e()&&d(a)},[]),(0,n.jsx)(c.Provider,{value:{messages:l,setMessages:d,isPopoverShown:t,setIsPopoverShown:o},children:e})}},39854:(e,t,s)=>{s.a(e,async(e,n)=>{try{s.d(t,{A:()=>_});var a=s(74848),o=s(89230),r=s(7618),i=s(4760),c=s(39107),l=s(96540),d=s(74225),u=s.n(d),h=s(55517),g=s(87675),f=s(1003),w=s(30948),m=s(40473),p=e([g,m]);[g,m]=p.then?(await p)():p;const _=()=>{const e=(0,g.A)(),[t,n]=(0,l.useState)(!1),[d,p]=(0,l.useState)(null),[_,A]=(0,l.useState)([]),{messages:v,setIsPopoverShown:x}=(0,w.$)(),j=(0,h.A)(),b=(0,f.A)();return u()(async e=>{if(null===v)return;const t=(await s.e(1691).then(s.bind(s,31691))).default;if(!e())return;const a=Object.keys(v);if(!a.length)return n(!0);const o=[],c=new Set,l=new Set,d=[];for(const e of a){const s=await t.getMessages(`${b}_${e}`,[]);if(!s.length)continue;d.push(e);const n=s.at(-1);n&&(n.peer_id===j&&((r.z.isUserId(n.from_id)?c:l).add(Math.abs(n.from_id)),n.time=v[n.id].time,o.push(n)))}if(!e())return;if(!o.length)return n(!0);const u=[...c],h=[...l];let g=[],f=[];try{if(u.length>0){const e=(0,i.Q)(u,100).map(e=>window.vkApi.api("users.get",{user_ids:e.join(","),fields:"photo_50,image_status,screen_name"}));g=(await Promise.all(e)).flat()}if(h.length>0){const e=(0,i.Q)(h,100).map(e=>window.vkApi.api("groups.getById",{group_ids:e.join(","),fields:"photo_50,screen_name"})),t=(await Promise.all(e)).map(e=>e.groups).flat();t&&(f=t.groups)}}catch(e){console.error(e)}const w={};for(const e of g)e.name=`${e.first_name} ${e.last_name}`,e.screen_name||(e.screen_name=`id${e.id}`),w[e.id]=e;for(const e of f)e.screen_name||(e.screen_name=`club${e.id}`),w[-e.id]=e;e()&&(p(w),A(o))},[v,j]),(0,l.useEffect)(()=>{x(!t)},[t]),t?(0,a.jsx)(c.OrA,{children:e.use("global_not_found")}):_.length?(0,a.jsx)(m.A,{messages:_,users:d}):(0,a.jsx)(c.YJl,{children:[...Array(8).keys()].map(e=>(0,a.jsx)(o.A,{},e))})};n()}catch(e){n(e)}})},70668:(e,t,s)=>{s.a(e,async(e,n)=>{try{s.d(t,{A:()=>m});var a=s(74848),o=s(3178),r=s(39107),i=s(90275),c=s(99381),l=s(67078),d=s(55517),u=s(87675),h=s(1003),g=s(44497),f=s(30948),w=e([u]);u=(w.then?(await w)():w)[0];const m=()=>{const{setMessages:e,isPopoverShown:t,setIsPopoverShown:n}=(0,f.$)(),w=(0,u.A)(),m=(0,d.A)();return t?(0,a.jsx)(i.Ku,{actions:(0,a.jsx)(i.vH,{onClick:async()=>{const{default:t}=await s.e(367).then(s.bind(s,40367)),a=(await s.e(1691).then(s.bind(s,31691))).default,o=m||(0,g.A)(),r=(0,h.A)(),i=await a.getStorage(),c=await t.getMessages(r);for(const[e,t]of Object.entries(i))if(e.startsWith(r.toString())&&t[0]?.peer_id===o){delete i[e];for(const e of t)delete c[e.id]}await t.setMessages(r,c),await a.saveStorage(i),e({}),await(0,l.A)({type:"done",text:w.use("vkcom_deleted_messages_cleared")}),n(!1)},children:w.use("vkcom_deleted_messages_clear")}),trigger:"hover",placement:"bottom-end",children:(0,a.jsx)(r.qAe,{"aria-label":w.use("global_close"),onClick:c.A,hasActive:!1,children:(0,a.jsx)(o.o,{})})}):null};n()}catch(e){n(e)}})},81922:(e,t,s)=>{s.a(e,async(e,n)=>{try{s.d(t,{default:()=>g});var a=s(74848),o=s(39107),r=s(96540),i=s(84833),c=s(87675),l=s(39854),d=s(30948),u=s(70668),h=e([c,l,u]);[c,l,u]=h.then?(await h)():h;const g=()=>{const e=(0,c.A)();return(0,r.useLayoutEffect)(()=>{window.stManager&&window.stManager.add(window.stDeps["/css/al/im.css"])},[]),(0,a.jsx)(d.H,{children:(0,a.jsx)(i.A,{size:600,header:(0,a.jsx)(o.aO9,{after:(0,a.jsx)(u.A,{}),children:e.use("vkcom_action_item_deleted_msg")}),children:(0,a.jsx)(l.A,{})})})};n()}catch(e){n(e)}})}}]);