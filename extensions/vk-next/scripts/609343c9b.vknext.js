"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[6353],{6353:(e,t,o)=>{var n=o(95728),r=o(37746),s=o(88257),c=o(53644),l=o(43027);const i="pjnmruE51lp5H9IJ",a=({icon:e,onClick:t})=>{const o=document.createElement("button");return o.className=i,o.appendChild((0,c.A)(e)),t&&o.addEventListener("click",e=>{(0,l.A)(e),t(e)}),o};var d=o(7417),u=o(51018),f=o(38729),m=o(92128);const g=[".ForeignMessageModal__body"].join(","),h=new u.e,v=(0,f.NS)(),w=(0,f.sr)(),p=e=>{if(!e[w]){e[w]=!0;for(const t of h.listeners)t(e)}},y=()=>{for(const e of document.querySelectorAll(g))p(e)},A=async()=>{(0,m.A)(e=>{var t;(t=e)[v]||(t[v]=new MutationObserver(e=>{for(const t of e)for(const e of t.addedNodes)if(e instanceof HTMLElement)for(const t of e.querySelectorAll(g))p(t)}),t[v].observe(t,{childList:!0}));for(const t of e.querySelectorAll(g))p(t)})};let _=!1;const b=e=>{const t=h.addListener(e);return(0,d.n)(y),_||(_=!0,A()),t},k=[".ForwardedMessage"].join(","),M=new u.e,E=(0,f.sr)(),S=e=>{if(!e[E]){e[E]=!0;for(const t of M.listeners)t(e)}},q=()=>{for(const e of document.querySelectorAll(k))S(e)};let L=!1;const T=e=>{const t=M.addListener(e);return(0,d.n)(q),L||(L=!0,(async()=>{b(e=>{for(const t of e.querySelectorAll(k))S(t)})})()),t};var C=o(32441);const j=e=>{const{fiber:t}=(0,n.A)(e),{linkMp3:o,ownerId:s,id:c}=t.return.memoizedProps.message.attaches.voice,l=[s,c].join("_");(0,r.A)(o,`audio_message${l}.mp3`)},O=e=>{for(const t of e.querySelectorAll(".AttachVoice__player")){if(t.vkn_down_inj)continue;t.vkn_down_inj=!0;const o=a({icon:s.A,onClick:t=>{if(!t.target)return;const o=t.target.closest(".AttachVoice");j(o||e)}});t.appendChild(o)}};(0,C.A)(O),T(O)},37746:(e,t,o)=>{o.d(t,{A:()=>s});const n=e=>{try{e.dispatchEvent(new MouseEvent("click"))}catch(t){const o=document.createEvent("MouseEvents");o.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(o)}},r=async(e,t="download")=>{const o=document.createElement("a");o.download=t,o.rel="noopener",(globalThis?.chrome?.runtime?.id||globalThis?.browser?.runtime?.id)&&(o.target="_blank"),"string"==typeof e?(o.href=e,o.origin!==location.origin?await(async e=>{try{const t=await globalThis.fetch(e,{method:"HEAD"});return t.status>=200&&t.status<=299}catch(e){console.error(e)}return!1})(o.href)?await(async(e,t)=>{try{const o=await globalThis.fetch(e,{method:"GET"}),n=await o.blob();await r(n,t)}catch(e){console.error(e)}})(e,t):(o.target="_blank",n(o)):n(o)):(o.href=URL.createObjectURL(e),setTimeout(()=>{URL.revokeObjectURL(o.href)},4e4),setTimeout(()=>{n(o)},0))},s=r},47648:(e,t,o)=>{o.d(t,{A:()=>m});var n=o(49032),r=o(7417),s=o(51018),c=o(22707),l=o(91570);const i=(0,o(38729).sr)(),a=new s.e,d=()=>{if(document.querySelector(".im-page:not(.im-page_group)"))return void setTimeout(d,1e3);const e=document.querySelector("#reforged-root,.VKCOMMessenger__reforgedRoot");e?e.querySelector(".VKCOMMessenger__skeletonWrapper")?setTimeout(d,500):(e=>{if(!e[i]){e[i]=!0;for(const t of a.listeners)t(e)}})(e):0===document.getElementById("wrap3")?.children.length&&setTimeout(d,500)},u=async e=>{if(document.getElementsByClassName("im-page")[0]&&!e)return void(0,r.n)(()=>u(!0));const t=await(0,l.R)();d(),t.onLocationChange(async e=>{await(0,c.t)(),n.lz.test(e)&&d()})};let f=!1;const m=e=>{const t=a.addListener(e);return(0,r.n)(d),f||(f=!0,u()),t}},53644:(e,t,o)=>{o.d(t,{A:()=>r});let n=0;const r=e=>{const t=!!document.importNode;let o=(new DOMParser).parseFromString(e,"image/svg+xml").documentElement;t&&(o=document.importNode(o,!0));for(const e of o.querySelectorAll("title,desc"))e.remove();for(const e of o.querySelectorAll("[id]")){if(!e.id)continue;const t="vknext_icon-"+n++;let r=!1;for(const n of o.querySelectorAll(`[fill="url(#${e.id})"]`))n.setAttribute("fill",`url(#${t})`),r=!0;r&&(e.id=t)}return o}},88257:(e,t,o)=>{o.d(t,{A:()=>n});const n='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16"><path fill="currentColor" fill-rule="evenodd" d="M8.75 1.75a.75.75 0 0 0-1.5 0v6.6893L5.0303 6.2197a.75.75 0 0 0-1.0606 1.0606l3.5 3.5a.7498.7498 0 0 0 1.0606 0l3.5-3.5a.75.75 0 0 0-1.0606-1.0606L8.75 8.4393V1.75Zm-6 10.75a.75.75 0 0 0 0 1.5h10.5a.75.75 0 0 0 0-1.5H2.75Z" clip-rule="evenodd"/></svg>\n'},92128:(e,t,o)=>{o.d(t,{A:()=>m});var n=o(7417),r=o(51018),s=o(38729),c=o(47648);const l=["#reforged-modal-root",".VKCOMMessenger__reforgedModalRoot","#fastchat-reforged-modals"].join(","),i=new r.e,a=(0,s.sr)(),d=e=>{if(!e[a]){e[a]=!0;for(const t of i.listeners)t(e)}},u=()=>{for(const e of document.querySelectorAll(l))d(e)};let f=!1;const m=e=>{const t=i.addListener(e);return(0,n.n)(u),f||(f=!0,(0,c.A)(e=>{const t=e.closest(".vkui__root");if(t)for(const e of t.querySelectorAll(l))d(e)})),t}}}]);