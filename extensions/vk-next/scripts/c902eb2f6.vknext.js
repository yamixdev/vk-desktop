"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[8048],{24382:(e,t,n)=>{n.d(t,{A:()=>a});const a=e=>{let t;try{t=new URL(e)}catch(e){return!1}return["http:","https:"].includes(t.protocol)}},30598:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(24382),i=n(76299);let o=/\[(id|club)(\d+)(?:\:([a-z0-9_\-]+))?\|([^\$]+?)\]/g,s=/([a-zA-Zа-яА-Я\-_\.0-9\+]+@(((?:[\w\$А-Яа-яёЁєЄҐґЇїІіЈј—\-\_]+\.){1,5})([A-Za-zа-яА-Я\-\d]{2,22})))/gi;const r=/^(https?:\/\/)?([\w-]{1,32}\.[\w-]{1,32})[^\s@]*$/,l=/(?!,|;|:|\.|\s|<br ?\/?>|"|\(|\)|\[|\]|!|\?)(@all|\*all|@everyone|\*everyone|@все|\*все|@online|\*online|@here|\*here|@здесь|\*здесь|@тут|\*тут)(?=$|,|;|:|\.(?![a-z0-9_-])|\s|<br ?\/?>|"|\(|\)|\[|\]|!|\?)/gi,c=(e,{escape:t,mentions:n,mail:c,link:d,allMentions:u,emoji:p})=>(t&&(e=(0,i.A)(e)),n&&(e=e.replaceAll(o,(e,t,n,a,i)=>`<a href="/${t}${n}" class="mem_link" mention="" mention_id="${t}${n}" onclick="return mentionClick(this, event)" onmouseover="mentionOver(this)">${i}</a>`)),c&&(e=e.replaceAll(s,e=>`<a href="mailto:${e}">${e}</a>`)),d&&(e=e.split("<br>").map(e=>e.split(" ").map(e=>{if(!r.test(e)&&!(0,a.A)(e))return e;const t="/away.php?"+new URLSearchParams({utf:"1",to:`${e.startsWith("http://")||e.startsWith("https://")?"":"http://"}${e}`,cc_key:""});return`<a href="${(0,i.A)(t)}" target="_blank" rel="nofollow noopener">${e}</a>`}).join(" ")).join("<br>")),u&&(e=e.replaceAll(l,e=>`<span class="mem_pseudolink" data-mention="${e.slice(1).toLowerCase()}">${e}</span>`)),p&&window.Emoji?.emojiRegex&&(e=e.replaceAll(window.Emoji.emojiRegex,window.Emoji.emojiReplace)),e)},55943:(e,t,n)=>{n.d(t,{A:()=>a});const a={vknDecrypt:"Kzfko24S3EIv71b3",vknDecrypt__container:"v5QijzeXiqb51sNP"}},60485:(e,t,n)=>{n.d(t,{A:()=>i});const a=()=>Promise.all([n.e(1396),n.e(6394)]).then(n.bind(n,11886)).then(e=>e.default),i=async e=>{if(e.startsWith("VK CO FF EE ")&&e.endsWith(" VK CO FF EE")||e.startsWith("II ")&&e.endsWith(" II")){const{COFFEE:t}=await a(),n=t.decrypt(e);if(n)return{text:n,label:`VK Coffee [${e.includes("VK CO FF EE")?"default":"hidden"}]`}}if(e.startsWith("VT0ST3RS ")&&e.endsWith(" VT0ST3RS")){const{VTOSTERS:t}=await a(),n=t.decrypt(e);if(n)return{text:n,label:"VTosters Classique"}}if(e.includes("ж")&&e.includes("Ж")&&e.includes("ъ")&&e.includes("Ъ")){const{BeeCrypt:t}=await a(),n=t.decrypt(e);if(n)return{text:n,label:"BeeCrypt"}}if(/^  ([ ​‌‏ ⁪⁫⁬⁭⁮⁯\\s]*)/.test(e)){const{MP3:t}=await a(),n=t.invisibleDecode(e);if(n)return{text:n,label:"MP3 Invisible"}}return!1}},76299:(e,t,n)=>{n.d(t,{A:()=>o});var a=n(99418);const i=document.createElement("textarea"),o=e=>(i.innerText=a.A.sanitize(e),i.innerHTML)},81425:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.r(t);var i=n(74848),o=n(57580),s=n(7417),r=n(92046),l=n(30598),c=n(22707),d=n(37400),u=n(32441),p=n(43171),f=n(3068),h=n(43024),m=n(55943),w=n(60485),y=e([o]);o=(y.then?(await y)():y)[0];let b=new Set,A=!1;const v=()=>{A||(A=!0,(0,p.A)(()=>{for(const e of b)e();b.clear(),A=!1}))},k=async(e,t,n)=>{await(0,c.t)(),e.innerHTML=t;for(const t of n.reverse())e.prepend(t)},C=async(e,t)=>{if(!t)return;const a=e.querySelector(".ConvoMessageBottomInfo,.ConvoMessage__info");if(!a)return;const o=document.createElement("span");o.className=m.A.vknDecrypt__container,await(0,d.G)(),a.append(o);const{default:s}=await Promise.all([n.e(961),n.e(7397),n.e(1649),n.e(8414),n.e(4996)]).then(n.bind(n,34996)),{unmount:r}=await(0,f.A)({root:o,content:(0,i.jsx)(s,{label:t}),disableConfig:!0});b.add(r),v()},$=async(e=document.body)=>{if(!h.default.getValue("decrypt"))return;await(0,r.c)(200),await(0,d.G)();const t=e.querySelectorAll(".MessageText:not([decrypted])");if(0!==t.length)for(const e of t){await(0,c.t)(),e.setAttribute("decrypted","");let t="";const n=[];for(const a of e.childNodes)"BR"!==a.nodeName&&(a.nodeType===Node.TEXT_NODE?t+=a.textContent:n.push(a));if(!t)continue;await(0,d.G)();const a=await(0,w.A)(t);if(!a)continue;const i=(0,l.A)(a.text,{escape:1,mentions:1,allMentions:1,mail:1,link:1,emoji:1});k(e,i,n);const o=e.closest(".ConvoMessage");o&&requestAnimationFrame(()=>C(o,a.label).catch(console.error))}},g=async()=>{(0,s.n)(async()=>{const e=window.cur?.peer;e&&await $()})};let E=null;const T=async()=>{E||(E=(0,u.A)($))},_=async()=>{h.default.getValue("decrypt")&&(g(),await T()),h.default.addChangeKeyListener("decrypt",(e,t)=>{t?(g(),T()):E&&(E(),E=null)})};0,h.default.onInited(_),a()}catch(e){a(e)}})}}]);