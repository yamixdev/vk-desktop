"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[150],{23972:(e,t,o)=>{o.d(t,{A:()=>r});var a=o(26555);const r=(e,t)=>{const o=`${e} kb/s`;return"number"==typeof t?`${o} | ~${(0,a.A)(t,2)}`:o}},49423:(e,t,o)=>{o.d(t,{A:()=>d});var a=o(22707),r=o(37400),n=o(96540),i=o(74225),s=o.n(i),c=o(695);const l=()=>{const e=window.colorScheme?.currentMode;return"auto"===e?window.colorScheme.currentIsDark?"dark":"light":e},d=()=>{const[e,t]=(0,n.useState)(l()),[o,i]=(0,n.useState)(!!window.colorScheme?.subscribe);return s()(async e=>{await(0,c.U)(),e()&&i(!0)},[]),(0,n.useEffect)(()=>{if(window.colorScheme?.subscribe)return window.colorScheme.subscribe(async()=>{await(0,r.G)(),await(0,a.t)(),t(l())});i(!1)},[o]),e}},50150:(e,t,o)=>{o.a(e,async(e,a)=>{try{o.d(t,{default:()=>A});var r=o(74848),n=o(43027),i=o(89150),s=o(76382),c=o(39107),l=o(96540),d=o(74225),u=o.n(d),w=o(49423),h=o(87675),v=o(70459),f=o(23972),m=o(89629),y=o(73746),p=e([h]);h=(p.then?(await p)():p)[0];const _=({type:e,getRootRef:t,className:o,CustomIcon:a,...n})=>"audio_row_react"===e?(0,r.jsx)(c.K0,{Component:"button",className:(0,c.xWm)(v.A.AudioRowReact__button,o),getRootRef:t,hoverMode:"opacity",activeMode:"opacity",activeEffectDelay:200,...n,children:a?(0,r.jsx)(a,{}):(0,r.jsx)(i.W,{})}):"audio_row"===e?(0,r.jsx)("button",{className:(0,c.xWm)("audio_row__action",o),ref:t,...n,children:(0,r.jsx)("div",{className:"audio_row__icon",children:a?(0,r.jsx)(a,{}):(0,r.jsx)(i.W,{})})}):"audio_page"===e?(0,r.jsx)(c.K0,{className:(0,c.xWm)(v.A.AudioPlayerPlaybackButton,o),getRootRef:t,hoverMode:"opacity",activeMode:"opacity",...n,children:a?(0,r.jsx)(a,{}):(0,r.jsx)(s.q,{})}):"secondary_attachment"===e?(0,r.jsx)("div",{className:`SecondaryAttachment__afterItem ${v.A.SecondaryAttachment__afterItem}`,ref:t,...n,children:a?(0,r.jsx)(a,{}):(0,r.jsx)(s.q,{})}):"primary_attachment"===e?(0,r.jsx)(c.$nd,{className:v.A.PrimaryButton,size:"l",mode:"primary",appearance:"overlay",stretched:!0,getRootRef:t,...n,children:a?(0,r.jsx)(a,{}):(0,r.jsx)(s.q,{})}):null,b=({audioObject:e,getAudioObject:t})=>{const o=(0,h.A)(),[a,n]=(0,l.useState)(null);return u()(async o=>{if(a)return;const r=e||t&&await t();if(!r)return void(o()&&n(""));const i=await(0,m.default)(r);o()&&n(i?(0,f.A)(i.bitrate,i.size):"")},[e,t]),null===a?(0,r.jsxs)(r.Fragment,{children:[o.use("vkcom_bitrate"),": ",o.use("global_loading")]}):""===a.trim()?null:(0,r.jsxs)(r.Fragment,{children:[o.use("vkcom_bitrate"),": ",a]})},A=({type:e,tooltipProps:t,audioObject:o,getAudioObject:a,onClick:i,...s})=>{const d=(0,w.A)(),u=(0,h.A)(),v=(0,l.useCallback)(async()=>{const e=o||a&&await a();if(e)return await(0,y.A)(e)},[o,a]);return(0,r.jsx)(c.SvD,{value:d,children:(0,r.jsx)(c.m_M,{hideWhenReferenceHidden:!0,usePortal:document.body,title:t?.title?t.title:u.use("global_download"),description:(0,r.jsx)(b,{audioObject:o,getAudioObject:a}),...t,children:(0,r.jsx)(_,{type:e,onClick:e=>{(0,n.A)(e),i&&i(e),v().catch(console.error)},...s})})})};a()}catch(e){a(e)}})},54869:(e,t,o)=>{o.d(t,{A:()=>i});var a=o(91953),r=o(56992),n=o(61054);const i=async e=>{try{const t=[e.owner_id,e.id];e.access_key?t.push(e.access_key):e.accessKey&&t.push(e.accessKey);const i=await(0,n.V)(),s=await i.api("audio.getById",{audios:t.join("_"),v:"5.204"}),{audioUnmaskSource:c}=await Promise.resolve().then(o.bind(o,89141));for(const e of s)if(e?.url)return e.url=c(e.url),e;const l=e.hashes?.split("/");let d="",u="";l?(d=l[2],u=l[5]):(d=e.actionHash||"",u=e.urlHash||"");const w=await(0,a._)(),[h]=await w.promisifiedPost("al_audio.php",{act:"reload_audio",ids:[e.owner_id,e.id,d,u].join("_"),al:1}),v=(await(0,r.X)()).audioTupleToAudioObject(h[0]);return v.url=c(v.url),v}catch(e){console.error(e)}return e}},73746:(e,t,o)=>{o.d(t,{A:()=>u});var a=o(37746),r=o(67078),n=o(69128),i=o(63989),s=o(25894),c=o(84896),l=o(56260),d=o(54869);const u=async e=>{if(!e)return void await(0,r.A)({text:"Audio not found",type:"error"});const t="audio"+[e.owner_id,e.id].join("_");try{const e=(0,n.cy)(t);if(e)return void e.onSave?.()}catch(e){e instanceof i.VZ||console.error(e)}const o=new AbortController,{signal:u}=o,w=(0,s.R)({audio:e}),{setProgress:h,finish:v}=(0,n.Hq)({id:t,title:`${w}.mp3`,type:"track",onCancel:()=>o.abort(),photoUrl:(0,c.Z)(e)||void 0}),f=await(0,d.A)(e),m=await(0,l.G)({audio:f,signal:u,onProgress:(e,t)=>{u.aborted||h({current:e,total:t})}});if(u.aborted)return;const y=URL.createObjectURL(m),p=()=>(0,a.A)(y,`${w}.mp3`);await p(),v({onSave:p,onRemove:()=>URL.revokeObjectURL(y)})}},74225:(e,t,o)=>{var a=o(96540);function r(e,t,o){var r="function"==typeof t;a.useEffect(function(){var o,a=!0,n=e(function(){return a});return Promise.resolve(n).then(function(e){o=e}),function(){a=!1,r&&t(o)}},r?o:t)}e.exports=r,e.exports.useAsyncEffect=r},76382:(e,t,o)=>{o.d(t,{q:()=>a});var a=(0,o(78414).mT)("Icon24DownloadOutline","download_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" id="download_outline_24"><path fill-rule="evenodd" d="M12.002 2a.9.9 0 0 1 .9.9v11.002l4.562-4.631a.9.9 0 1 1 1.283 1.263l-6.104 6.195a.9.9 0 0 1-1.284-.001l-6.09-6.206a.9.9 0 1 1 1.286-1.26l4.547 4.633V2.9a.9.9 0 0 1 .9-.9m-8 18.1a.9.9 0 0 1 .9-.9h14.2a.9.9 0 1 1 0 1.8h-14.2a.9.9 0 0 1-.9-.9" clip-rule="evenodd" /></symbol>',24,24,!1,void 0)},87675:(e,t,o)=>{o.a(e,async(e,a)=>{try{o.d(t,{A:()=>n});var r=o(93819);const e=await r.A,n=()=>e;a()}catch(e){a(e)}},1)},89150:(e,t,o)=>{o.d(t,{W:()=>a});var a=(0,o(78414).mT)("Icon20DownloadOutline","download_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20" id="download_outline_20"><g fill="currentColor"><path fill-rule="evenodd" d="M4 17.75a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75a.75.75 0 0 1-.75-.75" clip-rule="evenodd" /><path d="M10.75 2.726c0-.401-.336-.726-.75-.726a.74.74 0 0 0-.75.726v9.722l-3.97-3.97a.75.75 0 0 0-1.06 1.06l5.245 5.246a.75.75 0 0 0 1.06 0l5.257-5.256a.75.75 0 0 0-1.061-1.061l-3.972 3.972z" /></g></symbol>',20,20,!1,void 0)},89629:(e,t,o)=>{o.d(t,{default:()=>w});var a=o(37352),r=o(89141),n=o(92580),i=o(49197);var s=o(54869);const c=new Map,l=[];let d=0;const u=async()=>{if(d>=2||0===l.length)return;d++;const e=l.shift();await e(),d--,l.length>0&&setTimeout(u,500)},w=async e=>{const t=`${e.owner_id}_${e.id}`;if(c.has(t))return c.get(t);if(c.has(t))return await c.get(t);const{promise:o,resolve:d}=(0,a.A)();var w;return c.set(t,o),w=async()=>{const t=e.url?e:await(0,s.A)(e);if(!t.url)return void d(null);const o=await(async({url:e})=>{const{promise:t,resolve:o,reject:a}=(0,n.Q)(),r=await(0,i.L)(),s=new r,c=new Audio;let l,d=0,u=null;const w=e=>{a(e),s.stopLoad(),s.destroy()};return s.on(r.Events.MANIFEST_PARSED,(e,t)=>{const o=t.levels[0]?.details;o&&(l=o.totalduration)}),s.on(r.Events.BUFFER_APPENDING,(e,t)=>{u=t.data}),s.on(r.Events.FRAG_LOADED,(e,t)=>{if(u)return s.detachMedia(),void((e,t)=>{const a=Math.round(8*e/t/1e3);o({bitrate:a,size:e,duration:t})})(u.length/t.frag.duration*l,l)}),s.on(r.Events.ERROR,(e,t)=>{if(!["bufferFullError","fragLoadError"].includes(t.details))return t.type==r.ErrorTypes.MEDIA_ERROR&&d<2?(++d>1&&s.swapAudioCodec(),void s.recoverMediaError()):void w(e);w(e)}),s.loadSource(e),s.attachMedia(c),await t})({url:(0,r.audioUnmaskSource)(t.url)});d(o)},l.push(w),u(),await o}}}]);