"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[9007],{19007:(e,t,o)=>{o.a(e,async(e,a)=>{try{o.d(t,{default:()=>d});var n=o(74848),s=o(39107),r=o(84833),c=o(87675),i=o(68204),l=e([c,i]);[c,i]=l.then?(await l)():l;const d=()=>{const e=(0,c.A)();return(0,n.jsx)(r.A,{header:(0,n.jsx)(s.aO9,{children:e.use("vkcom_replace_photo")}),size:600,children:(0,n.jsx)(i.A,{})})};a()}catch(e){a(e)}})},46746:(e,t,o)=>{o.d(t,{A:()=>n});var a=o(62493);const n=e=>{let t=null,o=0;for(const n of e){const e=n.type;if(a.B.includes(e)){const e=(n.width||0)*(n.height||0);e>o&&(o=e,t=n)}}return t||e[0]}},60593:(e,t,o)=>{o.d(t,{A:()=>a});const a=({file:e,sizeX:t,sizeY:o})=>new Promise(async a=>{const n=new Image,s=document.createElement("canvas"),r=s.getContext("2d");r&&(s.width=t,s.height=o,n.onload=()=>{r.drawImage(n,0,0,o,t),s.toBlob(t=>{t&&a(new File([t],`edited_${e.name}.jpg`,{type:"image/png"}))})},n.src=await(e=>new Promise(t=>{const o=new FileReader;o.onload=function(e){e.target&&t(e.target.result)},o.readAsDataURL(e)}))(e))})},62493:(e,t,o)=>{o.d(t,{A:()=>n,B:()=>a});const a=["a","b","i","p","q","s","w","z","y","x","r","o","m","g","max","l","f","k","c","e","d","j","temp","h","n"],n=(e=window.cur.pvCurPhoto)=>{if(!e)throw new Error("Фоторедактор не открыт");let t=null,o=0;for(const[n,s]of Object.entries(e)){const e=n.slice(0,-1);if(a.includes(e)){const[e,a,n]=s,r=a*n;r>o&&(o=r,t=[e,a,n])}}if(!t)throw new Error("Фото не найдено");return t}},68204:(e,t,o)=>{o.a(e,async(e,a)=>{try{o.d(t,{A:()=>x});var n=o(74848),s=o(92270),r=o(39107),c=o(96540),i=o(95974),l=o(92046),d=o(17100),u=o(46746),h=o(87675),p=o(79705),w=o(43024),m=o(60593),f=e([h]);h=(f.then?(await f)():f)[0];const v=["w","z","y","x","r","q","p","o","m","s"],g=(e=window.cur.pvCurPhoto)=>{for(const t of v){const o=e[`${t}_`];if(o?.[2])return o}},x=()=>{const e=(0,h.A)(),[t,o]=(0,p.A)("changePhotoWay"),[a,f]=(0,p.A)("scalePhoto"),[v,x]=(0,c.useState)(null),[_,j]=(0,c.useState)(null),{closeModal:y}=(0,d.Hb)(),[,k,C]=(0,c.useMemo)(()=>g(window.cur.pvCurPhoto),[window.cur.pvCurPhoto]);return(0,n.jsxs)(r.iau,{children:[(0,n.jsx)(r.tUM,{mode:"accent",children:(0,n.jsxs)(r.ox2,{children:[(0,n.jsx)(r.ORv,{onClick:()=>o(3),selected:3===t,children:e.use("vkcom_replace_photo_vk_api")}),(0,n.jsx)(r.ORv,{onClick:()=>o(2),selected:2===t,children:e.use("vkcom_replace_photo_web_api_new")}),(0,n.jsx)(r.ORv,{onClick:()=>o(1),selected:1===t,children:e.use("vkcom_replace_photo_web_api_old")})]})}),(0,n.jsx)(r.T6P,{Component:"label",after:(0,n.jsx)(i.A,{defaultChecked:a,onChange:()=>f(!a)}),subtitle:e.use("vkcom_sett_scale_photo_description"),multiline:!0,children:e.use("vkcom_sett_scale_photo")}),v&&(0,n.jsx)(r.lZ$,{title:e.use("global_error"),subtitle:v,mode:"image",background:(0,n.jsx)("div",{style:{backgroundColor:"var(--vkui--color_accent_red)"}}),after:"dismiss",onDismiss:()=>x(null)}),(0,n.jsxs)(r.iau,{children:[(0,n.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center"},children:(0,n.jsxs)(r.HLL,{children:[e.use("vkcom_photo_source_size"),": ",k,"x",C]})}),(0,n.jsx)(r.KzX,{size:12}),(0,n.jsx)(r.e2v,{stretched:!0,align:"center",children:(0,n.jsx)(r.ZHH,{before:(0,n.jsx)(s.J,{role:"presentation"}),accept:"image/jpeg,image/png,image/gif,image/heic,image/heif,image/webp",size:"l",mode:"secondary",onChange:async e=>{try{await(async e=>{if(!e)return;if(!cur.pvCurPhoto)return;const o=e[0];if(!o)return;j((0,n.jsx)(r.WHT,{}));const a=new FormData,s=3===t;if(w.default.getValue("scalePhoto")){const e=await(0,m.A)({sizeX:k,sizeY:C,file:o});a.append(s?"file":"file0",e,`edited_${o.name}.jpg`)}else a.append(s?"file":"file0",o,`edited_${o.name}.jpg`);const{peHash:c,id:i}=cur.pvCurPhoto;if(s){const{upload_url:e}=await vkApi.api("photos.getPhotoEditorUploadServer",{}),t=await fetch(e,{method:"POST",body:a}).then(e=>e.text());try{const[e]=await window.vkApi.api("photos.savePhotoEditor",{response_json:t,photo:i});if(!e)return j((0,n.jsx)(r.WHT,{state:"error"})),await(0,l.c)(1e3),void j(null);j((0,n.jsx)(r.WHT,{state:"done"})),y(),await(0,l.c)(1e3),j(null);const o={};for(const t of e.sizes||[]){const e=t.src||t.url;e&&(o[t.type]=e,o[`$${t.type}_`]=[e,t.height,t.width])}await(0,l.c)(0),window.showPhoto(i,"",{additional:{},temp:o,queue:1}),await(0,l.c)(0),cur.pvPhoto.getElementsByTagName("img")[0].src=(0,u.A)(e.sizes||[]).url||""}catch(e){console.error(e),j((0,n.jsx)(r.WHT,{state:"error"})),await(0,l.c)(1e3),j(null)}return await(0,l.c)(1e3),void j(null)}ajax.post("al_photos.php",{act:"get_editor",photo_id:i,hash:c},{onDone:async function(e){const o=await fetch(e.uploadUrl,{method:"POST",body:a}).then(e=>e.text());if(o.includes('"error"')){const e=JSON.parse(o);return x(e.error),j((0,n.jsx)(r.WHT,{state:"error"})),await(0,l.c)(1e3),void j(null)}1===t&&ajax.post("al_photos.php",{_query:o,act:"save_desc",al:1,conf:"///",cover:"",filter_num:0,hash:c,photo:i,text:""},{onDone:async function(e,t,o,a){j((0,n.jsx)(r.WHT,{state:"done"})),y(),await(0,l.c)(1e3),j(null),o&&a&&(await(0,l.c)(0),window.showPhoto(i,"",o),await(0,l.c)(0),cur.pvPhoto.getElementsByTagName("img")[0].src=g(o)[0])},onFail:async e=>{console.error(e),j((0,n.jsx)(r.WHT,{state:"error"})),await(0,l.c)(1e3),j(null)}}),2===t&&ajax.post("al_photos.php",{act:"pe_save",photo:i,hash:c,_query:o,al:1,texts:""},{onDone:async function(e,t){j((0,n.jsx)(r.WHT,{state:"done"})),y(),await(0,l.c)(1e3),j(null),t&&(await(0,l.c)(0),window.showPhoto(i,"",t),await(0,l.c)(0),cur.pvPhoto.getElementsByTagName("img")[0].src=g(t)[0])},onFail:async e=>{console.error(e),j((0,n.jsx)(r.WHT,{state:"error"})),await(0,l.c)(1e3),j(null)}})}})})(e.target.files)}catch(e){console.error(e)}e.target.value=""},children:e.use("vkcom_select_file")})})]}),_]})};a()}catch(e){a(e)}})},79705:(e,t,o)=>{o.d(t,{A:()=>s});var a=o(96540),n=o(43024);const s=function(e){const[t,o]=(0,a.useState)(n.default.getValue(e));return(0,a.useEffect)(()=>{const t=n.default.addChangeKeyListener(e,(e,t)=>o(t));return()=>t.remove()},[e]),[t,t=>{n.default.setValue(e,t)}]}},84833:(e,t,o)=>{o.d(t,{A:()=>c});var a=o(74848),n=o(39107),s=o(96540),r=o(17100);const c=({children:e,noClose:t=!1,...o})=>{const{open:c,setOpen:i,onClose:l,onClosed:d,onOpen:u,onOpened:h}=(0,r.Fs)(),p=(0,s.useId)();return(0,a.jsx)(n.VWm,{nav:p,open:c,onClose:(e,o)=>{t||(i(!1),l?.(e,o))},onClosed:d,onOpen:u,onOpened:h,...o,children:(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)(n.qBl,{}),children:e})})}},87675:(e,t,o)=>{o.a(e,async(e,a)=>{try{o.d(t,{A:()=>s});var n=o(93819);const e=await n.A,s=()=>e;a()}catch(e){a(e)}},1)},92270:(e,t,o)=>{o.d(t,{J:()=>a});var a=(0,o(78414).mT)("Icon24Document","document_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="document_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="M4 5v13a3 3 0 0 0 3 3l11 .002A3 3 0 0 0 21 18l-.01-9.172a2 2 0 0 0-.585-1.413l-4.83-4.83A2 2 0 0 0 14.163 2H7a3 3 0 0 0-3 3m10.012-.988 3.976 3.976a.3.3 0 0 1-.212.512H14a.5.5 0 0 1-.5-.5V4.224a.3.3 0 0 1 .512-.212" /></g></symbol>',24,24,!1,void 0)},95974:(e,t,o)=>{o.d(t,{A:()=>r});var a=o(74848),n=o(39107);const s="_ME21DoLEVJUlnQU",r=({className:e,...t})=>(0,a.jsx)(n.V9m,{value:n.ODD.ANDROID,children:(0,a.jsx)(n.dOG,{className:(0,n.xWm)(s,e),...t})})}}]);