"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[277],{4760:(e,s,t)=>{t.d(s,{Q:()=>n});const n=(e,s=100)=>{const t=[...e],n=[];for(;t.length;)n.push(t.splice(0,s||t.length));return n}},30904:(e,s,t)=>{t.a(e,async(e,n)=>{try{t.d(s,{A:()=>p});var a=t(74848),o=t(90275),r=t(99381),i=t(3178),c=t(39107),l=t(67078),d=t(55517),u=t(87675),h=t(1003),g=t(44497),f=t(96832),w=e([u]);u=(w.then?(await w)():w)[0];const p=()=>{const{setMessages:e,isPopoverShown:s,setIsPopoverShown:n}=(0,f.p)(),w=(0,u.A)(),p=(0,d.A)();return s?(0,a.jsx)(o.Ku,{trigger:"hover",placement:"bottom-end",actions:(0,a.jsx)(o.vH,{onClick:async()=>{const{default:s}=await t.e(1243).then(t.bind(t,21243)),{default:a}=await t.e(1691).then(t.bind(t,31691)),o=p||(0,g.A)(),r=(0,h.A)(),i=await a.getStorage(),c=await s.getMessages(r);for(const[e,s]of Object.entries(i))if(e.startsWith(r.toString())&&s[0]?.peer_id===o){delete i[e];for(const e of s)delete c[e.id]}await s.setMessages(r,c),await a.saveStorage(i),e({}),await(0,l.A)({type:"done",text:w.use("vkcom_deleted_messages_cleared")}),n(!1)},children:w.use("vkcom_deleted_messages_clear")}),children:(0,a.jsx)(c.qAe,{"aria-label":w.use("global_close"),onClick:r.A,hasActive:!1,children:(0,a.jsx)(i.o,{})})}):null};n()}catch(e){n(e)}})},78278:(e,s,t)=>{t.a(e,async(e,n)=>{try{t.d(s,{default:()=>g});var a=t(74848),o=t(39107),r=t(96540),i=t(84833),c=t(87675),l=t(83730),d=t(96832),u=t(30904),h=e([c,l,u]);[c,l,u]=h.then?(await h)():h;const g=()=>{const e=(0,c.A)();return(0,r.useLayoutEffect)(()=>{window.stManager&&window.stManager.add(window.stDeps["/css/al/im.css"])},[]),(0,a.jsx)(d.L,{children:(0,a.jsx)(i.A,{size:600,header:(0,a.jsx)(o.aO9,{after:(0,a.jsx)(u.A,{}),children:e.use("vkcom_action_item_expired_msg")}),children:(0,a.jsx)(l.A,{})})})};n()}catch(e){n(e)}})},83730:(e,s,t)=>{t.a(e,async(e,n)=>{try{t.d(s,{A:()=>_});var a=t(74848),o=t(89230),r=t(7618),i=t(4760),c=t(39107),l=t(96540),d=t(74225),u=t.n(d),h=t(55517),g=t(87675),f=t(1003),w=t(40473),p=t(96832),m=e([g,w]);[g,w]=m.then?(await m)():m;const _=()=>{const{messages:e,setIsPopoverShown:s}=(0,p.p)(),n=(0,g.A)(),[d,m]=(0,l.useState)(!1),[_,A]=(0,l.useState)(null),[x,v]=(0,l.useState)([]),j=(0,h.A)(),b=(0,f.A)();return u()(async s=>{if(null===e)return;const{default:n}=await t.e(1691).then(t.bind(t,31691));if(!s())return;const a=Object.keys(e);if(!a.length)return m(!0);const o=[],c=new Set,l=new Set,d=[];for(const s of a){const t=await n.getMessages(`${b}_${s}`,[]);if(!t.length)continue;d.push(s);const a=t.at(-1);a&&(a.peer_id===j&&((r.z.isUserId(a.from_id)?c:l).add(Math.abs(a.from_id)),a.time=e[a.id].time,o.push(a)))}if(!o.length)return m(!0);const u=[...c],h=[...l];let g=[],f=[];try{if(u.length>0){const e=(0,i.Q)(u,100).map(e=>window.vkApi.api("users.get",{user_ids:e.join(","),fields:"photo_50,image_status,screen_name"}));g=(await Promise.all(e)).flat()}if(h.length>0){const e=(0,i.Q)(h,100).map(e=>window.vkApi.api("groups.getById",{group_ids:e.join(","),fields:"photo_50,screen_name"})),s=(await Promise.all(e)).map(e=>e.groups).flat();s&&(f=s.groups)}}catch(e){console.error(e)}const w={};for(const e of g)e.name=`${e.first_name} ${e.last_name}`,e.screen_name||(e.screen_name=`id${e.id}`),w[e.id]=e;for(const e of f)e.screen_name||(e.screen_name=`club${e.id}`),w[-e.id]=e;s()&&(A(w),v(o))},[e,j]),(0,l.useEffect)(()=>{s(!d)},[d]),d?(0,a.jsx)(c.OrA,{children:n.use("global_not_found")}):x.length?(0,a.jsx)(w.A,{messages:x,users:_}):(0,a.jsx)(c.YJl,{children:[...Array(5).keys()].map(e=>(0,a.jsx)(o.A,{},e))})};n()}catch(e){n(e)}})},96832:(e,s,t)=>{t.d(s,{L:()=>d,p:()=>l});var n=t(74848),a=t(96540),o=t(74225),r=t.n(o),i=t(1003);const c=(0,a.createContext)(null),l=()=>{const e=(0,a.useContext)(c);if(!e)throw new Error("useExpiredMessages must be used within a ExpiredMessagesContext");return e},d=({children:e})=>{const[s,o]=(0,a.useState)(!1),[l,d]=(0,a.useState)(null);return r()(async e=>{const s=(0,i.A)(),n=(await t.e(1243).then(t.bind(t,21243))).default,a=await n.getMessages(s,{});e()&&d(a)},[]),(0,n.jsx)(c.Provider,{value:{messages:l,setMessages:d,isPopoverShown:s,setIsPopoverShown:o},children:e})}}}]);