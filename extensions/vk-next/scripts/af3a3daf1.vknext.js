"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[5109],{1003:(e,t,n)=>{n.d(t,{A:()=>a});const a=(e=window.location.pathname)=>{const t=e.match(/^\/?gim(\d+)/);return t&&t[1]?-parseInt(t[1]):window.vk.id}},3881:(e,t,n)=>{n.d(t,{T:()=>a});var a=(0,n(78414).mT)("Icon24AddOutline","add_outline_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="add_outline_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" fill-rule="nonzero" d="M12 3a.9.9 0 0 1 .9.9v7.2h7.2a.9.9 0 1 1 0 1.8l-7.2-.001V20.1a.9.9 0 1 1-1.8 0V12.9l-7.2.001a.9.9 0 1 1 0-1.8h7.2V3.9A.9.9 0 0 1 12 3" /></g></symbol>',24,24,!1,void 0)},5109:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.d(t,{default:()=>d});var s=n(74848),o=n(39107),r=n(84833),c=n(87675),i=n(45313),l=e([c,i]);[c,i]=l.then?(await l)():l;const d=()=>{const e=(0,c.A)();return(0,s.jsx)(r.A,{size:680,header:(0,s.jsx)(o.aO9,{children:e.use("vkcom_send_graffiti")}),children:(0,s.jsx)(i.A,{})})};a()}catch(e){a(e)}})},12004:(e,t,n)=>{n.d(t,{A:()=>_});var a=n(74848),s=n(7618),o=n(96540),r=n(74225),c=n.n(r),i=n(1003),l=n(39107),d=n(43027),u=n(90639),m=n(95075),h=n(17100);const p="tgaca9LBsX6_nz5s",f="GVPPvuuykY3HrXll",v="GtjmXIPhHHWGEiPh",w="RhiQ3WnkuiV4DGvf",x="Od9R1FVWFI03AjqL",g=({item:e,disabled:t,onRemove:n})=>{const{closeModal:s}=(0,h.Hb)();return(0,a.jsxs)("div",{className:(0,l.xWm)(p,t&&f),onClick:async()=>{e&&(await(0,m.A)(e),s())},children:[e?.url&&(0,a.jsx)("div",{style:{backgroundImage:`url(${e.url})`},className:v}),n&&(0,a.jsx)(l.SB4,{className:w,onClick:t=>{(0,d.A)(t),n(e)},hoverClassName:x,hasActive:!1,children:(0,a.jsx)(u.z,{fill:"var(--vkui--color_icon_negative)"})})]})},y="CLgOMNWhFmEvcqaa",A=()=>{const e=[...Array(20).keys()];return(0,a.jsx)("div",{className:y,children:e.map((e,t)=>(0,a.jsx)(g,{disabled:!0},`skeleton${t}`))})},_=()=>{const[e,t]=(0,o.useState)(null);return c()(async e=>{const n=(0,i.A)();if(window.vkmeIntegration&&s.z.isGroupId(n))return void(e()&&t([]));const a=await window.vkApi.api("messages.getRecentGraffities",{});e()&&t(a?.length?a:[])},[]),e?(0,a.jsx)("div",{className:y,children:e.map(e=>(0,a.jsx)(g,{item:e,onRemove:async()=>{e.id&&await window.vkApi.api("messages.hideRecentGraffiti",{doc_id:e.id});const n=await window.vkApi.api("messages.getRecentGraffities",{});t(n?.length?n:[])}},`doc${e.owner_id}_${e.id}`))}):(0,a.jsx)(A,{})}},32550:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.d(t,{A:()=>p});var s=n(74848),o=n(92046),r=n(3881),c=n(39107),i=n(96540),l=n(95075),d=n(67078),u=n(87675),m=n(44497),h=e([u]);u=(h.then?(await h)():h)[0];const p=()=>{const e=(0,u.A)(),[t,a]=(0,i.useState)(null),h=(0,i.useRef)(null);return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c.DzN,{centered:!0,before:(0,s.jsx)(r.T,{}),onClick:()=>{h.current?.click()},children:[e.use("vkcom_upload_new_file"),(0,s.jsx)(c.s6o,{Component:"input",getRootRef:h,type:"file",accept:"image/png,image/jpeg,image/jpg,image/gif",onChange:async()=>{const t=h.current;if(t){if(!t.files?.length)return a((0,s.jsx)(c.WHT,{state:"error"})),await(0,o.c)(1e3),void a(null);a((0,s.jsx)(c.WHT,{state:"loading"}));try{const[r]=t.files,i=new FormData;i.append("file",r,r.name);const u=(await n.e(2893).then(n.bind(n,12893))).default,{upload_url:h}=await u.docs.getMessagesUploadServer({type:"graffiti",peer_id:window.cur?.peer||(0,m.A)()}),p=await fetch(h,{method:"POST",body:i}).then(e=>e.text());if(p.includes("error"))return a((0,s.jsx)(c.WHT,{state:"error"})),await(0,d.A)({type:"error",text:`${e.use("global_error")}: ${p}`}),await(0,o.c)(1e3),void a(null);const f=await u.docs.save(JSON.parse(p)),v=f[f.type];await(0,l.A)(v),a((0,s.jsx)(c.WHT,{state:"done"}))}catch(t){console.error(t),a((0,s.jsx)(c.WHT,{state:"error"})),await(0,d.A)({type:"error",text:`${e.use("global_error")}: ${t.message}`})}await(0,o.c)(1e3),a(null)}}})]}),t]})};a()}catch(e){a(e)}})},44497:(e,t,n)=>{n.d(t,{A:()=>a});const a=()=>{const e=window.location.pathname.match(/\/convo\/(-?\d+)/);if(e)return Number(e[1])||0;const t=new URLSearchParams(window.location.search),n=Number(t.get("sel"));return n||0}},45313:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.d(t,{A:()=>l});var s=n(74848),o=n(39107),r=n(32550),c=n(12004),i=e([r]);r=(i.then?(await i)():i)[0];const l=()=>(0,s.jsxs)(o.iau,{children:[(0,s.jsx)(r.A,{}),(0,s.jsx)(o.KzX,{size:12}),(0,s.jsx)(c.A,{})]});a()}catch(e){a(e)}})},67078:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(74848),s=n(3068),o=n(75511);const r=document.createElement("div");r.className=o.A.Snackbars;const c=async e=>{const t=(await Promise.all([n.e(961),n.e(7397),n.e(1649),n.e(8414),n.e(5812)]).then(n.bind(n,25812))).default;document.body.contains(r)||document.body.appendChild(r);const o=document.createElement("div");r.appendChild(o);const{unmount:c}=await(0,s.A)({root:o,content:(0,a.jsx)(t,{onClose:()=>{c(),o.remove(),0===r.children.length&&r.remove()},...e}),disableParentTransformForPositionFixedElements:!0,noStyling:!0})}},74225:(e,t,n)=>{var a=n(96540);function s(e,t,n){var s="function"==typeof t;a.useEffect(function(){var n,a=!0,o=e(function(){return a});return Promise.resolve(o).then(function(e){n=e}),function(){a=!1,s&&t(n)}},s?n:t)}e.exports=s,e.exports.useAsyncEffect=s},75511:(e,t,n)=>{n.d(t,{A:()=>a});const a={Snackbars:"fuEF5ymRhcBAxInE",BaseSnackbar:"Fu47p889xWCKEooV"}},84833:(e,t,n)=>{n.d(t,{A:()=>c});var a=n(74848),s=n(39107),o=n(96540),r=n(17100);const c=({children:e,noClose:t=!1,...n})=>{const{open:c,setOpen:i,onClose:l,onClosed:d,onOpen:u,onOpened:m}=(0,r.Fs)(),h=(0,o.useId)();return(0,a.jsx)(s.VWm,{nav:h,open:c,onClose:(e,n)=>{t||(i(!1),l?.(e,n))},onClosed:d,onOpen:u,onOpened:m,...n,children:(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)(s.qBl,{}),children:e})})}},87675:(e,t,n)=>{n.a(e,async(e,a)=>{try{n.d(t,{A:()=>o});var s=n(93819);const e=await s.A,o=()=>e;a()}catch(e){a(e)}},1)},90639:(e,t,n)=>{n.d(t,{z:()=>a});var a=(0,n(78414).mT)("Icon20DeleteOutline","delete_outline_20","0 0 20 20",'<symbol xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20" id="delete_outline_20"><path fill-rule="evenodd" d="M6.837 4H2.75a.75.75 0 0 0 0 1.5h.545l.907 9.248c.051.523.094.96.157 1.314.066.37.163.711.353 1.028a2.9 2.9 0 0 0 1.247 1.131c.334.158.682.222 1.058.25.36.029.797.029 1.323.029h3.32c.526 0 .964 0 1.323-.028.376-.03.724-.093 1.058-.25a2.9 2.9 0 0 0 1.247-1.132c.19-.317.287-.657.353-1.028.063-.355.106-.79.157-1.314l.907-9.248h.545a.75.75 0 0 0 0-1.5h-4.087a3.25 3.25 0 0 0-6.326 0m1.581 0h3.164a1.751 1.751 0 0 0-3.164 0m6.78 1.5H4.802l.89 9.072c.054.56.091.938.143 1.228.05.281.104.422.162.52a1.4 1.4 0 0 0 .603.546c.102.048.248.088.533.11.294.024.673.024 1.235.024h3.262c.562 0 .941 0 1.235-.023.285-.023.43-.063.533-.111a1.4 1.4 0 0 0 .603-.547c.058-.097.112-.238.162-.52.052-.29.09-.667.144-1.226l.89-9.073Zm-2.886 2.002a.75.75 0 0 1 .685.81l-.5 6.003a.75.75 0 0 1-1.494-.124l.5-6.003a.75.75 0 0 1 .81-.686Zm-4.624 0a.75.75 0 0 1 .81.686l.5 6.002a.75.75 0 0 1-1.495.125l-.5-6.003a.75.75 0 0 1 .685-.81" clip-rule="evenodd" /></symbol>',20,20,!1,void 0)},95075:(e,t,n)=>{n.d(t,{A:()=>d});var a=n(22440),s=n(92046),o=n(65879);const r=(e,t)=>{switch(e){case"csv":case"dat":case"ecsv":case"ods":case"tsv":case"xar":case"xl":case"xlr":case"xls":case"xlsb":case"xlsm":case"xlsx":case"xlt":case"xltm":case"xltx":case"xlw":return"spreadsheet";case"ppt":case"ppta":case"pptm":case"pptx":return"default";default:switch(t){case 1:return"text";case 2:return"archive";case 3:return"gif";case 4:return"image";case 5:return"audio";case 6:return"video";case 7:return"ebook";default:return"default"}}};const c=function(e){if(!e.url)return;const t=e.preview?.photo?.sizes,n=!!t&&t.length>0,a=n?new Map:void 0;if(n&&a)for(const{type:e,src:n,width:s,height:o}of t)a.set(e,{url:n,width:s,height:o});const s={kind:"Doc",id:e.id,ownerId:e.owner_id,title:e.title||"image.png",size:e.size||0,ext:e.ext||"png",date:e.date||0,url:e.url||"",isUnsafe:Boolean(e.is_unsafe),type:r(e.ext,e.type)};return a&&(s.image=a),s};var i=n(44497);const l=(0,a.A)(),d=async(e,t=(0,i.A)())=>{const n=c(e);if(!n)return;const a=`${n.ownerId}_${n.id}`,r=(()=>{if(!l.vkmeIntegration)return!1;const e=l.cur.lastAddMedia?.menu;return!e?.menuNode||!e.menuNode.closest(".reply_box")})();if(l.cur.lastAddMedia&&!r){const e=l.cur.lastAddMedia.onChange;try{if(l.cur.lastAddMedia.onChange=async function(...t){const n=t[0];if(l.cur.lastAddMedia.onChange=e,e&&Reflect.apply(e,this,t),"doc"!==n)return;const a=(()=>{const e=l.cur.lastAddMedia.menu?.menuNode?.closest(".reply_box,.im-chat-input")||document.body,t=`._im_text_wrap .im-send-btn, #reply_button${l.cur.editing}, #reply_button${l.cur.oid}_${l.cur.pid}, .reply_send_button`;return e.querySelector(t)})();a?.onclick?(await(0,s.c)(200),a.onclick()):a?.click()},l.cur.chooseMedia("doc",a,{}),!r)return}catch(e){console.error(e)}}(await(0,o.A)()).store.dispatch({peerId:t,type:"UserChangedComposerDraft",kind:"addAttaches",attaches:{docs:[n]}}),await(0,s.c)(200);const d=document.querySelector(".Composer__button.Composer__button--submit,.ConvoComposer__button.ConvoComposer__sendButton--submit");d&&d.click()}}}]);