"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[5560,9186],{15609:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(74848),s=a(75623),o=a(39107);const r="j5noyirksU4hOAMT",i="FT_f_JIawX_phtyc",c=({children:e})=>(0,n.jsx)(s.A,{trigger:"click",placement:"top-start",usePortal:document.body,shown:!0,defaultShown:!0,disableCloseOnClickOutside:!0,disableCloseOnEscKey:!0,content:e,className:r,children:(0,n.jsx)(o.s6o,{className:i})})},22002:(e,t,a)=>{a.d(t,{A:()=>c});var n=a(88908),s=a(96540),o=a(74225),r=a.n(o),i=a(36008);const c=e=>{const[t,a]=(0,s.useState)(!0),[o,c]=(0,s.useState)(null),[l,d]=(0,s.useState)(!1);return r()(async t=>{if(!t())return;a(!0),d(!1),c(null);const s=(0,n.A)(e).trim(),o=new URLSearchParams({format:"json",request:JSON.stringify({blocks:[{block:"extra-content",params:{},version:2},{block:"i-global__params:ajax",params:{},version:2},{block:"misspell:ajax",params:{},version:2},{block:"preview__isWallpaper",params:{},version:2},{block:"content_type_search",params:{},version:2},{block:"serp-controller",params:{},version:2},{block:"cookies_ajax",params:{},version:2},{block:"advanced-search-props",params:{},version:2}]}),text:s}).toString();await i.default.sendMessage("vkn-b-aath",["ru","net","by","kz"].map(e=>`https://yandex.${e}/*`));const r=await fetch(`https://yandex.ru/images/search?${o}`,{method:"GET",credentials:"omit",headers:{"x-requested-with":"XMLHttpRequest"}}),{blocks:l,type:u}=await r.json();if("captcha"===u||!l){if(!t())return;return d(!0),void a(!1)}const m=l.find(e=>"content_type_search"===e.name.block)||l[1],h=(new DOMParser).parseFromString(m.html,"text/html"),{initialState:p}=JSON.parse(h.querySelector(".Root")?.dataset?.state||"{}");if(!p){if(!t())return;return c([]),void a(!1)}const g=[];for(const e of Object.values(p.serpList.items.entities))try{const t=e;g.push({thumb:t.image,origin:t.origUrl,size:{width:t.origWidth,height:t.origHeight}})}catch(e){console.error(e)}t()&&(c(g),a(!1))},[e]),{isLoading:t,items:o,isCaptcha:l}}},33151:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(74848),s=a(39107),o=a(38779);const r=({item:e,className:t,...a})=>(0,n.jsx)("span",{style:{backgroundImage:`url("${e?.thumb}")`},className:(0,s.xWm)(o.A.ImageBlock,t),...a});r.Skeleton=()=>(0,n.jsx)("span",{className:(0,s.xWm)(o.A.ImageBlock,o.A.ImageBlock__skeleton)});const i=r},38779:(e,t,a)=>{a.d(t,{A:()=>n});const n={PicPopover__content:"_DWyMKcMqSqAV7VZ",ImageBlock:"KjfsYAooKKxhTfby",ImageBlock__skeleton:"zxoYZ93XsEL41iyo",ImageBlockList:"zZr9DaA6rNe_TxlE"}},39186:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{default:()=>v});var s=a(74848),o=a(39107),r=a(96540),i=a(87675),c=a(15609),l=a(58689),d=a(9349),u=a(33151),m=a(38779),h=a(22002),p=e([i]);i=(p.then?(await p)():p)[0];const g=400,f=450,w=({children:e})=>(0,s.jsx)(o.guY,{className:m.A.PicPopover__content,style:{maxHeight:f,width:g},children:e}),k=({query:e})=>{const t=(0,i.A)(),{isLoading:a,items:n,isCaptcha:c}=(0,h.A)(e),[p,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{null!==!n&&k(!1)},[n]);if(p)return(0,s.jsx)(o.OrA,{style:{width:g,height:f},children:t.use("vkcom_inline_sent")});if(a)return(0,s.jsx)(w,{children:(0,s.jsx)("div",{className:m.A.ImageBlockList,children:new Array(9).fill(1).map((e,t)=>(0,s.jsx)(u.A.Skeleton,{},t))})});if(c)return(0,s.jsx)(o.OrA,{style:{width:g,height:f},title:t.use("vkcom_inline_сaptcha")});return!(null===n)&&n.length>0?(0,s.jsx)(w,{children:(0,s.jsx)("div",{className:m.A.ImageBlockList,children:n.map(e=>(0,s.jsx)(u.A,{item:e,onClick:()=>(async e=>{k(!0);let t=e.thumb;t.includes("http")||(t=`https:${t}`),await(0,l.A)(t),k(!1),(0,d.e8)()})(e)},e.origin))})}):(0,s.jsx)(o.OrA,{style:{width:g,height:f},children:t.use("global_not_found")})},v=({query:e})=>(0,s.jsx)(c.A,{children:(0,s.jsx)(k,{query:e})});n()}catch(e){n(e)}})},44497:(e,t,a)=>{a.d(t,{A:()=>n});const n=()=>{const e=window.location.pathname.match(/\/convo\/(-?\d+)/);if(e)return Number(e[1])||0;const t=new URLSearchParams(window.location.search),a=Number(t.get("sel"));return a||0}},58689:(e,t,a)=>{a.d(t,{A:()=>d});var n=a(92046),s=a(85560),o=a(93819),r=a(65879),i=a(44497),c=a(43024),l=a(43139);const d=async e=>{const t=await o.A;if(document.getElementById("reforged-root")){const a=(0,i.A)(),{upload_url:o}=await vkApi.api("photos.getMessagesUploadServer",{peer_id:a,upload_v2:0}),d=await fetch(e).then(e=>e.arrayBuffer()),u=new FormData;u.append("file",new File([d],"image.png",{type:"image/png"}));const m=await fetch(o,{method:"POST",body:u}),h=await m.json(),[p]=await vkApi.api("photos.saveMessagesPhoto",h),{store:g}=await(0,r.A)();g.dispatch({type:"UserChangedComposerDraft",kind:"addAttaches",attaches:{photos:[{kind:"Photo",accessKey:p.access_key,albumId:p.album_id,id:p.id,ownerId:p.owner_id,hasTags:p.has_tags,sizes:new Map,uploadDate:p.date}]},trackIds:[],peerId:a});const f=c.default.getValue("inlineRemoveWatermark"),w=(0,l.Mf)();(0,l.t$)();const k=document.querySelector(".ConvoComposer__input");return k&&(k.textContent=await(0,s.default)()&&f?"":`via [club207165415|${t.use("global_app_name")}]`),await(0,n.c)(500),void(w&&w.click())}return await new Promise(a=>{const n=window.cur.lastAddMedia.onChange;window.cur.lastAddMedia.onChange=async function(...e){const o=e[0];if(window.cur.lastAddMedia.onChange=n,n.apply(this,e),"photo"!==o)return;const r=(0,l.Ay)();r&&(r.classList.add("im-send-btn_audio"),r.classList.remove("im-send-btn_send"),r.classList.remove("im-send-btn_loading"),r.style.pointerEvents="");const i=c.default.getValue("inlineRemoveWatermark"),d=document.getElementsByClassName("im_editable")[0];if(d){const e=await(0,s.default)()&&i?"":`via [club207165415|${t.use("global_app_name")}]`;d.setValue(e),window.Emoji.editableFocus(d,!1,!0)}r&&r.click(),a(!0)},window.cur.lastAddMedia.checkURL(e,2e3,{})})}},61166:(e,t,a)=>{a.d(t,{A:()=>n});const n={PopoverReforged:"V5vFILKwsuTAoDXp","reforged-anim-fade-in":"aKnVnnmt_OsWj600","reforged-anim-fade-out":"uvPWUxQQgpV6cgFC","PopoverReforged--noBackground":"h4DVtB6f3FyJCExI"}},74225:(e,t,a)=>{var n=a(96540);function s(e,t,a){var s="function"==typeof t;n.useEffect(function(){var a,n=!0,o=e(function(){return n});return Promise.resolve(o).then(function(e){a=e}),function(){n=!1,s&&t(a)}},s?a:t)}e.exports=s,e.exports.useAsyncEffect=s},75623:(e,t,a)=>{a.d(t,{A:()=>i});var n=a(74848),s=a(39107),o=a(96540),r=a(61166);const i=({hideOnClick:e=!1,noBackground:t=!1,mode:a,onClick:i,onShownChange:c,className:l,contentWrapperClassName:d,shown:u,content:m,...h})=>{const[p,g]=(0,o.useState)(!1),f=(0,o.useRef)(null),w=(0,o.useRef)(null),k=(0,o.useCallback)(e=>{e?g(!0):f.current=setTimeout(()=>{g(!1)},100),c?.(e)},[a,c,g]);return(0,o.useEffect)(()=>{"boolean"==typeof u&&k(u)},[u,k]),(0,n.jsx)(s.AMh,{shown:p,className:(0,s.xWm)(r.A.PopoverReforged,t&&r.A["PopoverReforged--noBackground"],l),onShownChange:k,onClick:e=>{if("side"===a&&f.current)clearTimeout(f.current);else try{i?.(e)}catch(e){console.error(e)}},content:(0,n.jsx)("div",{ref:w,className:(0,s.xWm)(d),onClick:t=>{e&&w.current?.contains(t.target)&&g(!1)},children:m}),...h})}},85560:(e,t,a)=>{a.d(t,{default:()=>o});var n=a(79384),s=a(52815);const o=async()=>{const e=await(0,s.A)(),t=(0,n.A)(e[0][1]),a=(0,n.A)(e[1][1]);return!!(107<=t&&t<=110&&107<=a&&a<=110)}},87675:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.d(t,{A:()=>o});var s=a(93819);const e=await s.A,o=()=>e;n()}catch(e){n(e)}},1)},88908:(e,t,a)=>{a.d(t,{A:()=>s});const n=document.createElement("textarea"),s=e=>(n.innerHTML=e,n.innerText)}}]);