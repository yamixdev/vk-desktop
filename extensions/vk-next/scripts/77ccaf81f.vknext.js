"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[5560,6076],{2290:(e,t,a)=>{a.d(t,{A:()=>o});const o={JsonFormatSelectedValue:"Ek9qRnOxfJ94NbYl",JsonFormatSelectedValue__Name:"dTthfrcJcIo7MrAY",JsonFormatSelectedValue__Icon:"p8Mj7fJlgg49tbVw",ButtonWrapper:"t_vspRturOjxpvZq"}},24293:(e,t,a)=>{var o,r;a.d(t,{h:()=>o}),(r=o||(o={})).PREPARING="preparing",r.DOWNLOADING="downloading",r.FINISHED="finished",r.ARCHIVING="archiving"},32106:(e,t,a)=>{a.d(t,{_:()=>l});var o=a(92580),r=a(92046);let n,s=null,i=0;const c=async()=>{n||(n=(async()=>{if(await(0,r.c)(6e4),!s)return;const e=await s;e&&(0===i&&await(0,r.c)(1e4),0===i&&(s=null,e.remove()))})(),n.finally(()=>{n=null}))},l=async({onProgress:e,type:t,iframeURL:r="https://vknext.net/ffmpeg",...n})=>{const{promise:l,reject:d,resolve:u}=(0,o.Q)(),_="request-"+Math.random().toString(36).substr(2,9),h=await(e=>{if(s)return s;const{promise:t,resolve:a,reject:r}=(0,o.Q)();s=t;const n=document.querySelector(`iframe[src="${e}"]`);if(n)return a(n),t;const i=document.createElement("iframe");return i.src=e,i.style.setProperty("display","none","important"),i.onload=()=>a(i),i.onerror=r,(document.body||document.documentElement).appendChild(i),t})(r),{Bridge:g}=await a.e(2692).then(a.bind(a,42692)),f=new g(h.contentWindow,{prefix:"vknext-net-bridge"});return i++,f.on("progress",t=>{const a=t;a?.requestId===_&&e?.(a.progress,a.total)}),f.on("error",e=>{const t=e;t?.requestId===_&&(d(t?.error||"unknown error"),f.destroy(),i--,c())}),f.on("response",e=>{const t=e;t?.requestId===_&&(u(t.response),f.destroy(),i--,c())}),f.on("getBlob",e=>{const t=e;if(t?.requestId===_)return fetch(t.url).then(e=>e.blob())}),f.post(t,{...n,requestId:_}),l}},35584:(e,t,a)=>{a.d(t,{A:()=>o});const o=(e,t,a=null)=>{if(!Array.isArray(e)||0===e.length)return null;const o=[...e].sort((e,t)=>e.width<t.width?-1:e.width>t.width?1:e.height<t.height?-1:e.height>t.height?1:0),r=o.filter(e=>e.width>=t);if(0===r.length)return o[o.length-1];if(!a)return r[0];for(let e=0;e<r.length;e++){const t=r[e];if(t.height>=a)return t}const n=r.sort((e,t)=>t.height-e.height);return n[n.length-1]}},36076:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.r(t),a.d(t,{default:()=>p});var r=a(74848),n=a(39107),s=a(2290),i=a(95974),c=a(85560),l=a(33911),d=a(17100),u=a(38313),_=a(49962),h=a(87675),g=a(79705),f=a(56445),m=e([l,h,f]);[l,h,f]=m.then?(await m)():m;const p=({peerId:e,groupId:t})=>{const a=(0,h.A)(),[o,m]=(0,g.A)("downloadChatHistoryFormat"),[p,k]=(0,g.A)("downloadChatHistorySplit"),[v,w]=(0,g.A)("downloadChatHistoryPrettyPrint"),{closeModal:y}=(0,d.Hb)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.tUM,{mode:"accent",children:(0,r.jsxs)(n.ox2,{arrowSize:"m",children:[(0,r.jsx)(n.ORv,{selected:"txt"===o,onClick:()=>m("txt"),children:"TXT"}),(0,r.jsx)(n.ORv,{selected:"json"===o,onClick:()=>m("json"),children:"JSON"}),(0,r.jsx)(n.ORv,{selected:"html"===o,onClick:()=>m("html"),after:(0,r.jsxs)(l.A,{children:[(0,r.jsx)(l.A.PrimeDeluxe,{placement:"top"}),(0,r.jsx)(l.A.Beta,{placement:"right"})]}),children:"HTML"})]})}),(0,r.jsx)(n.YJl,{separator:"hide",children:(0,r.jsx)(n.iau,{style:{paddingTop:0,paddingBottom:0},children:(0,r.jsx)(n.lZ$,{extraSubtitle:a.use(`vkcom_download_chat_history_${o}_desc`)})})}),"json"===o&&(0,r.jsx)(n.YJl,{separator:"hide",children:(0,r.jsx)(n.T6P,{after:(0,r.jsx)(i.A,{}),Component:"label",onClick:()=>w(!v),children:a.use("vkcom_download_chat_history_pretty_print")})}),"html"===o?(0,r.jsx)(f.A,{}):(0,r.jsxs)(n.YJl,{header:(0,r.jsx)(n.Y9Y,{children:a.use("vkcom_download_chat_history_split_title")}),separator:"hide",children:[(0,r.jsx)(n.sxL,{name:"split",value:"true",checked:p,onChange:e=>{e.target.checked&&!p&&k(!0)},children:a.use("vkcom_download_chat_history_split")}),(0,r.jsx)(n.sxL,{name:"split",value:"false",checked:!p,onChange:e=>{e.target.checked&&p&&k(!1)},children:a.use("vkcom_download_chat_history_single_file")})]}),(0,r.jsx)(n.iau,{className:s.A.ButtonWrapper,children:(0,r.jsx)(n.$nd,{onClick:async()=>{"html"!==o||await(0,c.default)()?(y(),await(0,u.A)({peerId:e,groupId:t,saveAs:o,singleFile:!p,prettyPrint:v})):await(0,_.A)()},children:a.use("global_download")})})]})};o()}catch(e){o(e)}})},37746:(e,t,a)=>{a.d(t,{A:()=>n});const o=e=>{try{e.dispatchEvent(new MouseEvent("click"))}catch(t){const a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(a)}},r=async(e,t="download")=>{const a=document.createElement("a");a.download=t,a.rel="noopener",(globalThis?.chrome?.runtime?.id||globalThis?.browser?.runtime?.id)&&(a.target="_blank"),"string"==typeof e?(a.href=e,a.origin!==location.origin?await(async e=>{try{const t=await globalThis.fetch(e,{method:"HEAD"});return t.status>=200&&t.status<=299}catch(e){console.error(e)}return!1})(a.href)?await(async(e,t)=>{try{const a=await globalThis.fetch(e,{method:"GET"}),o=await a.blob();await r(o,t)}catch(e){console.error(e)}})(e,t):(a.target="_blank",o(a)):o(a)):(a.href=URL.createObjectURL(e),setTimeout(()=>{URL.revokeObjectURL(a.href)},4e4),setTimeout(()=>{o(a)},0))},n=r},38313:(e,t,a)=>{a.d(t,{A:()=>X});var o=a(37746),r=a(7618),n=a(39099),s=a(7408),i=a(93819),c=a(69128),l=a(40043),d=a(97307);const u=async(e,t,a)=>{const o={},{usersPromises:r,groupsPromises:n}=((e,t,a)=>{const o=[],r=[],n=a?"first_name,first_name_acc,last_name,last_name_acc,photo_50":"first_name,last_name,last_name_acc",s=a?"photo_50":void 0;if(e.length)for(const t of(0,d.A)(e,100))o.push(vkApi.api("users.get",{user_ids:t,fields:n}));if(t.length)for(const e of(0,d.A)(t,100))r.push(vkApi.api("groups.getById",{group_ids:e.map(e=>-e),fields:s}));return{usersPromises:o,groupsPromises:r}})(e,t,a);if(r.length){(await Promise.all(r)).flatMap(e=>e).forEach(e=>{o[e.id]||(e.deactivated&&!e.first_name?o[e.id]={ins:"DELETED",acc:"DELETED",picUrl:e.photo_50}:o[e.id]=a?{ins:`${e.first_name} ${e.last_name}`,acc:`${e.first_name_acc} ${e.last_name_acc}`,picUrl:e.photo_50}:{ins:`${e.first_name&&e.first_name[0]}. ${e.last_name}`,acc:`${e.first_name&&e.first_name[0]}. ${e.last_name_acc}`})})}if(n.length){(await Promise.all(n)).flatMap(e=>e.groups).forEach(e=>{o[-e.id]||(o[-e.id]={name:e.name},a&&(o[-e.id].picUrl=e.photo_50))})}return o};var _=a(43024),h=a(92046);const g=async(e,t,a=0)=>{const o=t?.retry||2,r=t?.delay||1e3;try{return await window.fetch(e,t)}catch(n){if(a<=o)return await(0,h.c)(r),await g(e,t,a+1);throw n}},f=g,m=async({attach:e,signal:t,lastModified:a})=>{if(t.aborted)return null;if("doc"!==e.type)return null;try{const o=e.doc.url;if(o){const r=await f(o,{signal:t}),n=await r.arrayBuffer();return{name:`docs/${e.doc.owner_id}/${e.doc.id}.${e.doc.ext||"png"}`,lastModified:a,input:new Blob([n])}}}catch(e){console.error(e)}return null},p=async({attach:e,signal:t,lastModified:a})=>{if(t.aborted)return null;if("gift"!==e.type)return null;try{const o=e.gift,r=o.thumb_512||o.thumb_256||o.thumb_128||o.thumb_96||o.thumb_48;if(r){const e=await f(r,{signal:t}),n=await e.arrayBuffer();return{name:`gifts/${o.id}.png`,lastModified:a,input:new Blob([n])}}}catch(e){console.error(e)}return null},k=async({attach:e,signal:t,lastModified:a})=>{if(t.aborted)return null;if("graffiti"!==e.type)return null;try{const o=e.graffiti.url;if(o){const r=await f(o,{signal:t}),n=await r.arrayBuffer();return{name:`graffiti/${e.graffiti.id}.png`,lastModified:a,input:new Blob([n])}}}catch(e){console.error(e)}return null},v=e=>e.reduce((e,t)=>{const a=t.width*t.height;return!e||a>e.width*e.height?t:e}),w=async({attach:e,signal:t,lastModified:a})=>{if(t.aborted)return null;if("photo"!==e.type)return null;try{const o=v(e.photo.sizes||[]),r=o?.url||o?.src;if(r){const o=await f(r,{signal:t,retry:10}),n=await o.arrayBuffer();return{name:`photos/${e.photo.owner_id}/${e.photo.id}.jpg`,lastModified:e.photo.date?new Date(1e3*e.photo.date):a,input:new Blob([n])}}}catch(e){console.error(e)}return null};var y=a(35584);const b=async({attach:e,signal:t,lastModified:a,isDark:o})=>{if(t.aborted)return null;if("sticker"!==e.type&&"ugc_sticker"!==e.type)return null;try{const r=e[e.type],n=o&&r?.images_with_background?r?.images_with_background:r?.images;if(!n)return null;const s=(0,y.A)(n,512)?.url;if(s){const e=await f(s,{signal:t}),n=await e.arrayBuffer();return{name:`stickers/${r.sticker_id||r.id}${o?"b":""}.png`,lastModified:a,input:new Blob([n])}}}catch(e){console.error(e)}return null};var x=a(36008),$=a(74732),A=a(99761);const M=async({attach:e,signal:t,lastModified:a})=>{if(t.aborted)return null;if("video_message"!==e.type&&"video"!==e.type)return null;const o="video_message"===e.type,r=e[e.type];if(!r.files)return null;const[n,s]=(0,A.A)(r.files),i=r.files?.hls,c=n&&s>=480||n&&!i?n:i||null;if(!c)return null;const l=`${o?"video_messages":"videos"}/${r.owner_id}/${r.id}.mp4`;let d=!1;try{if(c===i)try{await x.default.sendMessage("vkn-b-aath",new URL(c).origin+"/*");const e=await(0,$.A)(c,`${r.owner_id}_${r.id}.mp4`);return{name:l,lastModified:r.date?new Date(r.date):a,input:e}}catch(e){d=!0,console.error(e)}if(!n)return null;await x.default.sendMessage("vkn-b-aath",new URL(d?n:c).origin+"/*");const e=await f(d?n:c,{signal:t}),o=await e.arrayBuffer();return{name:l,lastModified:r.date?new Date(r.date):a,input:new Blob([o])}}catch(e){console.error(e)}return null},S=async({attach:e,signal:t,lastModified:a})=>{if(t.aborted)return null;if("audio_message"!==e.type)return null;try{const o=e.audio_message.link_mp3||e.audio_message.link_ogg,r=o===e.audio_message.link_ogg;if(o){const n=await f(o,{signal:t}),s=await n.arrayBuffer();return{name:`voices/${e.audio_message.owner_id}/${e.audio_message.id}.${r?"ogg":"mp3"}`,lastModified:a,input:new Blob([s])}}}catch(e){console.error(e)}return null},j=async({attaches:e,lastModified:t,signal:a,filesNotNull:o=[]})=>{if(!e?.length)return[];const r=[],n=_.default.getValue("downloadChatHistoryAttaches"),s=e=>{r.push(e)};for(const i of e)try{switch(i.type){case"photo":n.photos&&s(w({attach:i,lastModified:t,signal:a}));break;case"sticker":n.stickers&&(s(b({attach:i,lastModified:t,signal:a})),s(b({attach:i,lastModified:t,signal:a,isDark:!0})));break;case"audio_message":n.voices&&s(S({attach:i,lastModified:t,signal:a}));break;case"gift":n.gifts&&s(p({attach:i,lastModified:t,signal:a}));break;case"wall_reply":case"wall":try{const e=i[i.type];if(Array.isArray(e))for(const r of await j({attaches:e,lastModified:t,signal:a,filesNotNull:o}))r&&s(Promise.resolve(r))}catch(e){console.error(e)}break;case"ugc_sticker":n.stickers&&s(b({attach:i,lastModified:t,signal:a}));break;case"graffiti":n.graffiti&&s(k({attach:i,lastModified:t,signal:a}));break;case"video_message":if(n.videoMessages){const e=M({attach:i,lastModified:t,signal:a});try{await e,s(e)}catch(e){console.error(e)}}break;case"video":if(n.videos){const e=M({attach:i,lastModified:t,signal:a});try{await e,s(e)}catch(e){console.error(e)}}break;case"doc":n.docs&&s(m({attach:i,lastModified:t,signal:a}))}if(r.length%8==0)try{await Promise.all(r)}catch(e){console.error(e)}}catch(e){console.error(e)}for(const e of r)try{const t=await e;if(null===t)continue;o.push(t)}catch(e){console.error(e)}return o},E=j;var I=a(49032);const D=e=>{e.forEach(e=>{T(e),R(e)})},T=e=>{e.reply_message&&(e.reply_message.reply_message=void 0)},R=e=>{e.attachments?.filter(e=>"photo"===e.type).forEach(e=>{const t=v(e.photo.sizes||[]);e.photo.sizes=[t]})},B=(e,t)=>{const a=JSON.stringify(e,null,t?"\t":void 0);return new Blob([a],{type:"application/json;charset=utf-8"})},C=e=>{const t=(0,d.A)(e,I.Fl);return{chunks:t.map((e,t)=>({messages:e,name:""+t*I.Fl,index:t,offset:t*I.Fl,count:e.length})),count:t.length}},P=(e,t,a)=>{const o=5e3;return(0,d.A)(e,o).map((e,r)=>({input:B(e,t),name:`${r*o}-${r*o+e.length}.json`,lastModified:a}))},N=function({messages:e,singleFile:t,prettyPrint:a,lastModified:o,purpose:r}){return D(e),t?B(e,a):"html"===r?C(e):P(e,a,o)};var F=a(45568);const O="text/plain",U=(e,t,a=!1)=>{const o="vk.ru/"+(r.z.isGroupId(t)?"club"+-t:`id${t}`);let n;return n=r.z.isGroupId(t)?e[t].name||"":a?e[t]?.acc:e[t]?.ins,n?`${n} (${o})`:`${o}`},L=(e,t,a,o=new Date)=>{const r=e.map(e=>{const t=(0,F.A)(1e3*e.date);return e.action?`${t} | ${((e,t)=>{if(!e.action)return null;switch(e.action.type){case"chat_create":return`${U(t,e.from_id)} создал чат "${e.action.text}"`;case"chat_title_update":return`${U(t,e.from_id)} сменил названиие чата:"${e.action.old_text}" -> "${e.action.text}"`;case"chat_invite_user":return`${U(t,e.from_id)} пригласил(а) ${U(t,e.action.member_id,!0)}`;case"chat_kick_user":return e.from_id===e.action.member_id?`${U(t,e.from_id)} вышел из чата`:`${U(t,e.from_id)} исключил(а) ${U(t,e.action.member_id,!0)} из чата`;case"chat_invite_user_by_link":return`${U(t,e.from_id)} вступил в чат по ссылке`;default:return`Действие "${e.action.type}, инициатор: ${U(t,e.from_id)}, цель: ${e.action.member_id?U(t,e.action.member_id):"нет"}"`}})(e,a)} | cmid: ${e.conversation_message_id}`:`${t} | ${U(a,e.from_id)} | cmid: ${e.conversation_message_id}\n`+(e.fwd_messages.length?"[Пересланные сообщения]\n":"")+(e.reply_message?`[Ответ на сообщение: cmid ${e.reply_message.conversation_message_id}]\n`:"")+(e.text||"[Нет текста]")+(e.attachments.length?"\n"+(e=>{const t=[];return e.forEach(e=>{switch(e.type){case"photo":{const a=e?.photo?.sizes||[],o=v(a)?.url;o&&t.push(`[Фото (${o})]`);break}case"video_message":{const a=e.video_message.files?.mp4_480?e.video_message.files?.mp4_480:"Нет ссылки",o=e.video_message.transcript||"Нет транскрипции";t.push(`[Видеосообщение (${a}) (${o})]`);break}case"sticker":t.push("[Стикер]");break;case"audio_message":{const a=e.audio_message.link_mp3||"Нет ссылки",o=e.audio_message.transcript||"Нет транскрипции";t.push(`[Голосовое сообщение (${a}) (${o})]`);break}default:t.push("[Другое вложение]")}}),t.join("\n")})(e.attachments):"")});return t?new Blob([r.join("\n\n")],{type:O}):(0,d.A)(r,5e3).map((e,t)=>({input:new Blob([e.join("\n\n")],{type:O}),name:`${5e3*t}-${5e3*t+e.length}.txt`,lastModified:o}))};let H;const V=async e=>{return Array.isArray(e)?await(async e=>{const{downloadZip:t}=await a.e(1941).then(a.bind(a,71941)),o=await t(e).blob();return URL.createObjectURL(o)})(e):(t=e,URL.createObjectURL(t));var t},z=async(e,t)=>{const a=await i.A,{peerName:o}=await(0,n.A)(e,t),s={peerName:o};let c="";return c=r.z.isChatId(e)?a.use("vkcom_download_chat_history_downloading_chat",s):r.z.isGroupId(e)?a.use("vkcom_download_chat_history_downloading_group",s):a.use("vkcom_download_chat_history_downloading_user",s),c},J=(e,t,a)=>{H=(0,c.Hq)({id:`chat_${t}`,title:e,type:"chat_history",onCancel:a})},q=async(e,t,a)=>{let o=0,r=0;H.setProgress({current:o,total:r});const n=[];for await(const s of(0,l.A)(e,t,a)){!r&&s?.msg_count&&(r=s.msg_count,H.setProgress({current:o,total:r}));const e=s?.messages.sort((e,t)=>e.conversation_message_id&&t.conversation_message_id?e.conversation_message_id-t.conversation_message_id:e.date-t.date)||[];if(e.length>0&&(n.push(...e),o+=e.length,H.setProgress({current:o,total:r})),a.aborted)return null}return n},G=async(e,t,a)=>{try{const o=await fetch(e);if(o.ok){const e=await o.blob();a.push({id:t,blob:e})}else console.warn(`[VK Next] Failed to download avatar for ${t}`)}catch(e){console.warn(`[VK Next] Failed to download avatar for ${t}`,e)}},W=async(e,t,a,o)=>"txt"===t.saveAs?await Z(e,t.singleFile):"json"===t.saveAs?N({messages:e,singleFile:t.singleFile,prettyPrint:t.prettyPrint,lastModified:a}):await K(e,a,o),Y=(e,t=0)=>{let a=new Set,o=new Set;const n=e=>{e&&(r.z.isGroupId(e)?o.add(e):a.add(e))};return e.forEach(e=>{if(n(e.from_id),n(e.reply_message?.from_id),n(e.action?.member_id),t<10&&e.fwd_messages?.length){const r=Y(e.fwd_messages,t+1);a=new Set([...a,...r.userIds]),o=new Set([...o,...r.groupIds])}}),{userIds:[...a],groupIds:[...o]}},Z=async(e,t)=>{const{userIds:a,groupIds:o}=Y(e),r=await(async(e,t)=>await u(e,t,!1))(a,o);return L(e,t,r)},Q=async({message:e,lastModified:t,signal:a})=>{const o=[];try{for(const r of await E({attaches:e.attachments,lastModified:t,signal:a}))try{o.push(r)}catch(e){console.error(e)}if(Array.isArray(e.fwd_messages))for(const r of e.fwd_messages)try{const e=await Q({message:r,lastModified:t,signal:a});o.push(...e)}catch(e){console.error(e)}}catch(e){console.error(e)}return o},K=async(e,t,a)=>{let o=N({messages:e,singleFile:!1,prettyPrint:!1,lastModified:t,purpose:"html"});const r=await fetch(await(0,s.A)("chatHistory.html")).then(e=>e.text()),n=[],{userIds:c,groupIds:l}=Y(e),d=await(async(e,t)=>await u(e,t,!0))(c,l),_="window.peerNames="+JSON.stringify(d);n.push({input:new Blob([_],{type:"application/javascript"}),lastModified:t,name:"peerNames/index.js"});for(const e of o.chunks){const s=`<div id="data" data-curpage="${e.index+1}" data-pagescount="${o.count}"></div>`,i=r.replace("{messages}",JSON.stringify(e.messages)).replace("{pageInfo}",s),c=new Blob([i],{type:"text/html"});n.push({input:c,lastModified:t,name:`index${e.name}.html`});const l=new Set;for(const o of e.messages)try{for(const e of await Q({message:o,lastModified:t,signal:a}))l.has(e.name)||(l.add(e.name),n.push(e))}catch(e){console.error(e)}}const h=await(async e=>{const t=await i.A;H.setExtraText(t.use("vkcom_download_chat_history_downloading_subtitle_avatars"));let a=[];const o=[];for(const t in e)e[t].picUrl&&(a.push(G(e[t].picUrl,t,o)),20===a.length&&(await Promise.all(a),a=[]));return await Promise.all(a),o})(d);for(const e of h)n.push({input:e.blob,lastModified:t,name:`avatars/${e.id}.jpg`});const g=await fetch(await(0,s.A)("chatHistoryFiles.json")).then(e=>e.json());for(const e of g){const a=await(0,s.A)(e),o=await fetch(a).then(e=>e.blob());n.push({input:o,lastModified:t,name:e})}return n},X=async e=>{const t=new AbortController,{signal:a}=t,r=new Date,n=await z(e.peerId,e.groupId);let s;J(n,`${e.peerId}_${e.groupId||0}`,()=>t.abort());const c=await q(e.peerId,e.groupId,a);if(t.signal.aborted)return void H.cancel();if(!c)return;const l=await i.A;H.setExtraText(l.use("vkcom_download_chat_history_downloading_attachments")),H.setProgress({current:void 0,total:void 0}),s=c;let d=await W(s,e,r,a);if(!d)return;H.startArchiving();const u=await V(d);if(t.signal.aborted)return void H.cancel();H.setExtraText("");const _=()=>{return(0,o.A)(u,`${n}.${t=d,void 0!==t.arrayBuffer?e.saveAs:"zip"}`);var t};await _(),H.finish({onSave:_,onRemove:()=>URL.revokeObjectURL(u)})}},45568:(e,t,a)=>{a.d(t,{A:()=>o});const o=(e,t=!0,a=!1)=>{const o=new Date(e),r=e=>String(e).padStart(2,"0"),n=r(o.getDate()),s=r(o.getMonth()+1);let i=r(o.getFullYear());const c=r(o.getHours()),l=r(o.getMinutes()),d=r(o.getSeconds());return a&&(i=i.substring(2)),t?`${n}.${s}.${i}, ${c}:${l}:${d}`:`${n}.${s}.${i}`}},49032:(e,t,a)=>{a.d(t,{Fl:()=>s,XZ:()=>n,hj:()=>r,lz:()=>o,pz:()=>c});const o=/(^|\/)al_im\.php|(^|\/)im(\?|$)|(^|\/)gim\d+|\/write-?\d+/,r=/(^|\/)al_im\.php|(^|\/)im(\?|$)|\/write-?\d+|\/im\/.*/,n={"--accent":"--vkui--color_icon_accent","--background_content":"--vkui--color_background_content","--background_highlighted":"--vkui--color_transparent--active","--background_hover":"--vkui--color_transparent--hover","--background_light":"--vkui--color_background_tertiary","--background_page":"--vkui--color_background","--background_suggestions":"--vkui--color_background_modal","--button_commerce_background":"--vkui--color_text_positive","--button_secondary_background":"--vkui--color_background_secondary_alpha","--button_secondary_destructive_foreground":"--vkui--color_background_negative","--content_tint_background":"--vkui--color_background_secondary","--content_warning_background":"--vkui--color_background_warning","--counter_prominent_text":"--vkui--color_text_contrast","--destructive":"--vkui--color_text_negative","--dynamic_gray":"--vkui--color_accent_gray","--dynamic_green":"--vkui--color_accent_green","--dynamic_orange":"--vkui--color_accent_orange","--dynamic_purple":"--vkui--color_accent_purple","--dynamic_red":"--vkui--color_accent_red","--dynamic_violet":"--vkui--color_accent_violet","--dynamic_blue":"--vkui--color_accent_blue","--dynamic_raspberry_pink":"--vkui--color_accent_raspberry_pink","--field_background":"--vkui--color_field_background","--field_border":"--vkui--color_field_border_alpha","--field_error_background":"--vkui--color_background_negative_tint","--field_error_border":"--vkui--color_stroke_negative","--field_valid_border":"--vkui--color_stroke_positive","--header_background":"--vkui--color_header_background","--header_tint_alternate":"--vkui--color_icon_accent_themed","--icon_alpha_placeholder":"--vkui--color_icon_contrast","--icon_medium_alpha":"--vkui--color_icon_medium_alpha","--icon_medium":"--vkui--color_icon_medium","--icon_secondary_alpha":"--vkui--color_icon_secondary_alpha","--icon_secondary":"--vkui--color_icon_secondary","--icon_tertiary_alpha":"--vkui--color_icon_tertiary_alpha","--icon_tertiary":"--vkui--color_icon_tertiary","--image_border":"--vkui--color_image_border_alpha","--input_background":"--vkui--color_write_bar_input_background","--input_border":"--vkui--color_write_bar_input_border_alpha","--link_alternate":"--vkui--color_text_link_themed","--loader_track_fill":"--vkui--color_track_background","--loader_track_value_fill":"--vkui--color_track_buffer","--placeholder_icon_background_opaque":"--vkui--color_image_placeholder_alpha","--placeholder_icon_background":"--vkui--color_image_placeholder","--search_bar_field_background":"--vkui--color_search_field_background","--segmented_control_bar_background":"--vkui--color_segmented_control","--separator_alpha":"--vkui--color_separator_primary_alpha","--separator_alternate":"--vkui--color_separator_secondary","--separator_common":"--vkui--color_separator_primary","--skeleton_foreground_from":"--vkui--color_skeleton_from","--skeleton_foreground_to":"--vkui--color_skeleton_to","--text_link":"--vkui--color_text_link","--text_muted":"--vkui--color_text_muted","--text_primary":"--vkui--color_text_primary","--text_secondary":"--vkui--color_text_secondary","--text_subhead":"--vkui--color_text_subhead","--text_tertiary":"--vkui--color_text_tertiary","--writebar_icon":"--vkui--color_write_bar_icon","--gray_400":"--vkui--color_text_secondary","--gray_500":"--vkui--color_text_subhead","--gray_600":"--vkui--color_text_subhead","--gray_900":"--vkui--color_text_muted","--im_forward_line_tint":"--vkui--vkontakte_color_im_forward_line_alpha","--im_bubble_incoming":"--vkui--vkontakte_color_im_bubble_incoming","--im_bubble_incoming_alternate":"--vkui--vkontakte_color_im_bubble_incoming_alternate","--im_bubble_incoming_expiring":"--vkui--vkontakte_color_im_bubble_incoming_expiring","--im_bubble_border_alternate_highlighted":"--vkui--vkontakte_color_im_bubble_border_alternate_highlighted_alpha","--modal_card_background":"--vkui--color_background_modal","--im_bubble_outgoing":"--vkui--vkontakte_color_im_bubble_outgoing"},s=1e3,i=globalThis.navigator.hardwareConcurrency||1,c=Math.max(1,Math.floor(i/2))},49962:(e,t,a)=>{a.d(t,{A:()=>r});var o=a(81192);const r=()=>(0,o.default)("#/deluxe")},52079:(e,t,a)=>{e.exports=a(97273)},56445:(e,t,a)=>{a.a(e,async(e,o)=>{try{a.d(t,{A:()=>l});var r=a(74848),n=a(39107),s=a(87675),i=a(79705),c=e([s]);s=(c.then?(await c)():c)[0];const l=()=>{const e=(0,s.A)(),[t,a]=(0,i.A)("downloadChatHistoryAttaches");return(0,r.jsxs)(n.YJl,{header:(0,r.jsx)(n.Y9Y,{children:e.use("vkcom_download_chat_history_attaches_title")}),separator:"hide",mode:"plain",children:[(0,r.jsx)(n.Sc0,{checked:Boolean(t.photos),onChange:({target:e})=>a({...t,photos:e.checked}),children:e.use("vkcom_download_chat_history_attaches_photos")}),(0,r.jsx)(n.Sc0,{checked:Boolean(t.videos),onChange:({target:e})=>a({...t,videos:e.checked}),children:e.use("vkcom_download_chat_history_attaches_videos")}),(0,r.jsx)(n.Sc0,{checked:Boolean(t.voices),onChange:({target:e})=>a({...t,voices:e.checked}),children:e.use("vkcom_download_chat_history_attaches_voices")}),(0,r.jsx)(n.Sc0,{checked:Boolean(t.videoMessages),onChange:({target:e})=>a({...t,videoMessages:e.checked}),children:e.use("vkcom_download_chat_history_attaches_video_messages")}),(0,r.jsx)(n.Sc0,{checked:Boolean(t.stickers),onChange:({target:e})=>a({...t,stickers:e.checked}),children:e.use("vkcom_download_chat_history_attaches_stickers")}),(0,r.jsx)(n.Sc0,{checked:Boolean(t.gifts),onChange:({target:e})=>a({...t,gifts:e.checked}),children:e.use("vkcom_download_chat_history_attaches_gifts")}),(0,r.jsx)(n.Sc0,{checked:Boolean(t.graffiti),onChange:({target:e})=>a({...t,graffiti:e.checked}),children:e.use("vkcom_download_chat_history_attaches_graffiti")}),(0,r.jsx)(n.Sc0,{checked:Boolean(t.docs),onChange:({target:e})=>a({...t,docs:e.checked}),children:e.use("vkcom_download_chat_history_attaches_docs")})]})};o()}catch(e){o(e)}})},63989:(e,t,a)=>{a.d(t,{VZ:()=>o,fU:()=>n,oT:()=>r});class o extends Error{constructor(e){super(`Download task with ID ${e} not found.`),this.name="DownloadTaskNotFoundError"}}class r extends Error{constructor(e){super(`Download task with ID ${e} is already finished.`),this.name="DownloadTaskAlreadyFinishedError"}}class n extends Error{constructor(e){super(`Download task with ID ${e} has already timed out.`),this.name="DownloadTaskTimeoutError"}}},69106:(e,t,a)=>{a.d(t,{$:()=>s});var o=a(81621),r=a(24293),n=a(63989);const s=(0,o.vt)((e,t)=>{const a=e=>{const a=new Map(t().tasks).get(e);if(!a)throw new n.VZ(e);return a},o=t=>{e(e=>{const a=new Map(e.tasks),o=a.get(t);if(o?.onRemove)for(const e of o.onRemove)e();return a.delete(t),{tasks:a}})},s=s=>({setExtraText:t=>((t,o)=>{const r=a(t);e(e=>{const a=new Map(e.tasks);return a.set(t,{...r,extraText:o}),{tasks:a}})})(s,t),setPhotoUrl:t=>((t,o)=>{const r=a(t);e(e=>{const a=new Map(e.tasks);return a.set(t,{...r,photoUrl:o}),{tasks:a}})})(s,t),setTitle:t=>((t,o)=>{const r=a(t);e(e=>{const a=new Map(e.tasks);return a.set(t,{...r,title:o}),{tasks:a}})})(s,t),setProgress:o=>((o,s)=>{const i=a(o),c=new Map(t().tasks);if(i.status===r.h.FINISHED)throw new n.oT(o);e(()=>(c.set(o,{...i,progress:s,status:r.h.DOWNLOADING}),{tasks:c}))})(s,o),startArchiving:()=>(t=>{const o=a(t);e(e=>{const a=new Map(e.tasks);return a.set(t,{...o,status:r.h.ARCHIVING}),{tasks:a}})})(s),finish:t=>((t,s)=>{const i=a(t);if(i.status===r.h.FINISHED)throw new n.oT(t);if(i.timeoutId)throw new n.fU(t);const c=setTimeout(()=>o(t),60*(s?.onSave?15:5)*1e3);e(e=>{const a=new Map(e.tasks),o=new Set(i.onRemove);return s?.onRemove&&o.add(s.onRemove),a.set(t,{...i,onRemove:o,timeoutId:c,onSave:s?.onSave,status:r.h.FINISHED}),{tasks:a}})})(s,t),cancel:()=>(t=>{const o=a(t);for(const e of o.onCancel)e();e(e=>{const a=new Map(e.tasks);return a.delete(t),{tasks:a}})})(s),remove:()=>o(s)});return{tasks:new Map,startDownload:({id:t,onCancel:a,...o})=>{const n={...o,id:t,progress:{current:void 0,total:void 0},status:r.h.PREPARING,onCancel:new Set(a?[a]:[]),onRemove:new Set};e(e=>{const a=new Map(e.tasks);return a.set(t,n),{tasks:a}});const i=s(t);return{id:t,...i}},getTask:e=>{const t=a(e);return t?{...t}:void 0},getTaskHandlersById:s}})},69128:(e,t,a)=>{a.d(t,{Hq:()=>n,S:()=>c,_5:()=>i,cy:()=>s,hF:()=>r.h});var o=a(69106),r=a(24293);const n=e=>o.$.getState().startDownload(e),s=e=>o.$.getState().getTask(e),i=()=>(0,o.$)(e=>e.tasks),c=e=>(0,o.$)(e=>e.getTaskHandlersById)(e)},72257:(e,t,a)=>{e.exports=a(72518)},72518:(e,t,a)=>{
/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var o=a(96540);var r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=o.useState,s=o.useEffect,i=o.useLayoutEffect,c=o.useDebugValue;function l(e){var t=e.getSnapshot;e=e.value;try{var a=t();return!r(e,a)}catch(e){return!0}}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var a=t(),o=n({inst:{value:a,getSnapshot:t}}),r=o[0].inst,d=o[1];return i(function(){r.value=a,r.getSnapshot=t,l(r)&&d({inst:r})},[e,a,t]),s(function(){return l(r)&&d({inst:r}),e(function(){l(r)&&d({inst:r})})},[e]),c(a),a};t.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:d},74732:(e,t,a)=>{a.d(t,{A:()=>s});var o=a(32106);const r=async(e,t)=>{const a=await(0,o._)({url:e,filename:t,type:"convertM3u8ToMp4"});return new File([a],t,{type:"video/mp4"})};var n=a(36008);const s=async(e,t)=>(await n.default.sendMessage("vkn-b-aath",new URL(e).origin+"/*"),await r(e,t))},81621:(e,t,a)=>{a.d(t,{vt:()=>_});const o=e=>{let t;const a=new Set,o=(e,o)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=o?o:"object"!=typeof r||null===r)?r:Object.assign({},t,r),a.forEach(a=>a(t,e))}},r=()=>t,n={setState:o,getState:r,getInitialState:()=>s,subscribe:e=>(a.add(e),()=>a.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),a.clear()}},s=t=e(o,r,n);return n},r=e=>e?o(e):o;var n=a(96540),s=a(52079);const{useDebugValue:i}=n,{useSyncExternalStoreWithSelector:c}=s;let l=!1;const d=e=>e;const u=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?r(e):e,a=(e,a)=>function(e,t=d,a){a&&!l&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),l=!0);const o=c(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,a);return i(o),o}(t,e,a);return Object.assign(a,t),a},_=e=>e?u(e):u},85560:(e,t,a)=>{a.d(t,{default:()=>n});var o=a(79384),r=a(52815);const n=async()=>{const e=await(0,r.A)(),t=(0,o.A)(e[0][1]),a=(0,o.A)(e[1][1]);return!!(107<=t&&t<=110&&107<=a&&a<=110)}},95974:(e,t,a)=>{a.d(t,{A:()=>s});var o=a(74848),r=a(39107);const n="_ME21DoLEVJUlnQU",s=({className:e,...t})=>(0,o.jsx)(r.V9m,{value:r.ODD.ANDROID,children:(0,o.jsx)(r.dOG,{className:(0,r.xWm)(n,e),...t})})},97273:(e,t,a)=>{
/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var o=a(96540),r=a(72257);var n="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},s=r.useSyncExternalStore,i=o.useRef,c=o.useEffect,l=o.useMemo,d=o.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,a,o,r){var u=i(null);if(null===u.current){var _={hasValue:!1,value:null};u.current=_}else _=u.current;u=l(function(){function e(e){if(!c){if(c=!0,s=e,e=o(e),void 0!==r&&_.hasValue){var t=_.value;if(r(t,e))return i=t}return i=e}if(t=i,n(s,e))return t;var a=o(e);return void 0!==r&&r(t,a)?(s=e,t):(s=e,i=a)}var s,i,c=!1,l=void 0===a?null:a;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,a,o,r]);var h=s(e,u[0],u[1]);return c(function(){_.hasValue=!0,_.value=h},[h]),d(h),h}},97307:(e,t,a)=>{function o(e,t){const a=[];for(let o=0;o<e.length;o+=t){const r=e.slice(o,o+t);a.push(r)}return a}a.d(t,{A:()=>o})},99761:(e,t,a)=>{a.d(t,{A:()=>o});const o=e=>{const t=Object.keys(e).filter(e=>e.startsWith("mp4_"));t.sort((e,t)=>{const a=parseInt(e.split("_")[1]);return parseInt(t.split("_")[1])-a});for(const a of t)if(e[a])return[e[a],Number(a.split("_")[1])];return[null,null]}}}]);