"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[2976],{10769:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t);var s=r(74848),i=r(57580),n=r(44886),l=r(67767),o=r(13792),c=r(3068),u=r(43024),d=r(29260),f=e([i]);i=(f.then?(await f)():f)[0];const g=async()=>{try{const e=u.default.getValue("customFilter");if(e.trim().length){const t=(await Promise.resolve().then(r.bind(r,32488))).default;if(await t())return e.toLowerCase()}}catch(e){console.error(e)}return""},w=async e=>{const t=(await(0,o.A)()).get(e)||[],r=u.default.getValue(`exclude_vtFilter_${e}`)||[],a=new Set;for(const e of t)r.includes(e)||a.add(e.toLowerCase());return Array.from(a)},h=async()=>{let e=(await g()).split(",");u.default.getValue("defaultFilter")&&(e=e.concat(await w("defaultFilter")));const t=(await Promise.resolve().then(r.bind(r,32488))).default;await t()&&(u.default.getValue("filterShortLinks")&&(e=e.concat(await w("filterShortLinks"))),u.default.getValue("filterRefLinks")&&(e=e.concat(await w("filterRefLinks"))));for(const t of Object.keys(u.default.getStorageWithDefault())){const r=t;r.startsWith("vtFilter_")&&(u.default.getValue(r)&&(e=e.concat(await w(r))))}return e||!1};let m,p;const _=(e,t)=>{const r=(0,n.A)(t.toLowerCase()),a=r.split(" "),s=[];for(const t of e){const e=u.default.getValue("postFiltersRemoveSpecialSymbols")?(0,n.A)(t.trim()):t.trim();e.length&&(e.includes(" ")?r.includes(e)&&s.push(t):a.includes(e)&&s.push(t))}return{isFiltered:s.length>0,triggeredFilters:s}},v=async(e,t)=>{const a=e.querySelector('[data-testid="post-content-container"] + .vkuiDiv__host:has(.vkuiIcon--like_outline_24) > .vkuiDiv__host');if(a){for(const e of a.querySelectorAll(`.${d.A.TriggeredFiltersMark__wrapper}`))e.remove();const e=document.createElement("div");e.className=d.A.TriggeredFiltersMark__wrapper,a.insertAdjacentElement("afterend",e);const{default:i}=await Promise.all([r.e(961),r.e(7397),r.e(1649),r.e(8414),r.e(8340)]).then(r.bind(r,98340));return void await(0,c.A)({root:e,content:(0,s.jsx)(i,{filters:t}),disableParentTransformForPositionFixedElements:!0})}const i=e.querySelector(".post_info");if(i){for(const e of i.querySelectorAll(`.${d.A.TriggeredFiltersMark__wrapper}`))e.remove();const e=i.querySelector(".like_wrap"),a=document.createElement("div");a.className=d.A.TriggeredFiltersMark__wrapper,i.insertBefore(a,e);const{default:n}=await Promise.all([r.e(961),r.e(7397),r.e(1649),r.e(8414),r.e(8340)]).then(r.bind(r,98340));await(0,c.A)({root:a,content:(0,s.jsx)(n,{filters:t}),disableParentTransformForPositionFixedElements:!0})}},k=async e=>{if(p&&clearInterval(p),m||(m=await h()),m){p=setTimeout(()=>{m=!1},2e3);const t=e.querySelector('.wall_post_text,[class*="PostText__root--"],[class*="PostTextV2__root--"]')?.innerText;if(!t)return!1;const{isFiltered:r,triggeredFilters:a}=_(m,t);if(r)return u.default.getValue("postFiltersMark")?v(e,a):e.remove(),!0}return!1},F=async e=>{if(!u.default.getValue("enablePostFiltersInGroups")&&document.getElementsByClassName("group-redesigned-narrow").length)return;const t=e;await k(t)},y=async()=>{if(u.default.hasEnabledValues(["defaultFilter","filterShortLinks"]))return!0;if(0!==u.default.getValue("customFilter").trim().length){const e=(await Promise.resolve().then(r.bind(r,32488))).default;if(await e())return!0}return!!Object.keys(u.default.getStorageWithDefault()).some(e=>e.startsWith("vtFilter_")&&!0===u.default.getValue(e))};let A=null;const S=async()=>{if(await y()){if(A)return;A=(0,l.A)(F)}else A&&(A(),A=null)};0,u.default.onInited(S),u.default.addListener(S),a()}catch(e){a(e)}})},13792:(e,t,r)=>{r.d(t,{A:()=>l});var a=r(47355);const s=new Map,i=async(e,t=!1)=>{const{link:r,version:n,id:l}=e,o=(0,a.A)(l),c=new URL(t?`https://api.vknext.net/internal.getRawText?url=${r}`:r);c.searchParams.set("v",n);try{const e=await fetch(c.toString()).then(e=>e.text());s.set(o,e.split("\n"))}catch(t){return console.error(t),i(e,!0)}};let n;const l=()=>(n||(n=(async()=>{const e=await fetch("https://adlist.vtosters.app/v1/lists/get",{method:"POST",headers:{"Accept-Encoding":"gzip"}}),t=await e.json();return await Promise.all(t.map(e=>i(e,!1))),s})()),n)},29260:(e,t,r)=>{r.d(t,{A:()=>a});const a={TriggeredFiltersMark__wrapper:"wEZEv6FtVWum_ijw"}},44886:(e,t,r)=>{r.d(t,{A:()=>a});const a=(e,t="")=>e.replace(/[«»/"`~!@#$%^&*()_|+\-=?;:'",.<>\\{\\}\\[\]\\\\/]/gi,t)},47355:(e,t,r)=>{r.d(t,{A:()=>s});const a={1:"defaultFilter",2:"filterShortLinks",3:"filterRefLinks"},s=e=>a[e]||`vtFilter_${e}`}}]);