"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[122],{14694:(t,e,a)=>{a.d(e,{A:()=>r});const r=()=>"https://api.vknext.net"},24370:(t,e,a)=>{a.d(e,{Q:()=>c});var r=a(92046),n=a(14694),s=a(88400),i=a(46140),o=a(47961);class c{vkapi;vkAgents;userId;constructor({api:t}){this.vkapi=t,this.userId=0,this.vkAgents=new Map}async call(t,e,a){const i=await this.getVkAgent(),o={...e,"vknext-agent":await this.gvkna()};let c=0;const d=`${(0,n.A)()}/${t}`,u=JSON.stringify(o),l={Accept:"application/json","Content-Type":"application/json","VK-Agent":i,"VK-User-ID":`${this.userId||0}`,"9603a224b40d7b67210b78f2e390d00f":"ba05681e16c97c31e1be20e84f250d55","Api-Version":"3",...a};let w=new Response(JSON.stringify({error_code:408}),{status:408});for(;c<3;){const t=new AbortController,e=setTimeout(()=>t.abort(),15e3);try{if(w=await fetch(d,{body:u,method:"POST",headers:l,signal:t.signal}),502!==w.status)return(0,s.A)(w);{await(0,r.c)(2e3);const t=await w.text();if(!t.toLowerCase().includes("cloudflare"))return(0,s.A)(w);await(0,r.c)(c)}}catch(t){console.error(t),await(0,r.c)(2e3)}clearTimeout(e),c++}return(0,s.A)(w)}async getVkAgent(){if(0===this.userId&&(this.userId=await this.getUserId()),this.vkAgents.has(this.userId))return this.vkAgents.get(this.userId);return(0,i.A)(this.userId,this.vkapi)}async gvkna(){return await(0,o.A)(this.userId,"ba05681e16c97c31e1be20e84f250d55",this)}resetUserId(){this.userId=0}async getUserId(){return 0}async getRuntimeId(){return""}async getVersion(){return""}}},46140:(t,e,a)=>{a.d(e,{A:()=>l});var r=a(22440),n=a(92046),s=a(98570),i=a(75412);const o=(0,r.A)(),c=async t=>{const e=(0,s.A)().browserApi;if(e){return(await e.storage.local.get(t))[t]}if(o?.localStorage)return o.localStorage.getItem(t);const{storage:r}=await a.e(6815).then(a.t.bind(a,96815,23));return(await r.local.get(t))[t]},d=async(t,e)=>{const r=(0,s.A)().browserApi;if(r)return void await r.storage.local.set({[t]:e});if(o?.localStorage)return void o.localStorage.setItem(t,e);const{storage:n}=await a.e(6815).then(a.t.bind(a,96815,23));await n.local.set({[t]:e})},u=async(t,e)=>{const a=`vknLP${t}`,r=`vknLPD${t}`,s=await c(a),o=await c(r);if(s&&Date.now()-(parseInt(o||"")||0)<216e5)return s?.response||s;try{const s=await e.apps.getAppLaunchParams({mini_app_id:await(0,i.A)(),referer:"other",v:"5.123"}),o=new URLSearchParams(Object.entries(s)).toString();return o?(await d(a,o),await d(r,Date.now().toString()),o):(await(0,n.c)(5e3),u(t,e))}catch(a){return console.error(a),await(0,n.c)(1500),u(t,e)}},l=u},47961:(t,e,a)=>{a.d(e,{A:()=>n});var r=a(387);const n=async(t,e,a)=>{try{delete Uint8Array.prototype.toJSON}catch(t){console.error(t)}const n=(0,r.A)(),s=((t,e)=>{const a=t.toString().length,r=new Uint8Array(16);for(let n=0;n<e.length;n++){const s=e.charCodeAt(n)*t/a;r[n%16]^=255&s}return r})(t,e),i=await(t=>crypto.subtle.importKey("raw",t,{name:"AES-CBC"},!1,["encrypt"]))(s),o={version:await a.getVersion(),udGltZS5p:await a.getRuntimeId(),cGlkb3I:t,fdhjiD:"ba05681e16c97c31e1be20e84f250d55",v9Cdi3sD:n},c=JSON.stringify(o),d=(new TextEncoder).encode(c),u={name:"AES-CBC",iv:crypto.getRandomValues(new Uint8Array(16))},l=await crypto.subtle.encrypt(u,i,d),w=new Uint8Array(u.iv.length+l.byteLength);return w.set(new Uint8Array(u.iv),0),w.set(new Uint8Array(l),u.iv.length),w}},70122:(t,e,a)=>{a.r(e),a.d(e,{default:()=>c});var r=a(98570),n=a(24370),s=a(87251);const i=new n.Q({api:s.default});let o=!1;i.getUserId=async()=>"number"==typeof window.vk?.id?window.vk.id:o?await new Promise(t=>{const e=setInterval(()=>{o||(t(s.default.user_id),clearInterval(e))},200)}):(s.default.user_id||(o=!0,await s.default.forceUpdateToken(),o=!1),s.default.user_id),i.getRuntimeId=async()=>{const{getManifest:t}=(0,r.A)().browserApi;return t().id},i.getVersion=async()=>{const{getManifest:t}=(0,r.A)().browserApi;return t().version};const c=i},75412:(t,e,a)=>{a.d(e,{A:()=>n});var r=a(14694);const n=async()=>{try{const t=await fetch(`${(0,r.A)()}/internal.getAuthAppId`,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json","Api-Version":"3"}});if(t.ok)return parseInt(await t.text())}catch(t){console.error("[VK Next/getAuthAppId] Error:",t)}return 8194076}},88400:(t,e,a)=>{a.d(e,{A:()=>r});const r=async t=>{const e=await t.json(),r=t.headers.get("Content-Type");if(r&&r.startsWith("application/x-vknextpack")&&e)try{const t=new Uint8Array(Object.values(e)),{decode:r}=await a.e(7802).then(a.bind(a,77802));return r(t)}catch(t){console.error(t)}return e}}}]);