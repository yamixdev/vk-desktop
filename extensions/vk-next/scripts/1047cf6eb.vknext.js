"use strict";(globalThis.webpackChunkvknext=globalThis.webpackChunkvknext||[]).push([[4352,5680],{5680:(e,t,n)=>{n.a(e,async(e,s)=>{try{n.r(t),n.d(t,{default:()=>C});var o=n(74848),a=n(72453),r=n(39107),l=n(96540),c=n(74225),i=n.n(c),d=n(82295),m=n(62353),u=n(75623),p=n(94249),h=n(7618),g=n(55517),f=n(87675),v=n(64352),A=n(84072),_=n(99716),x=n(77898),w=n(78469),y=e([f]);f=(y.then?(await y)():y)[0];const k=()=>{const e=(0,f.A)(),[t,n]=(0,l.useState)(null),s=(0,g.A)();i()(async t=>{if(!s)return;if(!t())return;const o=[],a=await v.default.getTemplates(window.vk.id),r=await(0,w.A)(s),l="User"===r.kind,c="Chat"===r.kind,i="Group"===r.kind,m=await(0,w.A)(window.vk.id);for(let[t,n]of a){if((n.includes("{user name}")||n.includes("{user surname}"))&&(n=n.replaceAll("{user name}",l?r.firstName:""),n=n.replaceAll("{user surname}",l?r.lastName:"")),n.includes("{chat name}")&&(n=n.replaceAll("{chat name}",c?r.title:"")),n.includes("{group name}")&&(n=n.replaceAll("{group name}",i?r.name:"")),(n.includes("{my name}")||n.includes("{my surname}"))&&(n=n.replaceAll("{my name}",m.firstName),n=n.replaceAll("{my surname}",m.lastName)),n.includes("{time}")){const e=(new Date).toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"});n=n.replaceAll("{time}",e)}if(n.includes("{user id}")&&(n=n.replaceAll("{user id}",s.toString())),n.includes("{user link}"))if(h.z.isChatId(s))n=n.replaceAll("{user link}","");else{const e=s<0?"club":"id";n=n.replaceAll("{user link}",`https://${d.A}/${e}${Math.abs(s)}`)}if(n.includes("{my id}")&&(n=n.replaceAll("{my id}",window.vk.id.toString())),n.includes("{my link}")&&(n=n.replaceAll("{my link}",`https://${d.A}/id${Math.abs(window.vk.id)}`)),n.includes("{greeting}")){const t=(new Date).getHours(),s=t>=3&&t<12?e.use("vkcom_template_greeting_good_morning"):t>=12&&t<17?e.use("vkcom_template_greeting_good_afternoon"):t>=17&&t<=23?e.use("vkcom_template_greeting_good_evening"):e.use("vkcom_template_greeting_good_night");n=n.replaceAll("{greeting}",s)}o.push([t,n])}t()&&n(o)},[s]);return(0,o.jsxs)("div",{className:x.A.templates_container,children:[(0,o.jsxs)("header",{className:x.A.templates_header,children:[(0,o.jsx)("h2",{className:x.A.templates_title,children:e.use("vkcom_menu_templates_title")}),(0,o.jsx)(r.N_E,{onClick:()=>(0,_.A)(1102),children:e.use("vkcom_templates_settings")})]}),null===t?(0,o.jsx)("ul",{className:`${x.A.templates_list} ${x.A.templates_list_skelet}`,children:new Array(6).fill(void 0).map((e,t)=>(0,o.jsxs)("li",{className:x.A.templates_item,children:[(0,o.jsx)("h3",{className:x.A.templates_item_name,children:(0,o.jsx)(r.EAD,{width:120})}),(0,o.jsx)("span",{className:x.A.templates_item_text,children:(0,o.jsx)(r.EAD,{width:250})})]},t))}):t.length?(0,o.jsx)(p.Z,{autoHide:!1,style:{maxHeight:270},children:(0,o.jsx)("ul",{className:x.A.templates_list,children:t.map(([e,t],n)=>(0,o.jsxs)("li",{className:x.A.templates_item,onClick:()=>(e=>{const t=document.querySelector(".ConvoComposer__input");if(!t)return;t.innerText=t.innerText+e,t.focus();const n=window.getSelection();if(!n)return;const s=document.createRange();s.selectNodeContents(t),s.collapse(!1),n.removeAllRanges(),n.addRange(s)})(t),children:[(0,o.jsx)("h3",{className:x.A.templates_item_name,children:e}),(0,o.jsx)("span",{className:x.A.templates_item_text,children:t})]},e+n))})}):(0,o.jsxs)("div",{className:x.A.templates__notfound_container,children:[(0,o.jsx)("span",{children:e.use("vkcom_templates_not_found")}),(0,o.jsx)(r.N_E,{onClick:A.A,children:e.use("vkcom_template_add")})]})]})},C=()=>(0,o.jsx)(u.A,{trigger:"hover",placement:"top-end",content:(0,o.jsx)(k,{}),className:x.A.templatesDropdown,children:(0,o.jsx)(m.A,{icon:a.s})});s()}catch(e){s(e)}})},17100:(e,t,n)=>{n.d(t,{Ay:()=>i,Fs:()=>c,Hb:()=>l});var s=n(74848),o=n(96540);const a=(0,o.createContext)(null),r=()=>{const e=(0,o.useContext)(a);if(!e)throw new Error("CustomModalPageContext has not been passed in provider");return e},l=()=>{const e=r();return{closeModal:()=>e.setOpen(!1)}},c=()=>{const{onClose:e,onClosed:t,onOpen:n,onOpened:s,open:o,setOpen:a}=r();return{open:o,setOpen:a,onClose:e,onClosed:t,onOpen:n,onOpened:s}},i=({onClose:e,onClosed:t,onOpen:n,onOpened:r,...l})=>{const[c,i]=(0,o.useState)(!0);return(0,s.jsx)(a.Provider,{value:{open:c,setOpen:i,onClose:e,onClosed:t,onOpen:n,onOpened:r},...l})}},44497:(e,t,n)=>{n.d(t,{A:()=>s});const s=()=>{const e=window.location.pathname.match(/\/convo\/(-?\d+)/);if(e)return Number(e[1])||0;const t=new URLSearchParams(window.location.search),n=Number(t.get("sel"));return n||0}},55517:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(22440),o=n(96540),a=n(5679),r=n(44497);const l=(0,s.A)(),c=()=>{const[e,t]=(0,o.useState)(l.cur?.peer||(0,r.A)());return(0,o.useEffect)(()=>{if(l.vkmeIntegration)return(0,a.A)(e=>{"UserOpenedConvo"===e.type&&t(e.peerId),"UserClosedConvo"===e.type&&t(0)})},[]),(0,o.useEffect)(()=>{if(l.vkmeIntegration)return;return l.nav.onLocationChange(()=>{e!==l.cur.peer&&l.cur.peer&&t(l.cur.peer)})},[]),e}},61166:(e,t,n)=>{n.d(t,{A:()=>s});const s={PopoverReforged:"V5vFILKwsuTAoDXp","reforged-anim-fade-in":"aKnVnnmt_OsWj600","reforged-anim-fade-out":"uvPWUxQQgpV6cgFC","PopoverReforged--noBackground":"h4DVtB6f3FyJCExI"}},62353:(e,t,n)=>{n.d(t,{A:()=>r});var s=n(74848);const o="AVY0jdkXtVbJ02Rd",a="lPnlEF1aJomtaWvb",r=({icon:e,getRootRef:t,...n})=>(0,s.jsx)("div",{className:o,ref:t,...n,children:(0,s.jsx)("i",{role:"img",className:a,children:(0,s.jsx)(e,{width:24,height:24})})})},64352:(e,t,n)=>{n.r(t),n.d(t,{default:()=>a});var s=n(53778);class o extends s.default{constructor(){super("VKN_templates",{lifetime:5e3})}async getTemplates(e){return(await this.getStorage())[e]||[]}async setTemplates(e,t){const n=await this.getStorage();n[e]=t,await this.saveStorage(n)}async removeTemplates(e){const t=await this.getStorage();delete t[e],await this.saveStorage(t)}}const a=new o},72453:(e,t,n)=>{n.d(t,{s:()=>s});var s=(0,n(78414).mT)("Icon24List","list_24","0 0 24 24",'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="list_24"><g fill="none" fill-rule="evenodd"><path d="M0 0h24v24H0z" /><path fill="currentColor" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5m0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5m0 12a1.5 1.5 0 1 0-.001 2.999A1.5 1.5 0 0 0 4 16.5M21 18a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1m0-6a1 1 0 0 0-1-1H8a1 1 0 0 0 0 2h12a1 1 0 0 0 1-1M8 7h12a1 1 0 0 0 0-2H8a1 1 0 1 0 0 2" /></g></symbol>',24,24,!1,void 0)},74225:(e,t,n)=>{var s=n(96540);function o(e,t,n){var o="function"==typeof t;s.useEffect(function(){var n,s=!0,a=e(function(){return s});return Promise.resolve(a).then(function(e){n=e}),function(){s=!1,o&&t(n)}},o?n:t)}e.exports=o,e.exports.useAsyncEffect=o},75623:(e,t,n)=>{n.d(t,{A:()=>l});var s=n(74848),o=n(39107),a=n(96540),r=n(61166);const l=({hideOnClick:e=!1,noBackground:t=!1,mode:n,onClick:l,onShownChange:c,className:i,contentWrapperClassName:d,shown:m,content:u,...p})=>{const[h,g]=(0,a.useState)(!1),f=(0,a.useRef)(null),v=(0,a.useRef)(null),A=(0,a.useCallback)(e=>{e?g(!0):f.current=setTimeout(()=>{g(!1)},100),c?.(e)},[n,c,g]);return(0,a.useEffect)(()=>{"boolean"==typeof m&&A(m)},[m,A]),(0,s.jsx)(o.AMh,{shown:h,className:(0,o.xWm)(r.A.PopoverReforged,t&&r.A["PopoverReforged--noBackground"],i),onShownChange:A,onClick:e=>{if("side"===n&&f.current)clearTimeout(f.current);else try{l?.(e)}catch(e){console.error(e)}},content:(0,s.jsx)("div",{ref:v,className:(0,o.xWm)(d),onClick:t=>{e&&v.current?.contains(t.target)&&g(!1)},children:u}),...p})}},77898:(e,t,n)=>{n.d(t,{A:()=>s});const s={templatesRoot:"bxZrFH8choFguRzH",templatesInput:"kd2WrXQDMB9IBwTq",templates_container:"p6vN7KAmEFbh1IMJ",templates_header:"Ew34OYReyNemBYEh",templates_title:"ZdwHvdT3_L3O9Wkw",templates__notfound_container:"EzRwRakd86Tbs3xp",templates_list:"Lb6sILyXSNtT6VbD",templates_item:"TbdMaBwExmgMaHlS",templates_item_name:"PvPuAoabjqPMU0n8",templates_item_text:"L9LWQ0zdRYWdGTgo",templates_list_skelet:"s2kGmHeqFJNn4y0y",templatesDropdown:"bZRMMJmhKataUpni"}},78469:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(65879);const o=async e=>{const{store:t}=await(0,s.A)();return t.getState().peers.get(e)}},84072:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(89307);const o=async()=>{const{default:e}=await n.e(9329).then(n.bind(n,74091));return(0,s.A)(e,{zIndex:1101})}},87675:(e,t,n)=>{n.a(e,async(e,s)=>{try{n.d(t,{A:()=>a});var o=n(93819);const e=await o.A,a=()=>e;s()}catch(e){s(e)}},1)},89307:(e,t,n)=>{n.d(t,{A:()=>m});var s=n(74848),o=n(17100),a=n(3068);const r="d32BOj2kmVxWOEmy";let l=null,c=!1;const i=()=>{c||(c=!0,l=window.getComputedStyle(document.body).overflow,document.body.style.overflow="hidden")},d="--vknext--z_index_modal",m=async(e,{zIndex:t}={})=>{const n=document.createElement("div"),m=document.createElement("div");t&&(n.className=r,m.className=r,m.style.setProperty(d,t.toString()),n.style.setProperty(d,t.toString())),document.body.appendChild(n),document.body.appendChild(m);const{unmount:u}=await(0,a.A)({root:n,portal:m,content:(0,s.jsx)(o.Ay,{onOpen:i,onClosed:()=>{setTimeout(()=>{c&&(c=!1,null!==l&&(document.body.style.overflow=l,l=null))},100),setTimeout(()=>{u(),n.remove(),m.remove()},1e3)},children:"function"==typeof e?(0,s.jsx)(e,{}):e}),disableParentTransformForPositionFixedElements:!0,disableAnchorTextDecoration:!0})}},94249:(e,t,n)=>{n.d(t,{Z:()=>c});var s=n(74848),o=n(39107),a=n(96540),r=n(62295);const l="Pab4lyLnWDTPLKdr",c=({children:e,height:t=537,style:n={},saveKey:c,isScrollBottom:i,ThumbVerticalClassName:d,...m})=>{const u=(0,a.useRef)(null);return(0,a.useEffect)(()=>{if(!c)return;if(!u.current)return;const e=(e=>{const t=sessionStorage.getItem(e);return t?parseFloat(t):null})(c);e&&u.current.scrollTop(e)},[c,u]),(0,a.useEffect)(()=>{i&&u.current&&u.current.scrollToBottom()}),(0,s.jsx)(r.ur,{ref:u,style:{height:t,...n},renderThumbVertical:e=>{var t,n;return c&&u.current&&(t=c,n=u.current.getScrollTop(),sessionStorage.setItem(t,n.toString())),(0,s.jsx)("div",{...e,className:(0,o.xWm)(l,d)})},renderTrackHorizontal:()=>(0,s.jsx)("div",{}),...m,children:e})}},99716:(e,t,n)=>{n.d(t,{A:()=>o});var s=n(89307);const o=async(e=1101)=>{const{default:t}=await n.e(9947).then(n.bind(n,99947));return(0,s.A)(t,{zIndex:e})}}}]);